import { c as createComponent, m as maybeRenderHead, u as unescapeHTML, r as renderTemplate } from './astro/server_BWQ42mf1.mjs';
import 'kleur/colors';
import 'clsx';

const html = () => "<p>对于区间(线段)的修改、维护，从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 变为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p>\n<hr>\n<section><h1 id=\"构建\">构建<a class=\"anchor\" href=\"#构建\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/97c81e47838bc3a2941aaf4c68933de0.png\" alt=\"\">\n这是什么意思呢？ 如果你要表示线段的和，那么最上面的根节点的权值表示的是这个线段 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 的和。根的两个儿子分别表示这个线段中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 的和，与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">3 \\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 的和。以此类推。</p><p>然后我们还可以的到一个性质：节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 的权值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>=</mo></mrow><annotation encoding=\"application/x-tex\">=</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">=</span></span></span></span> 她的左儿子权值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo></mrow><annotation encoding=\"application/x-tex\">+</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span></span></span></span> 她的右儿子权值。因为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 的和就是等于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 的和与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">2\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 的和的和。</p><p>根据这个思路，我们就可以建树了，我们设一个结构体 <code>tree</code>，<code>tree[i].l</code> 与 <code>tree[i].r</code> 分别表示这个点代表的线段的左右下标，<code>tree[i].sum</code> 表示这个节点表示的线段和。</p><p>我们知道，一颗从 1 11 开始编号的二叉树，结点 i ii 的左儿子和右儿子编号分别是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>×</mo><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">2 \\times i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>×</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2\\times i + 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7429em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>。</p><p>再根据刚才的性质，得到式子：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].sum=tree [i∗2].sum+tree[i∗2+1 ].sum</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span></span></span></span>; <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo separator=\"true\">;</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].sum=tree[i*2].sum+tree[i*2+1].sum;tree[i].sum=tree[i∗2].sum+tree[i∗2+1].sum</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span></span></span></span>; 就可以建一颗线段树了！代码如下：</p><div class=\"expressive-code\"><link rel=\"stylesheet\" href=\"/_astro/ec.d1dr8.css\"><script type=\"module\" src=\"/_astro/ec.qopfj.js\"></script><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:55ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l,tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">input[l],</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> mid</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r)</span><span style=\"--0:#F97583;--1:#F97583\">>></span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,mid);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,mid</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><hr></section>\n<section><h1 id=\"简单线段树\">简单线段树<a class=\"anchor\" href=\"#简单线段树\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><section><h2 id=\"单点修改区间查询\">单点修改，区间查询<a class=\"anchor\" href=\"#单点修改区间查询\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/22a46ac7055f8f700832ef014ed7a489.png\" alt=\"\">\n然后我们要求 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 的和，我们先从根节点开始查询，发现她的左儿子1-2这个区间和答案区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 有交集，那么我们跑到左儿子这个区间。</p><p>然后，我们发现这个区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 被完全包括在答案区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 这个区间里面，那就把她的值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 返回。</p><p>我们回到了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 区间，发现她的右儿子 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">3 \\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 区间和答案区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 有交集，那么我们走到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 区间。</p><p>到了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">3 \\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 区间，我们发现她并没有完全包含在答案区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 里面，但发现她的左儿子 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间又交集，那么久走到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间。</p><p>到了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间，发现其被答案区间完全包含，就返回她的值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 一直到最开始。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>+</mo><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">3 + 1\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 区间的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>=</mo><mn>6</mn></mrow><annotation encoding=\"application/x-tex\">3 = 6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">6</span></span></span></span>，我们知道了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间和为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>6</mn></mrow><annotation encoding=\"application/x-tex\">6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">6</span></span></span></span>。</p><p>有人可能会说你这样是不是疯了，我拿脚都能算出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>+</mo><mn>2</mn><mo>+</mo><mn>3</mn><mo>=</mo><mn>6</mn></mrow><annotation encoding=\"application/x-tex\">1 + 2 + 3 = 6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">6</span></span></span></span>，为什么这么麻烦？！</p><p>因为这才几个数，如果一百万个数，这样时间会大大增快。</p><p>我们总结一下，线段树的查询方法：</p><ul>\n<li>如果这个区间被完全包括在目标区间里面，直接返回这个区间的值。</li>\n<li>如果这个区间的左儿子和目标区间有交集，那么搜索左儿子。</li>\n<li>如果这个区间的右儿子和目标区间有交集，那么搜索右儿子。</li>\n</ul><p>代码如下：</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:54ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> res</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l) res</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) res</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> res;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><p>关于那几个if的条件一定要看清楚，最好背下来，以防考场上脑抽推错。</p><p>然后,我们怎么修改这个区间的单点，其实这个相对简单很多，你要把区间的第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>i</mi><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">dis</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">s</span></span></span></span> 位加上 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>。那么你从根节点开始，看这个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>i</mi><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">dis</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">s</span></span></span></span> 是在左儿子还是在右儿子，在哪往哪跑，然后返回的时候，还是按照<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].sum=tree[i*2].sum+tree[i*2+1].sum</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span></span></span></span> 的原则，更新所有路过的点。</p><p>如果不理解，我还是画个图吧，其中深蓝色是去的路径，浅蓝色是返回的路径，回来时候红色的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo></mrow><annotation encoding=\"application/x-tex\">+</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span></span></span></span> 标记就是把这个点加上这个值。\n<img src=\"https://i-blog.csdnimg.cn/blog_migrate/b0f6769ede881ffe60e77f38bec50400.png\" alt=\"\"></p><p>代码如下：</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:78ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">pos</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">num</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num,</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//如果是叶子节点，那么说明找到了</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(pos</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,pos,num);</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//在哪往哪跑</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">else</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,pos,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum;</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//返回更新</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h2 id=\"区间修改单点查询\">区间修改，单点查询<a class=\"anchor\" href=\"#区间修改单点查询\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>区间修改和单点查询，我们的思路就变为：如果把这个区间加上 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>，相当于把这个区间涂上一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 的标记，然后单点查询的时候，就从上跑到下，把沿路的标记加起来就好。</p><p>这里面给区间贴标记的方式与上面的区间查找类似，原则还是那三条，只不过第一条：如果这个区间被完全包括在目标区间里面，直接返回这个区间的值变为了如果这个区间如果这个区间被完全包括在目标区间里面，讲这个区间标记 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>。</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:70ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">num</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num,</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> mid</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r)</span><span style=\"--0:#F97583;--1:#F97583\">>></span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mid) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(r</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mid) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><p>查询</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:43ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">pos</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ans</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].sum;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> mid</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r)</span><span style=\"--0:#F97583;--1:#F97583\">>></span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(pos</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mid) </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,pos);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">else</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,pos);</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><section><h3 id=\"区间修改单点查询完整代码\">区间修改单点查询完整代码<a class=\"anchor\" href=\"#区间修改单点查询完整代码\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:88ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#include</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">&#x3C;bits/stdc++.h></span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">std</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> N</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#F97583;--1:#F97583\">e</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> n,q,a[N],ans;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,t</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) t</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),x</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">static</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> sta[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">35</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> top</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{sta[top</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sta[</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">ch</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x),</span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch)),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">SGT</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">struct</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">node</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> l,r,sum;}tree[N</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">23</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l,tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">24</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">25</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> mid</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r)</span><span style=\"--0:#F97583;--1:#F97583\">>></span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">26</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,mid);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">27</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,mid</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">28</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">29</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">num</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">30</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num,</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">31</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">32</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">33</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">34</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">pos</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">35</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ans</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].sum;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">36</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">37</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">pos) </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,pos);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">38</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">pos) </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,pos);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">39</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">40</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">SGT</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">41</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">signed</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">main</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">42</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),q</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">43</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) a[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">44</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,n);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">45</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(q</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">46</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> op</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">47</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(op</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">48</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> l</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),r</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),x</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">49</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">50</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">51</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(op</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">52</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">            </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ans</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> x</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">53</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ans</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">a[x],</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#79B8FF;--1:#79B8FF\">\\n</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">54</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">55</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">56</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">57</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h3 id=\"为什么需要把路上的-numtextnumnum-加起来\">为什么需要把路上的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>num</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{num}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord text\"><span class=\"mord\">num</span></span></span></span></span> 加起来?<a class=\"anchor\" href=\"#为什么需要把路上的-numtextnumnum-加起来\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>因为我们在进行区间修改的时候，若当前区间已经被完全包含在目标区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[ l , r ]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">]</span></span></span></span> 里，直接将该区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>n</mi><mi>u</mi><mi>m</mi><mo>+</mo><mo>=</mo><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].num += k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mord\">+</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>，不需要再继续往下走了，类似 lazy 标记，所以单点查询的时候要再加上路径上的值（即原本的权值再加上经过的若干次修改的值才是这个单点的值）。</p></section></section></section>\n<section><h1 id=\"进阶线段树\">进阶线段树<a class=\"anchor\" href=\"#进阶线段树\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>区间修改、区间查询，你可能会认为，把上一章里面的这两个模块加在一起就好了，然后你就会发现你大错特错。</p><p>因为如果对于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 这个区间，你把 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">+ 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">1</span></span></span></span> ，相当于把节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 标记，但是如果你查询 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">2\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 时，你会发现你加的时没有标记的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span>节点和没有标记的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 节点加上去，结果当然是错的。</p><p>那么我们应该怎么办？这时候 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>pushdown</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{pushdown}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">pushdown</span></span></span></span></span> 的作用就显现出来了。</p><p>你会想到，我们只需要在查询的时候，如果我们要查的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 节点在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 区间的里面，那我们就可以把 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 区间标记的那个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">+ 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">1</span></span></span></span> 给推下去这样就能顺利地加上了。\n怎么记录这个标记呢？我们需要记录一个“懒标记” <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytage</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytage}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytage</span></span></span></span></span>，来记录这个区间。</p><p>区间修改的时候，我们按照如下原则：</p><ul>\n<li>如果当前区间被完全覆盖在目标区间里，讲这个区间的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>k</mi><mo>×</mo><mo stretchy=\"false\">(</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>r</mi><mo>−</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>l</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">sum+k \\times (tree[i].r-tree[i].l+1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>。</li>\n<li>如果没有完全覆盖，则先下传懒标记。</li>\n<li>如果这个区间的左儿子和目标区间有交集，那么搜索左儿子。</li>\n<li>如果这个区间的右儿子和目标区间有交集，那么搜索右儿子。</li>\n</ul><p>然后查询的时候，将这个懒标记下传就好了，下面图解一下：\n如图，区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 分别是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mtext>、</mtext><mn>2</mn><mtext>、</mtext><mn>3</mn><mtext>、</mtext><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">1 、 2 、 3 、 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">1</span><span class=\"mord cjk_fallback\">、</span><span class=\"mord\">2</span><span class=\"mord cjk_fallback\">、</span><span class=\"mord\">3</span><span class=\"mord cjk_fallback\">、</span><span class=\"mord\">4</span></span></span></span> ，我们要把 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">+ 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">1</span></span></span></span> 。因为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 区间被完全覆盖，所以将其 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">+2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">2</span></span></span></span>，并将紫色的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytage</mtext><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">\\text{lazytage}+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytage</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间同理。\n<img src=\"https://i-blog.csdnimg.cn/blog_migrate/b64f0efc922c03968527c0310317e7dc.png\" alt=\"\">\n注意我们处理完这些以后，还是要按照<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].sum=tree[i*2].sum+tree[i*2+1].sum</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span></span></span></span> 的原则返回，代码如下：</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:70ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">pushdown</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].tag){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].tag</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].tag</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> mid</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r)</span><span style=\"--0:#F97583;--1:#F97583\">>></span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(mid</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mid);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">num</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">pushdown</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">pushup</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p);</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//tree[p].sum=tree[p&#x3C;&#x3C;1].sum+tree[p&#x3C;&#x3C;1|1].sum;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><p>查询的时候，和上一章的几乎一样，就是也要像修改一样加入 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>pushdown</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{pushdown}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">pushdown</span></span></span></span></span>，这里用图模拟一下。我们要查询 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">2\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 区间的和，这是查询前的情况，所有紫色的代表 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytage</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytage}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytage</span></span></span></span></span>。\n<img src=\"https://i-blog.csdnimg.cn/blog_migrate/5d01a871871b4f1393eeb3f3f333324c.png\" alt=\"\">\n然后，我们查到区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 时，发现这个区间并没有被完全包括在目标区间里，于是我们就 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>pushdown</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{pushdown}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">pushdown</span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytage</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytage}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytage</span></span></span></span></span> 下传，并让每个区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">sum</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span></span></span></span> 加上 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>r</mi><mo>−</mo><mi>l</mi><mo stretchy=\"false\">)</mo><mo>×</mo><mi>l</mi><mi>a</mi><mi>z</mi><mi>y</mi><mi>t</mi><mi>a</mi><mi>g</mi><mo stretchy=\"false\">(</mo><mi>r</mi><mo>−</mo><mi>l</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(r−l) \\times lazytag(r-l)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">zy</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mclose\">)</span></span></span></span>。\n<img src=\"https://i-blog.csdnimg.cn/blog_migrate/e56190e962a139b0760084236352fe90.png\" alt=\"\">\n然后查到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 区间，发现被完全包含，所以就返 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span>，再搜索到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 区间，发现被完全包含，那么直接返回 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>8</mn></mrow><annotation encoding=\"application/x-tex\">8</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">8</span></span></span></span>，最后 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>+</mo><mn>8</mn><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">3+8=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">8</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 就是答案</p><p>这里是代码实现：</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:54ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">pushdown</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p);</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> res</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l) res</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) res</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> res;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><hr></section>\n<section><h1 id=\"乘法根号线段树\">乘法（根号）线段树<a class=\"anchor\" href=\"#乘法根号线段树\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><section><h2 id=\"乘法线段树\">乘法线段树<a class=\"anchor\" href=\"#乘法线段树\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>如果这个线段树只有乘法，那么直接加入 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 变成乘，然后 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>∗</mo><mo>=</mo><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].sum*=k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mord\">∗</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 就好了。但是，如果我们是又加又乘，那就不一样了。</p><p>当 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 下标传递的时候，我们需要考虑，是先加再乘还是先乘再加。我们只需要对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 做这样一个处理。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 分为两种，分别是加法的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>plz</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{plz}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">plz</span></span></span></span></span> 和乘法的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>mlz</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{mlz}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">mlz</span></span></span></span></span>。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>mlz</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{mlz}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">mlz</span></span></span></span></span> 很简单处理，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>pushdown</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{pushdown}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">pushdown</span></span></span></span></span> 时直接 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>×</mo></mrow><annotation encoding=\"application/x-tex\">\\times</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">×</span></span></span></span>父亲的就可以了，那么加法呢？</p><p>我们需要把原先的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>plz</mtext><mo>×</mo></mrow><annotation encoding=\"application/x-tex\">\\text{plz} \\times</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">plz</span></span><span class=\"mord\">×</span></span></span></span> 父亲的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>mlz</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{mlz}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">mlz</span></span></span></span></span> 再 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo></mrow><annotation encoding=\"application/x-tex\">+</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span></span></span></span> 父亲的<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>plz</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{plz}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">plz</span></span></span></span></span>。</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:84ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">pushdwon</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> t1</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].mlz,t2</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].plz;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t1</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t2</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">))</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t1</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t2</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">))</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].mlz</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].mlz</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t1)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].mlz</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].mlz</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t1)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].plz</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].plz</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t1</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t2)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].plz</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].plz</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t1</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t2)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].mlz</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,tree[p].plz</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><p>然后加法和减法的函数同理，维护 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 的时候加法标记一定要记得现乘再加。</p></section><section><h2 id=\"根号线段树\">根号线段树<a class=\"anchor\" href=\"#根号线段树\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>其实，根号线段树和除法线段树一样。她们乍眼一看感觉直接用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 标记除了多少，但是实际上，会出现精度问题。</p><p>c++的除法是向下取整，很明显，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mi>k</mi><mo mathvariant=\"normal\">≠</mo><mi>a</mi><mi mathvariant=\"normal\">/</mi><mi>k</mi><mo>+</mo><mi>b</mi><mi mathvariant=\"normal\">/</mi><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">(a+b)/k \\neq a/k+b/k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>（在向下取整的情况下），而根号，很明显 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msqrt><mi>a</mi></msqrt><mo>+</mo><msqrt><mi>b</mi></msqrt><mo mathvariant=\"normal\">≠</mo><msqrt><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">\\sqrt{a}+ \\sqrt{b} \\neq \\sqrt{a+b}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.2397em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8003em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-2.7603em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2397em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1267em;vertical-align:-0.1944em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9322em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathnormal\">b</span></span></span><span style=\"top:-2.8922em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1078em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.1494em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8906em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">b</span></span></span><span style=\"top:-2.8506em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1494em;\"><span></span></span></span></span></span></span></span></span>那么怎么办？</p><p>第一个想法就是暴力，对于每个要改动的区间l~r,把里面的每个点都单独除，但这样就会把时间复杂度卡得比大暴力都慢（因为多个常数），所以怎么优化？</p><p>我们对于每个区间，维护她的最大值和最小值，然后每次修改时，如果这个区间的最大值根号和最小值的根号一样，说明这个区间整体根号不会产生误差，就直接修改（除法同理）</p><p>其中，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 把除法当成减法，记录的是这个区间里每个元素减去的值。</p><p>下面是根号线段树的修改过程：</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:79ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">Sqrt</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">i</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].l</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r)  </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].l</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].minn</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#B392F0;--1:#B392F0\">sqrt</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].minn))</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].maxx</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#B392F0;--1:#B392F0\">sqrt</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].maxx))){</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//如果这个区间的最大值最小值一样</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> u</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].minn</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#B392F0;--1:#B392F0\">sqrt</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].minn);</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//计算区间中每个元素需要减去的</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].lz</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">u;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].sum</span><span style=\"--0:#F97583;--1:#F97583\">-=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].r</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">u;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].minn</span><span style=\"--0:#F97583;--1:#F97583\">-=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">u;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].maxx</span><span style=\"--0:#F97583;--1:#F97583\">-=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">u;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">push_down</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l) </span><span style=\"--0:#B392F0;--1:#B392F0\">Sqrt</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#B392F0;--1:#B392F0\">Sqrt</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].minn</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">min</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].minn,tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].minn);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].maxx</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">max</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].maxx,tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].maxx);</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><p>然后 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>pushdown</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{pushdown}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">pushdown</span></span></span></span></span> 没什么变化，就是要记得 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].minn</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">minn</span></span></span></span>、<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>a</mi><mi>x</mi><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].maxx</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">ma</span><span class=\"mord mathnormal\">xx</span></span></span></span> 也要记得<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mtext>lazytage</mtext></mrow><annotation encoding=\"application/x-tex\">- \\text{lazytage}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">−</span><span class=\"mord text\"><span class=\"mord\">lazytage</span></span></span></span></span>。</p></section></section>";

				const frontmatter = {"title":"线段树","published":"2025-06-10T00:00:00.000Z","description":"","image":"","tags":["c++"],"category":"c++","draft":true,"lang":"","minutes":13,"words":2657,"excerpt":"对于区间(线段)的修改、维护，从 O(n) 变为 O(\\log n)。"};
				const file = "/workspaces/xuluhui.github.io/src/content/posts/SGT.md";
				const url = undefined;

				const Content = createComponent((result, _props, slots) => {
					const { layout, ...content } = frontmatter;
					content.file = file;
					content.url = url;

					return renderTemplate`${maybeRenderHead()}${unescapeHTML(html())}`;
				});

export { Content, Content as default, file, frontmatter, url };
