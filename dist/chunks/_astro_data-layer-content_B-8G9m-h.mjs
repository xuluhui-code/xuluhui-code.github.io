const _astro_dataLayerContent = [["Map",1,2,9,10,30,31],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.8.1","content-config-digest","4dd7800d2509d27a","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://xuluhui-code.github.io/xuluhui-code.github.io/\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"always\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image/\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"experimentalDefaultStyles\":true},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":false,\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[null,null,null,null,null,null,null],\"rehypePlugins\":[null,null,[null,{\"components\":{}}],[null,{\"behavior\":\"append\",\"properties\":{\"className\":[\"anchor\"]},\"content\":{\"type\":\"element\",\"tagName\":\"span\",\"properties\":{\"className\":[\"anchor-icon\"],\"data-pagefind-ignore\":true},\"children\":[{\"type\":\"text\",\"value\":\"#\"}]}}],[null,{\"themes\":[\"github-dark\",\"github-dark\"],\"plugins\":[{\"name\":\"Collapsible sections\",\"styleSettings\":{\"defaultValues\":{\"collapsibleSections\":{\"closedBorderWidth\":\"0\",\"closedPaddingBlock\":\"4px\",\"closedMargin\":\"0\",\"closedFontFamily\":\"inherit\",\"closedFontSize\":\"inherit\",\"closedLineHeight\":\"inherit\",\"openBorderWidth\":\"1px\",\"openPadding\":\"0\",\"openMargin\":\"0\",\"openBackgroundColor\":\"transparent\",\"openBorderColor\":\"transparent\",\"expandIcon\":\"url(\\\"data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2016%2016'%3E%3Cpath%20d%3D'm8.177.677%202.896%202.896a.25.25%200%200%201-.177.427H8.75v1.25a.75.75%200%200%201-1.5%200V4H5.104a.25.25%200%200%201-.177-.427L7.823.677a.25.25%200%200%201%20.354%200ZM7.25%2010.75a.75.75%200%200%201%201.5%200V12h2.146a.25.25%200%200%201%20.177.427l-2.896%202.896a.25.25%200%200%201-.354%200l-2.896-2.896A.25.25%200%200%201%205.104%2012H7.25v-1.25Zm-5-2a.75.75%200%200%200%200-1.5h-.5a.75.75%200%200%200%200%201.5h.5ZM6%208a.75.75%200%200%201-.75.75h-.5a.75.75%200%200%201%200-1.5h.5A.75.75%200%200%201%206%208Zm2.25.75a.75.75%200%200%200%200-1.5h-.5a.75.75%200%200%200%200%201.5h.5ZM12%208a.75.75%200%200%201-.75.75h-.5a.75.75%200%200%201%200-1.5h.5A.75.75%200%200%201%2012%208Zm2.25.75a.75.75%200%200%200%200-1.5h-.5a.75.75%200%200%200%200%201.5h.5Z'%2F%3E%3C%2Fsvg%3E\\\")\",\"collapseIcon\":\"url(\\\"data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2016%2016'%3E%3Cpath%20d%3D'M10.896%202H8.75V.75a.75.75%200%200%200-1.5%200V2H5.104a.25.25%200%200%200-.177.427l2.896%202.896a.25.25%200%200%200%20.354%200l2.896-2.896A.25.25%200%200%200%2010.896%202ZM8.75%2015.25a.75.75%200%200%201-1.5%200V14H5.104a.25.25%200%200%201-.177-.427l2.896-2.896a.25.25%200%200%201%20.354%200l2.896%202.896a.25.25%200%200%201-.177.427H8.75v1.25Zm-6.5-6.5a.75.75%200%200%200%200-1.5h-.5a.75.75%200%200%200%200%201.5h.5ZM6%208a.75.75%200%200%201-.75.75h-.5a.75.75%200%200%201%200-1.5h.5A.75.75%200%200%201%206%208Zm2.25.75a.75.75%200%200%200%200-1.5h-.5a.75.75%200%200%200%200%201.5h.5ZM12%208a.75.75%200%200%201-.75.75h-.5a.75.75%200%200%201%200-1.5h.5A.75.75%200%200%201%2012%208Zm2.25.75a.75.75%200%200%200%200-1.5h-.5a.75.75%200%200%200%200%201.5h.5Z'%2F%3E%3C%2Fsvg%3E\\\")\"}},\"cssVarExclusions\":[],\"cssVarReplacements\":[[\"collapsibleSections\",\"cs\"]],\"preventUnitlessValues\":[\"collapsibleSections.closedBorderWidth\",\"collapsibleSections.openBorderWidth\"]},\"hooks\":{}},{\"name\":\"Line numbers\",\"styleSettings\":{\"defaultValues\":{\"lineNumbers\":{\"foreground\":\"inherit\",\"highlightForeground\":\"inherit\"}},\"cssVarExclusions\":[],\"cssVarReplacements\":[],\"preventUnitlessValues\":[]},\"hooks\":{}},{\"name\":\"Language Badge\"},{\"name\":\"Custom Copy Button\",\"hooks\":{}},{\"name\":\"astro-expressive-code\",\"hooks\":{}}],\"defaultProps\":{\"wrap\":true,\"overridesByLang\":{\"shellsession\":{\"showLineNumbers\":false}}},\"styleOverrides\":{\"codeBackground\":\"var(--codeblock-bg)\",\"borderRadius\":\"0.75rem\",\"borderColor\":\"none\",\"codeFontSize\":\"0.875rem\",\"codeFontFamily\":\"'JetBrains Mono Variable', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace\",\"codeLineHeight\":\"1.5rem\",\"frames\":{\"editorBackground\":\"var(--codeblock-bg)\",\"terminalBackground\":\"var(--codeblock-bg)\",\"terminalTitlebarBackground\":\"var(--codeblock-topbar-bg)\",\"editorTabBarBackground\":\"var(--codeblock-topbar-bg)\",\"editorActiveTabBackground\":\"none\",\"editorActiveTabIndicatorBottomColor\":\"var(--primary)\",\"editorActiveTabIndicatorTopColor\":\"none\",\"editorTabBarBorderBottomColor\":\"var(--codeblock-topbar-bg)\",\"terminalTitlebarBorderBottomColor\":\"none\"},\"textMarkers\":{\"delHue\":0,\"insHue\":180,\"markHue\":250}},\"frames\":{\"showCopyToClipboardButton\":false}}]],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"responsiveImages\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false},\"legacy\":{\"collections\":false}}","spec",["Map",11,12],"about",{id:11,data:13,body:17,filePath:18,digest:19,rendered:20,legacyId:29},{minutes:14,words:15,excerpt:16},1,46,"This is the blog for xuluhui.","# About\n\n<!-- This is the demo site for [Fuwari](https://github.com/xuluhui-code/fuwari). -->\nThis is the blog for xuluhui.\n\n::github{repo=\"xuluhui-code/fuwari\"}\n\n<!-- > ### Sources of images used in this site\n>\n> - [Unsplash](https://unsplash.com/)\n> - [星と少女](https://www.pixiv.net/artworks/108916539) by [Stella](https://www.pixiv.net/users/93273965)\n> - [Rabbit - v1.4 Showcase](https://civitai.com/posts/586908) by [Rabbit_YourMajesty](https://civitai.com/user/Rabbit_YourMajesty) -->","src/content/spec/about.md","26767f54f3e9b17c",{html:21,metadata:22},"<section><h1 id=\"about\">About<a class=\"anchor\" href=\"#about\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><!-- This is the demo site for [Fuwari](https://github.com/xuluhui-code/fuwari). --><p>This is the blog for xuluhui.</p><a id=\"GCdwfdln-card\" class=\"card-github fetch-waiting no-styling\" href=\"https://github.com/xuluhui-code/fuwari\" target=\"_blank\" repo=\"xuluhui-code/fuwari\"><div class=\"gc-titlebar\"><div class=\"gc-titlebar-left\"><div class=\"gc-owner\"><div id=\"GCdwfdln-avatar\" class=\"gc-avatar\"></div><div class=\"gc-user\">xuluhui-code</div></div><div class=\"gc-divider\">/</div><div class=\"gc-repo\">fuwari</div></div><div class=\"github-logo\"></div></div><div id=\"GCdwfdln-description\" class=\"gc-description\">Waiting for api.github.com...</div><div class=\"gc-infobar\"><div id=\"GCdwfdln-stars\" class=\"gc-stars\">00K</div><div id=\"GCdwfdln-forks\" class=\"gc-forks\">0K</div><div id=\"GCdwfdln-license\" class=\"gc-license\">0K</div><span id=\"GCdwfdln-language\" class=\"gc-language\">Waiting...</span></div><script id=\"GCdwfdln-script\" type=\"text/javascript\" defer>\n      fetch('https://api.github.com/repos/xuluhui-code/fuwari', { referrerPolicy: \"no-referrer\" }).then(response => response.json()).then(data => {\n        document.getElementById('GCdwfdln-description').innerText = data.description?.replace(/:[a-zA-Z0-9_]+:/g, '') || \"Description not set\";\n        document.getElementById('GCdwfdln-language').innerText = data.language;\n        document.getElementById('GCdwfdln-forks').innerText = Intl.NumberFormat('en-us', { notation: \"compact\", maximumFractionDigits: 1 }).format(data.forks).replaceAll(\" \", '');\n        document.getElementById('GCdwfdln-stars').innerText = Intl.NumberFormat('en-us', { notation: \"compact\", maximumFractionDigits: 1 }).format(data.stargazers_count).replaceAll(\" \", '');\n        const avatarEl = document.getElementById('GCdwfdln-avatar');\n        avatarEl.style.backgroundImage = 'url(' + data.owner.avatar_url + ')';\n        avatarEl.style.backgroundColor = 'transparent';\n        document.getElementById('GCdwfdln-license').innerText = data.license?.spdx_id || \"no-license\";\n        document.getElementById('GCdwfdln-card').classList.remove(\"fetch-waiting\");\n        console.log(\"[GITHUB-CARD] Loaded card for xuluhui-code/fuwari | GCdwfdln.\")\n      }).catch(err => {\n        const c = document.getElementById('GCdwfdln-card');\n        c?.classList.add(\"fetch-error\");\n        console.warn(\"[GITHUB-CARD] (Error) Loading card for xuluhui-code/fuwari | GCdwfdln.\")\n      })\n    </script></a><!-- > ### Sources of images used in this site\n>\n> - [Unsplash](https://unsplash.com/)\n> - [星と少女](https://www.pixiv.net/artworks/108916539) by [Stella](https://www.pixiv.net/users/93273965)\n> - [Rabbit - v1.4 Showcase](https://civitai.com/posts/586908) by [Rabbit_YourMajesty](https://civitai.com/user/Rabbit_YourMajesty) --></section>",{headings:23,localImagePaths:26,remoteImagePaths:27,frontmatter:13,imagePaths:28},[24],{depth:14,slug:11,text:25},"About#",[],[],[],"about.md","posts",["Map",32,33,56,57,85,86,117,118,150,151,186,187,226,227,352,353,405,406,509,510],"test",{id:32,data:34,body:40,filePath:41,digest:42,rendered:43,legacyId:55},{title:32,published:35,draft:36,description:37,image:37,tags:38,category:37,lang:37,prevTitle:37,prevSlug:37,nextTitle:37,nextSlug:37},["Date","2025-06-10T00:00:00.000Z"],true,"",[39],"c++","$cnmd$\n$$E=mc^2$$","src/content/posts/test.md","1873655fd1f8a44f",{html:44,metadata:45},"<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mi>n</mi><mi>m</mi><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">cnmd</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">nm</span><span class=\"mord mathnormal\">d</span></span></span></span>\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi><mo>=</mo><mi>m</mi><msup><mi>c</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">E=mc^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></p>",{headings:46,localImagePaths:47,remoteImagePaths:48,frontmatter:49,imagePaths:54},[],[],[],{title:32,published:50,description:37,image:37,tags:51,category:37,draft:36,lang:37,minutes:14,words:52,excerpt:53},["Date","2025-06-10T00:00:00.000Z"],[39],2,"cnmd\nE=mc^2",[],"test.md","draft",{id:56,data:58,body:66,filePath:67,digest:68,rendered:69,legacyId:84},{title:59,published:60,draft:36,description:37,image:37,tags:61,category:65,lang:37,prevTitle:37,prevSlug:37,nextTitle:37,nextSlug:37},"Draft Example",["Date","2022-07-01T00:00:00.000Z"],[62,63,64],"Markdown","Blogging","Demo","Examples","# This Article is a Draft\n\nThis article is currently in a draft state and is not published. Therefore, it will not be visible to the general audience. The content is still a work in progress and may require further editing and review.\n\nWhen the article is ready for publication, you can update the \"draft\" field to \"false\" in the Frontmatter:\n\n```markdown\n---\ntitle: Draft Example\npublished: 2024-01-11T04:40:26.381Z\ntags: [Markdown, Blogging, Demo]\ncategory: Examples\ndraft: false\n---","src/content/posts/draft.md","91841e93b69ca61d",{html:70,metadata:71},"<section><h1 id=\"this-article-is-a-draft\">This Article is a Draft<a class=\"anchor\" href=\"#this-article-is-a-draft\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>This article is currently in a draft state and is not published. Therefore, it will not be visible to the general audience. The content is still a work in progress and may require further editing and review.</p><p>When the article is ready for publication, you can update the “draft” field to “false” in the Frontmatter:</p><div class=\"expressive-code\"><link rel=\"stylesheet\" href=\"/_astro/ec.d1dr8.css\"><script type=\"module\" src=\"/_astro/ec.qopfj.js\"></script><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"markdown\" class=\"wrap\" style=\"--ecMaxLine:35ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">---</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">title</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">Draft Example</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">published</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: </span><span style=\"--0:#79B8FF;--1:#79B8FF\">2024-01-11T04:40:26.381Z</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">tags</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: [</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">Markdown</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">, </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">Blogging</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">, </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">Demo</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">category</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">Examples</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">draft</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: </span><span style=\"--0:#79B8FF;--1:#79B8FF\">false</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">---</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section>",{headings:72,localImagePaths:76,remoteImagePaths:77,frontmatter:78,imagePaths:83},[73],{depth:14,slug:74,text:75},"this-article-is-a-draft","This Article is a Draft#",[],[],{title:59,published:79,tags:80,category:65,draft:36,minutes:14,words:81,excerpt:82},["Date","2022-07-01T00:00:00.000Z"],[62,63,64],72,"This article is currently in a draft state and is not published. Therefore, it will not be visible to the general audience. The content is still a work in progress and may require further editing and review.",[],"draft.md","video",{id:85,data:87,body:95,filePath:96,digest:97,rendered:98,legacyId:116},{title:88,published:89,draft:90,description:91,image:37,tags:92,category:65,lang:37,prevTitle:37,prevSlug:37,nextTitle:37,nextSlug:37},"Include Video in the Posts",["Date","2023-08-01T00:00:00.000Z"],false,"This post demonstrates how to include embedded video in a blog post.",[93,94],"Example","Video","Just copy the embed code from YouTube or other platforms, and paste it in the markdown file.\n\n```yaml\n---\ntitle: Include Video in the Post\npublished: 2023-10-19\n// ...\n---\n\n<iframe width=\"100%\" height=\"468\" src=\"https://www.youtube.com/embed/5gIf0_xpFPI?si=N1WTorLKL0uwLsU_\" title=\"YouTube video player\" frameborder=\"0\" allowfullscreen></iframe>\n```\n\n## YouTube\n\n<iframe width=\"100%\" height=\"468\" src=\"https://www.youtube.com/embed/5gIf0_xpFPI?si=N1WTorLKL0uwLsU_\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen></iframe>\n\n## Bilibili\n\n<iframe width=\"100%\" height=\"468\" src=\"//player.bilibili.com/player.html?bvid=BV1fK4y1s7Qf&p=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\"> </iframe>","src/content/posts/video.md","fca409f7063f6092",{html:99,metadata:100},"<p>Just copy the embed code from YouTube or other platforms, and paste it in the markdown file.</p>\n<div class=\"expressive-code\"><link rel=\"stylesheet\" href=\"/_astro/ec.d1dr8.css\"><script type=\"module\" src=\"/_astro/ec.qopfj.js\"></script><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"yaml\" class=\"wrap\" style=\"--ecMaxLine:172ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#B392F0;--1:#B392F0\">---</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">title</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">Include Video in the Post</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">published</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: </span><span style=\"--0:#79B8FF;--1:#79B8FF\">2023-10-19</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#9ECBFF;--1:#9ECBFF\">// ...</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#B392F0;--1:#B392F0\">---</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\">\n</div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span style=\"--0:#9ECBFF;--1:#9ECBFF\">&#x3C;iframe width=\"100%\" height=\"468\" src=\"https://www.youtube.com/embed/5gIf0_xpFPI?si=N1WTorLKL0uwLsU_\" title=\"YouTube video player\" frameborder=\"0\" allowfullscreen>&#x3C;/iframe></span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div>\n<section><h2 id=\"youtube\">YouTube<a class=\"anchor\" href=\"#youtube\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><iframe width=\"100%\" height=\"468\" src=\"https://www.youtube.com/embed/5gIf0_xpFPI?si=N1WTorLKL0uwLsU_\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen></iframe></section>\n<section><h2 id=\"bilibili\">Bilibili<a class=\"anchor\" href=\"#bilibili\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><iframe width=\"100%\" height=\"468\" src=\"//player.bilibili.com/player.html?bvid=BV1fK4y1s7Qf&#x26;p=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\"> </iframe></section>",{headings:101,localImagePaths:108,remoteImagePaths:109,frontmatter:110,imagePaths:115},[102,105],{depth:52,slug:103,text:104},"youtube","YouTube#",{depth:52,slug:106,text:107},"bilibili","Bilibili#",[],[],{title:88,published:111,description:91,tags:112,category:65,draft:90,minutes:14,words:113,excerpt:114},["Date","2023-08-01T00:00:00.000Z"],[93,94],61,"Just copy the embed code from YouTube or other platforms, and paste it in the markdown file.",[],"video.md","guide",{id:117,data:119,body:128,filePath:129,digest:130,rendered:131,legacyId:149},{title:120,published:121,draft:90,description:122,image:123,tags:124,category:127,lang:37,prevTitle:37,prevSlug:37,nextTitle:37,nextSlug:37},"Simple Guides for Fuwari",["Date","2024-04-01T00:00:00.000Z"],"How to use this blog template.","./cover.jpeg",[125,63,126],"Fuwari","Customization","Guides","> Cover image source: [Source](https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/208fc754-890d-4adb-9753-2c963332675d/width=2048/01651-1456859105-(colour_1.5),girl,_Blue,yellow,green,cyan,purple,red,pink,_best,8k,UHD,masterpiece,male%20focus,%201boy,gloves,%20ponytail,%20long%20hair,.jpeg)\n\nThis blog template is built with [Astro](https://astro.build/). For the things that are not mentioned in this guide, you may find the answers in the [Astro Docs](https://docs.astro.build/).\n\n## Front-matter of Posts\n\n```yaml\n---\ntitle: My First Blog Post\npublished: 2023-09-09\ndescription: This is the first post of my new Astro blog.\nimage: ./cover.jpg\ntags: [Foo, Bar]\ncategory: Front-end\ndraft: false\n---\n```\n\n| Attribute     | Description                                                                                                                                                                                                 |\n|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| `title`       | The title of the post.                                                                                                                                                                                      |\n| `published`   | The date the post was published.                                                                                                                                                                            |\n| `description` | A short description of the post. Displayed on index page.                                                                                                                                                   |\n| `image`       | The cover image path of the post.<br/>1. Start with `http://` or `https://`: Use web image<br/>2. Start with `/`: For image in `public` dir<br/>3. With none of the prefixes: Relative to the markdown file |\n| `tags`        | The tags of the post.                                                                                                                                                                                       |\n| `category`    | The category of the post.                                                                                                                                                                                   |\n| `draft`        | If this post is still a draft, which won't be displayed.                                                                                                                                                    |\n\n## Where to Place the Post Files\n\n\n\nYour post files should be placed in `src/content/posts/` directory. You can also create sub-directories to better organize your posts and assets.\n\n```\nsrc/content/posts/\n├── post-1.md\n└── post-2/\n    ├── cover.png\n    └── index.md\n```","src/content/posts/guide/index.md","3f269f2b0ac351d0",{html:132,metadata:133},"<blockquote>\n<p>Cover image source: <a href=\"https://image.civitai.com/xG1nkqKTMzGDvpLrqFT7WA/208fc754-890d-4adb-9753-2c963332675d/width=2048/01651-1456859105-(colour_1.5),girl,_Blue,yellow,green,cyan,purple,red,pink,_best,8k,UHD,masterpiece,male%20focus,%201boy,gloves,%20ponytail,%20long%20hair,.jpeg\">Source</a></p>\n</blockquote>\n<p>This blog template is built with <a href=\"https://astro.build/\">Astro</a>. For the things that are not mentioned in this guide, you may find the answers in the <a href=\"https://docs.astro.build/\">Astro Docs</a>.</p>\n<section><h2 id=\"front-matter-of-posts\">Front-matter of Posts<a class=\"anchor\" href=\"#front-matter-of-posts\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><div class=\"expressive-code\"><link rel=\"stylesheet\" href=\"/_astro/ec.d1dr8.css\"><script type=\"module\" src=\"/_astro/ec.qopfj.js\"></script><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"yaml\" class=\"wrap\" style=\"--ecMaxLine:57ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#B392F0;--1:#B392F0\">---</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">title</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">My First Blog Post</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">published</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: </span><span style=\"--0:#79B8FF;--1:#79B8FF\">2023-09-09</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">description</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">This is the first post of my new Astro blog.</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">image</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">./cover.jpg</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">tags</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: [</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">Foo</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">, </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">Bar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">category</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">Front-end</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">draft</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">: </span><span style=\"--0:#79B8FF;--1:#79B8FF\">false</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span style=\"--0:#B392F0;--1:#B392F0\">---</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th>Attribute</th><th>Description</th></tr></thead><tbody><tr><td><code>title</code></td><td>The title of the post.</td></tr><tr><td><code>published</code></td><td>The date the post was published.</td></tr><tr><td><code>description</code></td><td>A short description of the post. Displayed on index page.</td></tr><tr><td><code>image</code></td><td>The cover image path of the post.<br>1. Start with <code>http://</code> or <code>https://</code>: Use web image<br>2. Start with <code>/</code>: For image in <code>public</code> dir<br>3. With none of the prefixes: Relative to the markdown file</td></tr><tr><td><code>tags</code></td><td>The tags of the post.</td></tr><tr><td><code>category</code></td><td>The category of the post.</td></tr><tr><td><code>draft</code></td><td>If this post is still a draft, which won’t be displayed.</td></tr></tbody></table></section>\n<section><h2 id=\"where-to-place-the-post-files\">Where to Place the Post Files<a class=\"anchor\" href=\"#where-to-place-the-post-files\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Your post files should be placed in <code>src/content/posts/</code> directory. You can also create sub-directories to better organize your posts and assets.</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"plaintext\" class=\"wrap\" style=\"--ecMaxLine:18ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">src/content/posts/</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">├── post-1.md</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">└── post-2/</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">    </span></span><span style=\"--0:#e1e4e8;--1:#e1e4e8\">├── cover.png</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">    </span></span><span style=\"--0:#e1e4e8;--1:#e1e4e8\">└── index.md</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section>",{headings:134,localImagePaths:141,remoteImagePaths:142,frontmatter:143,imagePaths:148},[135,138],{depth:52,slug:136,text:137},"front-matter-of-posts","Front-matter of Posts#",{depth:52,slug:139,text:140},"where-to-place-the-post-files","Where to Place the Post Files#",[],[],{title:120,published:144,description:122,image:123,tags:145,category:127,draft:90,minutes:14,words:146,excerpt:147},["Date","2024-04-01T00:00:00.000Z"],[125,63,126],160,"This blog template is built with Astro. For the things that are not mentioned in this guide, you may find the answers in the Astro Docs.",[],"guide/index.md","markdown",{id:150,data:152,body:157,filePath:158,digest:159,rendered:160,legacyId:185},{title:153,published:154,draft:90,description:155,image:37,tags:156,category:65,lang:37,prevTitle:37,prevSlug:37,nextTitle:37,nextSlug:37},"Markdown Example",["Date","2023-10-01T00:00:00.000Z"],"A simple example of a Markdown blog post.",[62,63,64],"# An h1 header\n\nParagraphs are separated by a blank line.\n\n2nd paragraph. _Italic_, **bold**, and `monospace`. Itemized lists\nlook like:\n\n- this one\n- that one\n- the other one\n\nNote that --- not considering the asterisk --- the actual text\ncontent starts at 4-columns in.\n\n> Block quotes are\n> written like so.\n>\n> They can span multiple paragraphs,\n> if you like.\n\nUse 3 dashes for an em-dash. Use 2 dashes for ranges (ex., \"it's all\nin chapters 12--14\"). Three dots ... will be converted to an ellipsis.\nUnicode is supported. ☺\n\n## An h2 header\n\nHere's a numbered list:\n\n1. first item\n2. second item\n3. third item\n\nNote again how the actual text starts at 4 columns in (4 characters\nfrom the left side). Here's a code sample:\n\n    # Let me re-iterate ...\n    for i in 1 .. 10 { do-something(i) }\n\nAs you probably guessed, indented 4 spaces. By the way, instead of\nindenting the block, you can use delimited blocks, if you like:\n\n```\ndefine foobar() {\n    print \"Welcome to flavor country!\";\n}\n```\n\n(which makes copying & pasting easier). You can optionally mark the\ndelimited block for Pandoc to syntax highlight it:\n\n```python\nimport time\n# Quick, count to ten!\nfor i in range(10):\n    # (but not *too* quick)\n    time.sleep(0.5)\n    print i\n```\n\n### An h3 header\n\nNow a nested list:\n\n1. First, get these ingredients:\n\n    - carrots\n    - celery\n    - lentils\n\n2. Boil some water.\n\n3. Dump everything in the pot and follow\n    this algorithm:\n\n        find wooden spoon\n        uncover pot\n        stir\n        cover pot\n        balance wooden spoon precariously on pot handle\n        wait 10 minutes\n        goto first step (or shut off burner when done)\n\n    Do not bump wooden spoon or it will fall.\n\nNotice again how text always lines up on 4-space indents (including\nthat last line which continues item 3 above).\n\nHere's a link to [a website](http://foo.bar), to a [local\ndoc](local-doc.html), and to a [section heading in the current\ndoc](#an-h2-header). Here's a footnote [^1].\n\n[^1]: Footnote text goes here.\n\nTables can look like this:\n\nsize material color\n\n---\n\n9 leather brown\n10 hemp canvas natural\n11 glass transparent\n\nTable: Shoes, their sizes, and what they're made of\n\n(The above is the caption for the table.) Pandoc also supports\nmulti-line tables:\n\n---\n\nkeyword text\n\n---\n\nred Sunsets, apples, and\nother red or reddish\nthings.\n\ngreen Leaves, grass, frogs\nand other things it's\nnot easy being.\n\n---\n\nA horizontal rule follows.\n\n---\n\nHere's a definition list:\n\napples\n: Good for making applesauce.\noranges\n: Citrus!\ntomatoes\n: There's no \"e\" in tomatoe.\n\nAgain, text is indented 4 spaces. (Put a blank line between each\nterm/definition pair to spread things out more.)\n\nHere's a \"line block\":\n\n| Line one\n| Line too\n| Line tree\n\nand images can be specified like so:\n\n[//]: # (![example image]&#40;./demo-banner.png \"An exemplary image\"&#41;)\n\nInline math equations go in like so: $\\omega = d\\phi / dt$. Display\nmath should get its own line and be put in in double-dollarsigns:\n\n$$I = \\int \\rho R^{2} dV$$\n\n$$\n\\begin{equation*}\n\\pi\n=3.1415926535\n \\;8979323846\\;2643383279\\;5028841971\\;6939937510\\;5820974944\n \\;5923078164\\;0628620899\\;8628034825\\;3421170679\\;\\ldots\n\\end{equation*}\n$$\n\nAnd note that you can backslash-escape any punctuation characters\nwhich you wish to be displayed literally, ex.: \\`foo\\`, \\*bar\\*, etc.","src/content/posts/markdown.md","305a0caa18c52417",{html:161,metadata:162},"<section><h1 id=\"an-h1-header\">An h1 header<a class=\"anchor\" href=\"#an-h1-header\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>Paragraphs are separated by a blank line.</p><p>2nd paragraph. <em>Italic</em>, <strong>bold</strong>, and <code>monospace</code>. Itemized lists\nlook like:</p><ul>\n<li>this one</li>\n<li>that one</li>\n<li>the other one</li>\n</ul><p>Note that --- not considering the asterisk --- the actual text\ncontent starts at 4-columns in.</p><blockquote>\n<p>Block quotes are\nwritten like so.</p>\n<p>They can span multiple paragraphs,\nif you like.</p>\n</blockquote><p>Use 3 dashes for an em-dash. Use 2 dashes for ranges (ex., “it’s all\nin chapters 12—14”). Three dots … will be converted to an ellipsis.\nUnicode is supported. ☺</p><section><h2 id=\"an-h2-header\">An h2 header<a class=\"anchor\" href=\"#an-h2-header\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Here’s a numbered list:</p><ol>\n<li>first item</li>\n<li>second item</li>\n<li>third item</li>\n</ol><p>Note again how the actual text starts at 4 columns in (4 characters\nfrom the left side). Here’s a code sample:</p><div class=\"expressive-code\"><link rel=\"stylesheet\" href=\"/_astro/ec.d1dr8.css\"><script type=\"module\" src=\"/_astro/ec.qopfj.js\"></script><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"plaintext\" class=\"wrap\" style=\"--ecMaxLine:36ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\"># Let me re-iterate ...</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">for i in 1 .. 10 { do-something(i) }</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><p>As you probably guessed, indented 4 spaces. By the way, instead of\nindenting the block, you can use delimited blocks, if you like:</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"plaintext\" class=\"wrap\" style=\"--ecMaxLine:39ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">define foobar() {</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">    </span></span><span style=\"--0:#e1e4e8;--1:#e1e4e8\">print \"Welcome to flavor country!\";</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><p>(which makes copying &#x26; pasting easier). You can optionally mark the\ndelimited block for Pandoc to syntax highlight it:</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"python\" class=\"wrap\" style=\"--ecMaxLine:27ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">import</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> time</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\"># Quick, count to ten!</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i </span><span style=\"--0:#F97583;--1:#F97583\">in</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">range</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">):</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#99A0A6;--1:#99A0A6\"># (but not *too* quick)</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">time.sleep(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0.5</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#79B8FF;--1:#79B8FF\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><section><h3 id=\"an-h3-header\">An h3 header<a class=\"anchor\" href=\"#an-h3-header\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>Now a nested list:</p><ol>\n<li>\n<p>First, get these ingredients:</p>\n<ul>\n<li>carrots</li>\n<li>celery</li>\n<li>lentils</li>\n</ul>\n</li>\n<li>\n<p>Boil some water.</p>\n</li>\n<li>\n<p>Dump everything in the pot and follow\nthis algorithm:</p>\n<div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"plaintext\" class=\"wrap\" style=\"--ecMaxLine:48ch\"><code><div class=\"ec-line\" style=\"--ecIndent:1ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span></span><span style=\"--0:#e1e4e8;--1:#e1e4e8\">find wooden spoon</span></div></div><div class=\"ec-line\" style=\"--ecIndent:1ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span></span><span style=\"--0:#e1e4e8;--1:#e1e4e8\">uncover pot</span></div></div><div class=\"ec-line\" style=\"--ecIndent:1ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span></span><span style=\"--0:#e1e4e8;--1:#e1e4e8\">stir</span></div></div><div class=\"ec-line\" style=\"--ecIndent:1ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span></span><span style=\"--0:#e1e4e8;--1:#e1e4e8\">cover pot</span></div></div><div class=\"ec-line\" style=\"--ecIndent:1ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span></span><span style=\"--0:#e1e4e8;--1:#e1e4e8\">balance wooden spoon precariously on pot handle</span></div></div><div class=\"ec-line\" style=\"--ecIndent:1ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span></span><span style=\"--0:#e1e4e8;--1:#e1e4e8\">wait 10 minutes</span></div></div><div class=\"ec-line\" style=\"--ecIndent:1ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span></span><span style=\"--0:#e1e4e8;--1:#e1e4e8\">goto first step (or shut off burner when done)</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div>\n<p>Do not bump wooden spoon or it will fall.</p>\n</li>\n</ol><p>Notice again how text always lines up on 4-space indents (including\nthat last line which continues item 3 above).</p><p>Here’s a link to <a href=\"http://foo.bar\">a website</a>, to a <a href=\"local-doc.html\">local\ndoc</a>, and to a <a href=\"#an-h2-header\">section heading in the current\ndoc</a>. Here’s a footnote <sup><a href=\"#user-content-fn-1\" id=\"user-content-fnref-1\" data-footnote-ref=\"\" aria-describedby=\"footnote-label\">1</a></sup>.</p><p>Tables can look like this:</p><p>size material color</p><hr><p>9 leather brown\n10 hemp canvas natural\n11 glass transparent</p><p>Table: Shoes, their sizes, and what they’re made of</p><p>(The above is the caption for the table.) Pandoc also supports\nmulti-line tables:</p><hr><p>keyword text</p><hr><p>red Sunsets, apples, and\nother red or reddish\nthings.</p><p>green Leaves, grass, frogs\nand other things it’s\nnot easy being.</p><hr><p>A horizontal rule follows.</p><hr><p>Here’s a definition list:</p><p>apples\n: Good for making applesauce.\noranges\n: Citrus!\ntomatoes\n: There’s no “e” in tomatoe.</p><p>Again, text is indented 4 spaces. (Put a blank line between each\nterm/definition pair to spread things out more.)</p><p>Here’s a “line block”:</p><p>| Line one\n| Line too\n| Line tree</p><p>and images can be specified like so:</p><p>Inline math equations go in like so: <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ω</mi><mo>=</mo><mi>d</mi><mi>ϕ</mi><mi mathvariant=\"normal\">/</mi><mi>d</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">\\omega = d\\phi / dt</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ω</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">ϕ</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">t</span></span></span></span>. Display\nmath should get its own line and be put in in double-dollarsigns:</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi><mo>=</mo><mo>∫</mo><mi>ρ</mi><msup><mi>R</mi><mn>2</mn></msup><mi>d</mi><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">I = \\int \\rho R^{2} dV</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1202em;vertical-align:-0.3061em;\"></span><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0006em;\">∫</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">ρ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span></p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.16em\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>π</mi><mo>=</mo><mn>3.1415926535</mn><mtext>  </mtext><mn>8979323846</mn><mtext>  </mtext><mn>2643383279</mn><mtext>  </mtext><mn>5028841971</mn><mtext>  </mtext><mn>6939937510</mn><mtext>  </mtext><mn>5820974944</mn><mtext>  </mtext><mn>5923078164</mn><mtext>  </mtext><mn>0628620899</mn><mtext>  </mtext><mn>8628034825</mn><mtext>  </mtext><mn>3421170679</mn><mtext>  </mtext><mo>…</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{equation*}\n\\pi\n=3.1415926535\n \\;8979323846\\;2643383279\\;5028841971\\;6939937510\\;5820974944\n \\;5923078164\\;0628620899\\;8628034825\\;3421170679\\;\\ldots\n\\end{equation*}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2em;vertical-align:-0.35em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.85em;\"><span style=\"top:-3.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">3.1415926535</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">8979323846</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">2643383279</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">5028841971</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">6939937510</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">5820974944</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">5923078164</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">0628620899</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">8628034825</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">3421170679</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\">…</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.35em;\"><span></span></span></span></span></span></span></span></span></span></span></span><p>And note that you can backslash-escape any punctuation characters\nwhich you wish to be displayed literally, ex.: `foo`, *bar*, etc.</p></section></section></section>\n<section data-footnotes=\"\" class=\"footnotes\"><h2 class=\"sr-only\" id=\"footnote-label\">Footnotes<a class=\"anchor\" href=\"#footnote-label\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2>\n<ol>\n<li id=\"user-content-fn-1\">\n<p>Footnote text goes here. <a href=\"#user-content-fnref-1\" data-footnote-backref=\"\" aria-label=\"Back to reference 1\" class=\"data-footnote-backref\">↩</a></p>\n</li>\n</ol>\n</section>",{headings:163,localImagePaths:177,remoteImagePaths:178,frontmatter:179,imagePaths:184},[164,167,170,174],{depth:14,slug:165,text:166},"an-h1-header","An h1 header#",{depth:52,slug:168,text:169},"an-h2-header","An h2 header#",{depth:171,slug:172,text:173},3,"an-h3-header","An h3 header#",{depth:52,slug:175,text:176},"footnote-label","Footnotes#",[],[],{title:153,published:180,description:155,tags:181,category:65,draft:90,minutes:52,words:182,excerpt:183},["Date","2023-10-01T00:00:00.000Z"],[62,63,64],444,"Paragraphs are separated by a blank line.",[],"markdown.md","markdown-extended",{id:186,data:188,body:194,filePath:195,digest:196,rendered:197,legacyId:225},{title:189,published:190,updated:191,draft:90,description:192,image:37,tags:193,category:65,lang:37,prevTitle:37,prevSlug:37,nextTitle:37,nextSlug:37},"Markdown Extended Features",["Date","2024-05-01T00:00:00.000Z"],["Date","2024-11-29T00:00:00.000Z"],"Read more about Markdown features in Fuwari",[64,93,62,125],"## GitHub Repository Cards\nYou can add dynamic cards that link to GitHub repositories, on page load, the repository information is pulled from the GitHub API. \n\n::github{repo=\"Fabrizz/MMM-OnSpotify\"}\n\nCreate a GitHub repository card with the code `::github{repo=\"<owner>/<repo>\"}`.\n\n```markdown\n::github{repo=\"saicaca/fuwari\"}\n```\n\n## Admonitions\n\nFollowing types of admonitions are supported: `note` `tip` `important` `warning` `caution`\n\n:::note\nHighlights information that users should take into account, even when skimming.\n:::\n\n:::tip\nOptional information to help a user be more successful.\n:::\n\n:::important\nCrucial information necessary for users to succeed.\n:::\n\n:::warning\nCritical content demanding immediate user attention due to potential risks.\n:::\n\n:::caution\nNegative potential consequences of an action.\n:::\n\n### Basic Syntax\n\n```markdown\n:::note\nHighlights information that users should take into account, even when skimming.\n:::\n\n:::tip\nOptional information to help a user be more successful.\n:::\n```\n\n### Custom Titles\n\nThe title of the admonition can be customized.\n\n:::note[MY CUSTOM TITLE]\nThis is a note with a custom title.\n:::\n\n```markdown\n:::note[MY CUSTOM TITLE]\nThis is a note with a custom title.\n:::\n```\n\n### GitHub Syntax\n\n> [!TIP]\n> [The GitHub syntax](https://github.com/orgs/community/discussions/16925) is also supported.\n\n```\n> [!NOTE]\n> The GitHub syntax is also supported.\n\n> [!TIP]\n> The GitHub syntax is also supported.\n```","src/content/posts/markdown-extended.md","2f2adec4ccbcdd91",{html:198,metadata:199},"<section><h2 id=\"github-repository-cards\">GitHub Repository Cards<a class=\"anchor\" href=\"#github-repository-cards\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>You can add dynamic cards that link to GitHub repositories, on page load, the repository information is pulled from the GitHub API.</p><a id=\"GCavlmst-card\" class=\"card-github fetch-waiting no-styling\" href=\"https://github.com/Fabrizz/MMM-OnSpotify\" target=\"_blank\" repo=\"Fabrizz/MMM-OnSpotify\"><div class=\"gc-titlebar\"><div class=\"gc-titlebar-left\"><div class=\"gc-owner\"><div id=\"GCavlmst-avatar\" class=\"gc-avatar\"></div><div class=\"gc-user\">Fabrizz</div></div><div class=\"gc-divider\">/</div><div class=\"gc-repo\">MMM-OnSpotify</div></div><div class=\"github-logo\"></div></div><div id=\"GCavlmst-description\" class=\"gc-description\">Waiting for api.github.com...</div><div class=\"gc-infobar\"><div id=\"GCavlmst-stars\" class=\"gc-stars\">00K</div><div id=\"GCavlmst-forks\" class=\"gc-forks\">0K</div><div id=\"GCavlmst-license\" class=\"gc-license\">0K</div><span id=\"GCavlmst-language\" class=\"gc-language\">Waiting...</span></div><script id=\"GCavlmst-script\" type=\"text/javascript\" defer>\n      fetch('https://api.github.com/repos/Fabrizz/MMM-OnSpotify', { referrerPolicy: \"no-referrer\" }).then(response => response.json()).then(data => {\n        document.getElementById('GCavlmst-description').innerText = data.description?.replace(/:[a-zA-Z0-9_]+:/g, '') || \"Description not set\";\n        document.getElementById('GCavlmst-language').innerText = data.language;\n        document.getElementById('GCavlmst-forks').innerText = Intl.NumberFormat('en-us', { notation: \"compact\", maximumFractionDigits: 1 }).format(data.forks).replaceAll(\" \", '');\n        document.getElementById('GCavlmst-stars').innerText = Intl.NumberFormat('en-us', { notation: \"compact\", maximumFractionDigits: 1 }).format(data.stargazers_count).replaceAll(\" \", '');\n        const avatarEl = document.getElementById('GCavlmst-avatar');\n        avatarEl.style.backgroundImage = 'url(' + data.owner.avatar_url + ')';\n        avatarEl.style.backgroundColor = 'transparent';\n        document.getElementById('GCavlmst-license').innerText = data.license?.spdx_id || \"no-license\";\n        document.getElementById('GCavlmst-card').classList.remove(\"fetch-waiting\");\n        console.log(\"[GITHUB-CARD] Loaded card for Fabrizz/MMM-OnSpotify | GCavlmst.\")\n      }).catch(err => {\n        const c = document.getElementById('GCavlmst-card');\n        c?.classList.add(\"fetch-error\");\n        console.warn(\"[GITHUB-CARD] (Error) Loading card for Fabrizz/MMM-OnSpotify | GCavlmst.\")\n      })\n    </script></a><p>Create a GitHub repository card with the code <code>::github{repo=\"&#x3C;owner>/&#x3C;repo>\"}</code>.</p><div class=\"expressive-code\"><link rel=\"stylesheet\" href=\"/_astro/ec.d1dr8.css\"><script type=\"module\" src=\"/_astro/ec.qopfj.js\"></script><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"markdown\" class=\"wrap\" style=\"--ecMaxLine:31ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::github{repo=\"saicaca/fuwari\"}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section>\n<section><h2 id=\"admonitions\">Admonitions<a class=\"anchor\" href=\"#admonitions\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Following types of admonitions are supported: <code>note</code> <code>tip</code> <code>important</code> <code>warning</code> <code>caution</code></p><blockquote class=\"admonition bdm-note\"><span class=\"bdm-title\">NOTE</span><p>Highlights information that users should take into account, even when skimming.</p></blockquote><blockquote class=\"admonition bdm-tip\"><span class=\"bdm-title\">TIP</span><p>Optional information to help a user be more successful.</p></blockquote><blockquote class=\"admonition bdm-important\"><span class=\"bdm-title\">IMPORTANT</span><p>Crucial information necessary for users to succeed.</p></blockquote><blockquote class=\"admonition bdm-warning\"><span class=\"bdm-title\">WARNING</span><p>Critical content demanding immediate user attention due to potential risks.</p></blockquote><blockquote class=\"admonition bdm-caution\"><span class=\"bdm-title\">CAUTION</span><p>Negative potential consequences of an action.</p></blockquote><section><h3 id=\"basic-syntax\">Basic Syntax<a class=\"anchor\" href=\"#basic-syntax\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"markdown\" class=\"wrap\" style=\"--ecMaxLine:79ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">:::note</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">Highlights information that users should take into account, even when skimming.</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">:::</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\">\n</div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">:::tip</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">Optional information to help a user be more successful.</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">:::</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h3 id=\"custom-titles\">Custom Titles<a class=\"anchor\" href=\"#custom-titles\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>The title of the admonition can be customized.</p><blockquote class=\"admonition bdm-note\"><span class=\"bdm-title\"><div>MY CUSTOM TITLE</div></span><p>This is a note with a custom title.</p></blockquote><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"markdown\" class=\"wrap\" style=\"--ecMaxLine:35ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">:::note[MY CUSTOM TITLE]</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">This is a note with a custom title.</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">:::</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h3 id=\"github-syntax\">GitHub Syntax<a class=\"anchor\" href=\"#github-syntax\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><blockquote class=\"admonition bdm-tip\"><span class=\"bdm-title\">TIP</span><p><a href=\"https://github.com/orgs/community/discussions/16925\">The GitHub syntax</a> is also supported.</p></blockquote><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"plaintext\" class=\"wrap\" style=\"--ecMaxLine:38ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">> [!NOTE]</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">> The GitHub syntax is also supported.</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\">\n</div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">> [!TIP]</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">> The GitHub syntax is also supported.</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section></section>",{headings:200,localImagePaths:216,remoteImagePaths:217,frontmatter:218,imagePaths:224},[201,204,207,210,213],{depth:52,slug:202,text:203},"github-repository-cards","GitHub Repository Cards#",{depth:52,slug:205,text:206},"admonitions","Admonitions#",{depth:171,slug:208,text:209},"basic-syntax","Basic Syntax#",{depth:171,slug:211,text:212},"custom-titles","Custom Titles#",{depth:171,slug:214,text:215},"github-syntax","GitHub Syntax#",[],[],{title:189,published:219,updated:220,description:192,image:37,tags:221,category:65,draft:90,minutes:14,words:222,excerpt:223},["Date","2024-05-01T00:00:00.000Z"],["Date","2024-11-29T00:00:00.000Z"],[64,93,62,125],156,"You can add dynamic cards that link to GitHub repositories, on page load, the repository information is pulled from the GitHub API.",[],"markdown-extended.md","tree",{id:226,data:228,body:232,filePath:233,digest:234,rendered:235,legacyId:351},{title:229,published:230,draft:36,description:37,image:37,tags:231,category:39,lang:37,prevTitle:37,prevSlug:37,nextTitle:37,nextSlug:37},"Tree",["Date","2025-06-11T00:00:00.000Z"],[39],"---\n# dfs 序\n\n对于一棵树，我们从根节点处开始 dfs，过程中在每个点第一次遇到的时候把它记录下来，就得到了一棵树的 dfs 序，一般记作 dfn。\n\n它有一个优势在于一棵子树中的节点在 dfs 序上是连续的，这可以帮我们解决很多子树修改、子树查询问题。\n\n---\n\n## 例题：\n## 子树加子树求和\n\n给出一棵 $n$ 个节点的树，以 $1$ 为根，初始时所有点的点权均为 $0$，$q$ 次操作，每次操作给出 $u,x$，你需要给子树 $u$ 中的所有点点权都加上 $x$，然后输出子树 $u$ 的点权和。\n\n$1\\le n,q\\le 5\\times10^5$\n\n---\n\n求出树的 dfn 后该问题就变成了区间加、区间求和问题，线段树维护即可。\n\n---\n\n## [Nearest Leaf](https://www.luogu.com.cn/problem/CF1110F)\n\nDifficulty:$2600$\n\n\n给定一棵树，边有边权，保证其有一种 dfn 为 $1,2,3,\\dots ,n$。\n\n保证 $1$ 号节点不是叶子。\n\n$m$ 次询问，每次给定 $x,l,r$，你需要求出 $\\min\\limits_{i\\in [l,r],i \\text{是叶子}}dis(x,i)$ 。\n\n$3\\le n\\le 5\\times10^5,1\\le m\\le 5\\times 10^5$\n\n---\n\n考虑一个弱化的问题：如果查询的始终是根节点，那么我们只需求出每个点到根节点的距离，然后查询就变成了一个区间最小值问题。\n\n回到原题，此处涉及一个换根的问题，如果要把根节点换成一个相邻的节点，经过一条长度为 $l$ 的边到 $u$，那么每个 $u$ 子树内的点，它到根的距离会减少 $l$，其余节点到根的距离会增加 $l$，这就是一个子树加减的操作，所以直接用线段树维护子树加，子树最小值即可。\n\n---\n\n# 欧拉序\n\n在上述 dfs 的过程中，每次进入一个节点就把它记下来，得到的长度为 $2(n-1)$ 的序列为欧拉序。\n\n如果把欧拉序首尾拼接可以得到一个环，选择不同的断点可以得到不同的根下所得的欧拉序，所以欧拉序的换根是方便的。\n\n---\n\n# 最近公共祖先\n\n$u,v$ 的公共祖先中深度最大的节点被称为 $u,v$ 的最近公共祖先，一般记作 $\\operatorname{lca}(u,v)$。\n\n---\n\n在欧拉序中，设 $u,v$ 最早出现的位置分别为 $idx_u,idx_v$，不妨设 $idx_u\\le idx_v$，那么它们的 $\\operatorname{lca}$ 一定出现在 $[idx_u,idx_v]$ 中，而更浅的祖先不会，所以这就转化为了一个区间最小值问题，可以配合 ST 表做到 $O(1)$ 求 LCA。\n\n在 dfn 中，$[idx_u,idx_v]$ 中一定会出现它们 $\\operatorname{lca}$ 的一个子节点，那么我们也只需求出区间最小值，然后返回它的父亲节点即可，注意要特判 $v$ 在 $u$ 子树中的情况，或者，你也可以询问 $[idx_u+1,idx_v]$ 中的最小值，这样只需要特判 $u=v$ 就可以。\n\n---\n\n考虑对于每个节点，我们预处理出他的所有 $2^k$ 级节点。\n\n对于两个相同深度的节点，我们可以将 $k$ 从 $\\log_2n$ 起依次减少，每次判断 $u,v$ 的 $2^k$ 级祖先是否相同，如果不同，则将 $u,v$ 同时跳到它们的 $2^k$ 级祖先，最后再求出 $u,v$ 两者的父亲即可。\n\n对于两个深度不同的节点，我们可以先将深度较大的节点向上跳到和另一节点同一高度，然后再用上面的做法。\n\n这个做法是单 $\\log$ 的。\n\n---\n\n## [Company](https://www.luogu.com.cn/problem/CF1062E)\n\nDifficulty:$2300$\n\n给定一颗树，有若干个询问，每个询问给出 $l$，$r$，要求编号为 $l\\sim r$ 的点任意删去一个之后剩余点的 $\\operatorname{lca}$ 深度最大，输出删去点的编号和 $\\operatorname{lca}$ 的最大深度。\n\n$2\\le n\\le10^5,1\\le q\\le 10^5$\n\n可以做到 $O(n\\log n+q)$。\n\n---\n\n考虑区间 $\\operatorname{lca}$ 怎么求，可以用 st 表或线段树维护，这样的预处理时间复杂度是 $O(n\\log^2n)$ 的。\n\n但是这个区间的 $\\operatorname{lca}$ 实际上等于其中在 dfn 中的 idx 最大、最小的两个节点的 $\\operatorname{lca}$，可以用 dfn 求 $\\operatorname{lca}$ 的方法直接证明。\n\n所以可以做到 $O(n\\log n)$ 预处理，$O(1)$ 查询。\n\n那么题目中的去掉一个点就是去掉 idx 最大或最小的点，简单分讨即可。\n\n---\n\n# 树上距离\n\n一般定义树上两点之间的唯一一条简单路径的长度为这两点之间的距离。\n\n不妨设每个点 $x$ 到根的距离为 $dep_x$，则 $u,v$ 之间的距离为 $dep_u+dep_v-2dep_{\\operatorname{lca}(u,v)}$，可以 $O(1)$ 求出。\n\n---\n\n# 树的直径\n\n（以下的讨论建立于树的边权均为非负数的情况）\n\n树上最长的链为这棵树的直径，直径可以有多条。\n\n在前面已经讲了一个换根，维护所有点到根的距离的方式，显然可以做到 $O(n\\log n)$ 求直径，但是，还能再强一点吗？\n\n---\n\n不妨让我们先发现一下直径的性质，我们可以发现：\n\n对于每个节点 $u$，以 $u$ 为一端的最长链另一端一定是直径的一端，否则可以考虑把这条链的另一端接到直径上去。\n\n---\n\n于是我们可以得到一个极简做法：\n\n随便找一个点，求出离它最远的点，这个点即直径的一个端点。\n\n然后再求出离这个端点最远的一个点，就是直径的另一个端点。\n\n时间复杂度 $O(n)$。\n\n---\n\n当然，也不难想到一个 dp 做法，即对于每一个节点，求出它跟子树内离它最远的点之间的距离，然后把两条拼接成一条，不难得到直径，时间复杂度也是 $O(n)$ 的。\n\n---\n\n或者，我们考虑一条路径的长度为 $dep_u+dep_v-2dep_{\\operatorname{lca}(u,v)}$，在欧拉序上，我们只需找到三个位置 $p\\le q\\le r$，使得 $dep_p+dep_r-2dep_q$ 最大即可，可以转化为欧拉序上 dp。\n\n---\n\n## 例题：区间直径\n\n给定一棵树，设 $\\operatorname{dis}(x,y)$ 表示节点 $x,y$ 在树上的距离。\n\n$q$ 次询问，每次给出 $l,r$，求：\n\n$$\\max_{l\\le x,y\\le r}\\operatorname{dis}(x,y)$$\n\n$1\\le n\\le 2\\times10^5,1\\le q\\le 10^6$\n\n---\n\n直径是可合并的，如果两个点集中的直径分别为 $\\{p,q\\},\\{u,v\\}$，那么两个点集的并集的直径两个端点必定是 $p,q,u,v$ 中的两个，凭借这个性质，我们可以 $O(1)$ 合并两个点集的直径。\n\n结合 ST 表可以做到 $O(n\\log n)$ 预处理，$O(1)$ 查询区间直径。\n\n---\n\n## [Dynamic](https://www.luogu.com.cn/problem/CF1192B)[ Diameter](https://www.luogu.com.cn/problem/P6845)\n\n有一棵树，含 $n$ 个节点，边带权。\n\n会有 $q$ 次修改，每次会将树上的一条边的边权进行修改，在每次修改后，您需要求出这棵树的直径长度。\n\n**强制在线。**\n\n$1\\le n,q\\le10^5$\n\n---\n\n优化欧拉序上 dp，用线段树维护以下几个值：\n\n- $\\max_{l\\le x\\le r} dep_x$\n- $\\min_{l\\le x\\le r} dep_x$\n- $\\max_{1\\le x\\le y\\le r} dep_x-2dep_y$\n- $\\max_{1\\le x\\le y\\le r} -2dep_x+dep_y$\n- $\\max_{1\\le x\\le y\\le z\\le r} dep_x-2dep_y+dep_z$\n\n维护一个区间加的操作即可。\n\n---\n\n很多题目都会出现最长链等关键词，通常这些题目都要用到直径有关的性质。\n\n---\n\n## [Roads and Ramen](https://www.luogu.com.cn/problem/CF1413F)\n\nDifficulty:$2800$\n\n给出一棵 $n$ 个点的树，每条边上有权值 $0/1$，定义路径的长度为路径上边的数量。\n\n$q$ 次修改，每次修改会修改一条边的权值，每次修改后回答最长的有偶数个 $1$ 的路径长度。\n\n$2\\le n\\le 5\\times10^5,1\\le q\\le 5\\times10^5$\n\n---\n\n随意定一个根，令点 $x$ 到根路径上边权异或和为 $s_x$，那么一条路径 $\\{x,y\\}$ 上有偶数个 $1$ 当且仅当 $s_x=s_y$。\n\n对于直径 $\\{p,q\\}$，如果 $s_p=s_q$，那么答案显然就是直径的长度。\n\n否则，对于任意一个点 $u$，由于 $s_p\\neq s_q$，则必有 $s_u=s_p$ 或 $s_u=s_q$，所以答案的链的一个端点一定是直径的一个端点。\n\n用线段树维护区间 $0/1$ 翻转即可动态维护最长直链，以直径两端为根分别做一遍即可。\n\n时间复杂度 $O(n+q\\log n)$。\n\n---\n\n# 树的中心\n\n对于一个节点，如果所有节点到它距离的最大值取到最小值，那么这个节点就是树的中心。\n\n树的中心可以直接考虑求出树的直径，然后找到直径中点即可，时间复杂度 $O(n)$。\n\n---\n\n## [Tree Compass](https://www.luogu.com.cn/problem/CF1943C)\n\nDifficulty:$2300$\n\n给出一棵 $n$ 个点的树，初始时所有点都是白色的，每次你可以选择一个点 $x$ 和一个非负整数半径 $r$，将树上所有与 $x$ 距离为 $r$ 的点染成黑色，求把所有点染成黑色的最少操作次数，并给出一组方案。\n\n$1\\le n\\le2\\times10^3$\n\n可以做到 $O(n)$。\n\n---\n\n求出树的直径和中点，设直径长度为 $l$。\n\n如果 $l$ 为奇数：\n\n此时有一个中心，对于这个中心操作 $\\lceil\\frac{l}{2}\\rceil$ 次，可以证明是最优方案。\n\n$l$ 为偶数时有两个中心，同理操作即可。\n\n---\n\n# 树的重心\n\n对于一个节点，如果删掉这个节点后，所有连通块大小的最大值取到最小值，那么这个节点就是树的重心。\n\n---\n\n树的重心有一系列性质：\n\n- 树的重心如果不唯一，则至多有两个，且这两个重心相邻。\n- 以树的重心为根时，所有子树的大小都不超过整棵树大小的一半。\n- 树中所有点到某个点的距离和中，到重心的距离和是最小的；如果有两个重心，那么到它们的距离和一样。\n- 把两棵树通过一条边相连得到一棵新的树，那么新的树的重心在连接原来两棵树的重心的路径上。\n- 在一棵树上添加或删除一个叶子，那么它的重心最多只移动一条边的距离。\n\n---\n\n通过以上性质可以推得：设子树 $u$ 的大小为 $siz_u$，$u$ 的子节点中的最大子树大小为 $mx_u$，则如果某个节点 $u$ 满足 $n-siz_u\\le \\frac{n}{2}$ 且 $mx_u\\le\\frac{n}{2}$，那么这个节点就是重心，即 $2mx_u\\le n\\le 2siz_u$。\n\n通过上述性质可以 $O(n)$ 求出重心。\n\n---\n\n## 例题：[Kay and Snowflake](https://www.luogu.com.cn/problem/CF685B)\n\n给出一棵 $n$ 个节点的树，求每个子树的重心。\n\n$2\\le n\\le 3\\times10^5$\n\n可以做到 $O(n)$。\n\n---\n\n我们称一个节点的所有儿子中 $siz$ 最大的节点为它的重儿子，其它的为轻儿子。\n\n发现对于子树 $u$，它的重心不可能在 $u$ 的轻儿子的子树。\n\n设重儿子为 $v$，子树 $v$ 的重心为 $cent_v$，那么 $cent_u$ 一定在 $u$ 到 $cent_v$ 的路径上，因为除了这些点以外的点为根的子树大小都小于 $\\frac{1}{2}siz_u$。\n\n所以直接从 $cent_v$ 开始往上跳即可，每个点最多被跳到一次，所以是 $O(n)$ 的。\n\n---\n\n## [[CSP-S2019] 树的重心](https://www.luogu.com.cn/problem/P5666)\n\n求对于每条边，删除这条边后产生的两棵树的重心编号和之和，若有多个重心则全都计算。\n\n$7\\le n\\le 3\\times10^5-5$，$n$ 为奇数。\n\n可以做到 $O(n)$。\n\n---\n\n通过上一题的做法，我们可以求出每个子树的重心，那么接下来还需考虑去掉每个子树后的重心。\n\n如果删掉的边不在重子树内，那么原来的重心只会不断走向重儿子，显然删的子树越大跳的越多，把那些子树大小桶排之后直接从重心开始跳即可。\n\n否则，重心不断向根节点的次重节点移动，同理维护即可。\n\n需要处理两个重心的细节，时间复杂度 $O(n)$。\n\n---\n\n# dfs 生成树\n\n我们对一个图进行 dfs，每一个点搜到后就打标记不再搜，保留搜索通过的边，删掉其它的边可以得到一棵 dfs 生成树。\n\n---\n\n![](https://oi-wiki.org/graph/images/bcc-1.svg)\n\n---\n\n可以证明 dfs 生成树没有横跨边，而 bfs 生成树则没有返祖边。\n\ndfs 生成树没有横跨边的性质非常优秀，这使我们始终能从下往上处理问题。\n\n---\n\n## 例题：[Choose Your Queries](https://www.luogu.com.cn/problem/CF2025F)\n\nDifficulty:$2700$\n\n给定长度为 $n$ 的数组 $a$，初始全是 $0$，$q$ 次操作，每次给出 $x,y$，你必须选择以下两种操作中的一种执行：\n\n- 将 $a_x$ 或 $a_y$ 加一。\n- 将 $a_x$ 或 $a_y$ 减一。\n\n你需要保证任何时刻，序列中所有数非负，并且最终序列的和最小，求一组方案。\n$3\\le n\\le3\\times 10^5,1\\le q\\le3\\times10^5$，可以做到 $O(n+q)$。\n\n---\n\n对于二元的条件，很多时候需要使用建图的方式处理。\n\n对于每对给出的 $x,y$，我们在 $x$ 和 $y$ 之间连一条边，现在相当于对于每条边都要选一个端点操作，那么对于同一个点，我们一定会交替的选择加一和减一，这样肯定是最优的，那么每次操作相当于选一个点 $01$ 反转。\n\n那么我们建出 dfs 生成树，从低往高考虑，对于每个点往上连的所有边，如果这个点是 $1$，那么就选一条边用来反转他，剩下的所有边都往上反转，否则就直接全都往上反转，由于除了根以外的节点至少有连向父亲的一条边，所以这些点的权值一定是 $0$，只有根可能是 $1$，不难证明此时总和达到了最小值。\n\n---\n\n值得注意的是，图不一定是连通的，要对每个连通块跑一遍。\n\n---\n\n## [Pairs of Pairs](https://www.luogu.com.cn/problem/CF1391E)\n\nDifficulty:$2600$\n\n给出一张 $n$ 个点 $m$ 条边的无向简单连通图，选择以下一个任务完成：\n\n- 输出一条长度至少为 $\\lceil\\frac{n}{2}\\rceil$ 的路径。\n- 选出偶数个点（至少 $\\lceil\\frac{n}{2}\\rceil$ 个），将它们两两配对，使得每两对中的四个点的导出子图最多有两条边。\n\n---\n\n搜出一棵 dfs 生成树，如果有长度大于等于 $\\lceil\\frac{n}{2}\\rceil$ 的直链，那么直接输出。\n\n否则，把每个点按深度归类，将每个深度中的点两两配对，这样每个深度中只有最多一个点没有被配对，而最大深度不超过 $\\lfloor\\frac{n}{2}\\rfloor$，那么就有至少 $\\lceil\\frac{n}{2}\\rceil$ 个点被配对，而 dfs 生成树没有横跨边，所以每两对中的四个点的导出子图最多有两条边。\n\n---\n\n# 树上启发式合并\n\n众所周知并查集有两种优化方式，一种是路径压缩，一种是按秩合并，那么在按秩合并的过程中，每次我们会把大小较小的集合合并到较大的集合中，这看上去很暴力，但是它的复杂度就是对的，这是**启发式合并**的思想。\n\n这种思想在树上问题中会比较常见，当对于每个节点，我们需要合并它所有子节点的答案来得到它本身的答案的时候，经常会用到**树上启发式合并**。\n\n---\n\n## 例题：[Lomsat gelral](https://www.luogu.com.cn/problem/CF600E)\n\nDifficulty:$2300$\n\n给出一棵 $n$ 个点的有根树，点有点权，对于每棵子树，求出其中点权的所有众数之和。\n\n$1\\le n\\le 10^5,1\\le \\text{点权}\\le n$。\n\n---\n\n考虑维护每个点权出现的次数 $cnt$，同时不难维护答案，如果直接去合并 $cnt$ 会比较困难。\n\n可以考虑每个节点都可以继承一个儿子的 $cnt$ 数组，然后对于其它的儿子，将那些子树都跑一遍并更新 $cnt$，只要每次继承子树大小最大的儿子即可，时间复杂度 $O(n\\log n)$。\n\n---\n\n复杂度分析：\n\n我们考虑只保留每个点到重儿子的边，把其他边都删了，那么维护每一个连通块的答案总复杂度是 $O(n)$ 的，接下来考虑重新更新 $cnt$ 的复杂度。\n\n每次我们更新一次 $cnt$ 就把这个连通块连到父亲上，由于这个连通块不是这个父亲的重儿子，所以连通块大小一定会翻倍，那么对于每个节点，它所在的连通块大小只会翻倍 $O(\\log n)$ 次，所以每个点的更新次数都是 $O(\\log n)$ 次，总复杂度为 $O(n\\log n)$。\n\n---\n\n## [Arpa’s letter-marked tree and Mehrdad’s Dokhtar-kosh paths](https://www.luogu.com.cn/problem/CF741D)\n\nDifficulty:$2900$\n\n给定一棵 $n$ 个点的树，根为 $1$，每条边上有一个字符（a 到 v 共 $22$ 种）。一条简单路径被称为 Dokhtar-kosh，当且仅当路径上的字符经过重新排序后可以变成一个回文串。 求每个子树中最长的 Dokhtar-kosh 路径的长度。\n\n$1\\le n\\le 5\\times10^5$\n\n---\n\n首先发现一个字符串能重排成回文串当且仅当有最多一个字符出现了奇数次。\n\n我们用一个 $0\\sim2^{22}-1$ 之间的数 $val_x$ 表示一个点到根路径上每种字母出现了奇数次还是偶数次，那么从 $x$ 到 $y$ 的路径上的信息就是 $val_x\\operatorname{xor}val_y$。\n\n那么也就是 $val_x\\operatorname{xor}val_y$ 等于 $0$ 或 $2^p$ 时合法。\n\n直接用一个数组记录每个 $val$ 在子树内的最大深度，转移这个数组即可，时间复杂度 $O(|\\Sigma|n\\log n)$。\n\n---\n\n# 树上随机游走\n\n一张图的随机游走问题一般复杂度是 $O(n^3)$，但是由于树的优秀性质，所以在此类问题上复杂度通常为 $O(n)$。\n\n---\n\n有时候，我们可以把走一条路径的贡献拆成其中每一条边的贡献。\n\n---\n\n## [Alice's Adventures in the Rabbit Hole](https://www.luogu.com.cn/problem/CF2028E)\n\nDifficulty:$2300$\n\n给出一棵 $n$ 个点的树，初始时棋子在节点 $x$，每次有相同的概率选 $A,B$ 中的一人操作，操作为将棋子往相邻的一条边移动，若棋子移到根则 $A$ 胜，若棋子移到叶子则 $B$ 胜，若两人都以最优决策操作，对于 $x=1,2,\\dots,n$，分别求出 $A$ 赢的概率，答案对 $998244353$ 取模。\n\n$2\\le n\\le2\\times10^5$\n\n可以做到 $O(n)$。\n\n---\n\n考虑如果树是一条直链，$A$ 赢的概率是多少？\n\n实际上等于 $\\frac{n-dep_x}{n}$。\n\n那么如果现在对于节点 $x$，在子树中深度最浅的叶子到他的距离为 $len$，那么在不到达叶子的情况下，它能往上走一步的概率为 $\\frac{len+1}{len}$，设 $f_x$ 表示从 $x$ 处开始 $A$ 能赢的概率，则 $f_x=\\frac{len+1}{len}f_{fa_x}$，直接 dp 即可。\n\n---\n\n也有时候，我们不能简单地处理贡献。\n\n---\n\n## 例题：[Random Walk](https://www.luogu.com.cn/problem/CF1823F)\n\nDifficulty:$2600$\n\n给出一棵 $n$ 个点的树和起点 $s$，终点 $t$，求从 $s$ 开始随机游走，经过每个点的期望次数，答案对 $998244353$ 取模。\n\n$2\\le n\\le 2\\times10^5$\n\n---\n\n我们设 $dp_i$ 表示期望经过 $i$ 点的次数，那么对于除了 $s$ 和 $t$ 之外的节点，有：\n\n$$dp_i=\\sum_{\\{i,j\\}\\in E\\land j\\neq t}\\frac{dp_j}{deg_j}$$\n\n其中 $deg_j$ 表示节点 $j$ 的度数。\n\n$dp_s$ 是上述的式子加一而 $dp_t=1$。\n\n发现这个式子没法转移。\n\n---\n\n$$dp_i=\\sum_{\\{i,j\\}\\in E\\land j\\neq t}\\frac{dp_j}{deg_j}$$\n\n重新观察一下这个式子，我们虽然没有办法快速转移这个式子，但是我们可以方便地将 $dp_i$ 表示为 $k_i\\times dp_{fa_i}+b_i$ 的形式。\n\n首先叶子结点可以直接表示，然后对于每个节点 $i$，如果它的所有子节点 $j$ 的 $dp_j$ 都已经被表示成 $k_j\\times dp_i+b_j$，那么直接代入到上面的式子里，这个式子就会变成一个只跟 $dp_i$ 和 $dp_{fa_i}$ 有关的等式，那么显然可以将 $dp_i$ 表示为 $k_i\\times dp_{fa_i}+b_i$ 的形式。\n\n发现根节点没有父亲，所以 $dp_{root}=b_{root}$，然后再不断下传即可。\n\n---\n\n## [Send the Fool Further!](https://www.luogu.com.cn/problem/CF802L)\n\nDifficulty:$2400$\n\n给出一棵 $n$ 个点的带权树，从根开始随机游走直到走到叶子结点，求经过的期望距离，答案对 $10^9+7$ 取模。\n\n$3\\le n\\le10^5$\n\n---\n\n设 $dp_x$ 为从节点 $x$ 走到叶子结点的期望距离，$out_x$ 为 $x$ 出边之和。\n\n显然有：\n\n$$dp_x=\\frac{out_x+dp_{fa_x}+\\sum\\limits_{y\\in son_x}dp_y}{degree_x}$$\n\n用上一个题的套路处理即可。\n\n---\n# 树链剖分\n树链剖分的思想及能解决的问题\n树链剖分用于将树分割成若干条链的形式，以维护树上路径的信息。\n\n具体来说，将整棵树剖分为若干条链，使它组合成线性结构，然后用其他的数据结构维护信息。\n\n树链剖分（树剖/链剖）有多种形式，如重链剖分，长链剖分 和用于 $\\text{Link/cut Tree}$ 的剖分（有时被称作「实链剖分」），大多数情况下（没有特别说明时），「树链剖分」都指「重链剖分」。\n\n重链剖分可以将树上的任意一条路径划分成不超过 $O(\\log n)$ 条连续的链，每条链上的点深度互不相同（即是自底向上的一条链，链上所有点的 $\\text{LCA}$ 为链的一个端点）。\n\n重链剖分还能保证划分出的每条链上的节点 $\\text{dfs}$ 序连续，因此可以方便地用一些维护序列的数据结构（如线段树）来维护树上路径的信息。\n\n如：\n\n- 修改 树上两点之间的路径上 所有点的值。\n- 查询 树上两点之间的路径上 节点权值的 和/极值/其它（在序列上可以用数据结构维护，便于合并的信息）。\n\n除了配合数据结构来维护树上路径信息，树剖还可以用来 $O(\\log n)$（且常数较小）地求 $\\text{LCA}$。在某些题目中，还可以利用其性质来灵活地运用树剖。\n## 重链剖分\n我们给出一些定义：\n\n定义**重子节点**表示其子节点中子树最大的子结点。如果有多个子树最大的子结点，取其一。如果没有子节点，就无重子节点。\n\n定义**轻子节点**表示剩余的所有子结点。\n\n从这个结点到重子节点的边为**重边**。\n\n到其他轻子节点的边为**轻边**。\n\n若干条首尾衔接的重边构成**重链**。\n\n把落单的结点也当作重链，那么整棵树就被剖分成若干条重链。\n![](https://oi-wiki.org/graph/images/hld.png)\n\n实现\n树剖的实现分两个 DFS 的过程。伪代码如下：\n\n第一个 $\\text{DFS}$ 记录每个结点的父节点（$\\text{father}$）、深度（$\\text{deep}$）、子树大小（$\\text{size}$）、重子节点（$\\text{hson}$）。\n\n$\\begin{array}{l}\n\\text{TREE-BUILD }(u,dep) \\\\\n\\begin{array}{ll}\n1 & u.hson\\gets 0 \\\\\n2 & u.hson.size\\gets 0 \\\\\n3 & u.deep\\gets dep \\\\\n4 & u.size\\gets 1 \\\\\n5 & \\textbf{for }\\text{each }u\\text{'s son }v \\\\\n6 & \\qquad u.size\\gets u.size + \\text{TREE-BUILD }(v,dep+1) \\\\\n7 & \\qquad v.father\\gets u \\\\\n8 & \\qquad \\textbf{if }v.size> u.hson.size \\\\\n9 & \\qquad \\qquad u.hson\\gets v \\\\\n10 & \\textbf{return } u.size\n\\end{array}\n\\end{array}$\n\n第二个 $\\text{DFS}$ 记录所在链的链顶（$\\text{top}$，应初始化为结点本身）、重边优先遍历时的 $\\text{DFS}$ 序（$\\text{dfn}$）、$\\text{DFS}$ 序对应的节点编号（$\\text{rank}$）。\n\n$\\begin{array}{l}\n\\text{TREE-DECOMPOSITION }(u,top) \\\\\n\\begin{array}{ll}\n1 & u.top\\gets top \\\\\n2 & tot\\gets tot+1\\\\\n3 & u.dfn\\gets tot \\\\\n4 & rank(tot)\\gets u \\\\\n5 & \\textbf{if }u.hson\\text{ is not }0 \\\\\n6 & \\qquad \\text{TREE-DECOMPOSITION }(u.hson,top) \\\\\n7 & \\qquad \\textbf{for }\\text{each }u\\text{'s son }v \\\\\n8 & \\qquad \\qquad \\textbf{if }v\\text{ is not }u.hson \\\\\n9 & \\qquad \\qquad \\qquad \\text{TREE-DECOMPOSITION }(v,v) \n\\end{array}\n\\end{array}$\n\n以下为代码实现。\n\n我们先给出一些定义：\n\n$fa[x]$ 表示节点 $x$ 在树上的父亲。\n$dep[x]$ 表示节点 $x$ 在树上的深度。\n$siz[x]$ 表示节点 $x$ 的子树的节点个数。\n$son[x]$ 表示节点 $x$ 的 重儿子。\n$top[x]$ 表示节点 $x$ 所在 重链 的顶部节点（深度最小）。\n$dfn[x]$ 表示节点 $x$ 的 $\\text{DFS}$  序，也是其在线段树中的编号。\n$rnk[x]$ 表示 $\\text{DFS}$ 序所对应的节点编号，有 $rnk[dfn[x]]=x$。\n我们进行两遍 $\\text{DFS}$  预处理出这些值，其中第一次 $\\text{DFS}$ 求出 $fa[x]$，$dep[x]$，$siz[x]$，$son[x]$，第二次 $\\text{DFS}$  求出 $top[x]$，$dfn[x]$，$rnk[x]$。\n```cpp\ninline void dfs1(const int o){\n  son[o]=-1,siz[o]=1;\n  for (int j=h[o];j; j = nxt[j])\n    if (!dep[p[j]]) {\n      dep[p[j]] = dep[o] + 1;\n      fa[p[j]] = o;\n      dfs1(p[j]);\n      siz[o] += siz[p[j]];\n      if (son[o] == -1 || siz[p[j]] > siz[son[o]]) son[o] = p[j];\n    }\n}\n\nvoid dfs2(int o, int t) {\n  top[o] = t;\n  cnt++;\n  dfn[o] = cnt;\n  rnk[cnt] = o;\n  if (son[o] == -1) return;\n  dfs2(son[o], t);  // 优先对重儿子进行 DFS，可以保证同一条重链上的点 DFS 序连续\n  for (int j = h[o]; j; j = nxt[j])\n    if (p[j] != son[o] && p[j] != fa[o]) dfs2(p[j], p[j]);\n}\n```\n### 重链剖分的性质\n树上每个节点都属于且仅属于一条重链。\n\n重链开头的结点不一定是重子节点（因为重边是对于每一个结点都有定义的）。\n\n所有的重链将整棵树**完全剖分**。\n\n在剖分时 重边优先遍历，最后树的 $\\text{DFS}$ 序上，重链内的 $\\text{DFS}$ 序是连续的。按 $\\text{DFN}$ 排序后的序列即为剖分后的链。\n\n一颗子树内的 $\\text{DFS}$ 序是连续的。\n\n可以发现，当我们向下经过一条**轻边**时，所在子树的大小至少会 $\\div 2$。\n\n因此，对于树上的任意一条路径，把它拆分成从 $\\text{LCA}$ 分别向两边往下走，分别最多走 $O(\\log n)$ 次，因此，树上的每条路径都可以被拆分成不超过 $O(\\log n)$ 条重链。\n\n用树链剖分求树上两点路径权值和，伪代码如下：\n\n$\\begin{array}{l}\n\\text{TREE-PATH-SUM }(u,v) \\\\\n\\begin{array}{ll}\n1 & tot\\gets 0 \\\\\n2 & \\textbf{while }u.top\\text{ is not }v.top \\\\\n3 & \\qquad \\textbf{if }u.top.deep< v.top.deep \\\\\n4 & \\qquad \\qquad \\text{SWAP}(u, v) \\\\\n5 & \\qquad tot\\gets tot + \\text{sum of values between }u\\text{ and }u.top \\\\\n6 & \\qquad u\\gets u.top.father \\\\\n7 & tot\\gets tot + \\text{sum of values between }u\\text{ and }v \\\\\n8 & \\textbf{return } tot \n\\end{array}\n\\end{array}$\n\n链上的 $\\text{DFS}$ 序是连续的，可以使用线段树、树状数组维护。\n\n每次选择深度较大的链往上跳，直到两点在同一条链上。\n\n同样的跳链结构适用于维护、统计路径上的其他信息。\n\n子树维护\n有时会要求，维护子树上的信息，譬如将以 x 为根的子树的所有结点的权值增加 $v$。\n\n在 $\\text{DFS}$ 搜索的时候，子树中的结点的 $\\text{DFS}$ 序是连续的。\n\n每一个结点记录 $bottom$ 表示所在子树连续区间末端的结点。\n\n这样就把子树信息转化为连续的一段区间信息。\n\n求最近公共祖先\n不断向上跳重链，当跳到同一条重链上时，深度较小的结点即为 $\\text{LCA}$。\n\n向上跳重链时需要先跳所在重链顶端深度较大的那个。\n```cpp\ninline int lca(const int u,const int v){\n    while(top[u]!=top[v]){\n        if(dep[top[u]]>dep[top[v]]) u=fa[top[u]];\n        else v=fa[top[v]];\n    }\n    return dep[u]>dep[v]?v:u;\n}\n```\n\n## 长链剖分\n长链剖分本质上就是另外一种链剖分方式。\n\n定义 重子节点 表示其子节点中子树深度最大的子结点。如果有多个子树最大的子结点，取其一。如果没有子节点，就无重子节点。\n\n定义**轻子节点**表示剩余的子结点。\n\n从这个结点到重子节点的边为**重边**。\n\n到其他轻子节点的边为**轻边**。\n\n若干条首尾衔接的重边构成**重链**。\n\n把落单的结点也当作重链，那么整棵树就被剖分成若干条重链。\n\n如图（这种剖分方式既可以看成重链剖分也可以看成长链剖分）：\n![](https://oi-wiki.org/graph/images/hld.png)\n长链剖分实现方式和重链剖分类似，这里就不再展开。\n\n### 长链剖分求 k 级祖先\n即询问一个点向父亲跳 $k$ 次跳到的节点。\n\n首先我们假设我们已经预处理了每一个节点的 $2^i$ 级祖先。\n\n现在我们假设我们找到了询问节点的 $2^i$ 级祖先满足 $2^i \\le k < 2^{i+1}$。\n\n我们考虑求出其所在重链的节点并且按照深度列入表格。假设重链长度为 $d$。\n\n同时我们在预处理的时候找到每条重链的根节点的 $1$ 到 $d$ 级祖先，同样放入表格。\n\n根据长链剖分的性质，$k-2^i \\le 2^i \\leq d$, 也就是说，我们可以 $O(1)$ 在这条重链的表格上求出的这个节点的 k 级祖先。\n\n预处理需要倍增出 $2^i$ 次级祖先，同时需要预处理每条重链对应的表格。\n\n预处理复杂度 $O(n\\log n)$, 询问复杂度 $O(1)$。\n\n### *[Luogu P3384 【模板】重链剖分/树链剖分](https://www.luogu.com.cn/problem/P3384)*\n如题，已知一棵包含 $N$ 个结点的树（连通且无环），每个节点上包含一个数值，需要支持以下操作：\n\n- ```1 x y z```，表示将树从 $x$ 到 $y$ 结点最短路径上所有节点的值都加上 $z$。\n\n- ```2 x y```，表示求树从 $x$ 到 $y$ 结点最短路径上所有节点的值之和。\n\n- ```3 x z```，表示将以 $x$ 为根节点的子树内所有节点值都加上 $z$。\n\n- ```4 x``` 表示求以 $x$ 为根节点的子树内所有节点值之和。\n\n**Code**\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e5+5;\nstruct E{int to,next;}edge[N<<1];\nint n,m,rt,mod,w[N],a[N],head[N],cnt;\ninline void add(const int u,const int v){\n    edge[++cnt].next=head[u];\n    edge[cnt].to=v;\n    head[u]=cnt;\n}\nnamespace rw{\n    inline int read(){\n        int tot=0,t=1;char ch=getchar();\n        while(ch<'0'||ch>'9'){if(ch=='-') t=-1;ch=getchar();}\n        while(ch>='0'&&ch<='9'){tot=tot*10+ch-'0';ch=getchar();}\n        return tot*t;\n    }\n    inline void write(int x){\n        if(x<0) putchar('-'),x=-x;\n        static int sta[35];int top=0;\n        do{sta[top++]=x%10,x/=10;}while(x);\n        while(top) putchar(sta[--top]+'0');\n    }\n    inline void file(){\n        freopen(\".in\",\"r\",stdin);\n        freopen(\".out\",\"w\",stdout);\n    }\n    inline void print(const int x,const char ch){return (write(x),putchar(ch)),void(0);}\n}using namespace rw;\nnamespace SGT{\n    struct node{int l,r,sum,size,tag;}tree[N<<2];\n    inline void pushup(const int p){tree[p].sum=(tree[p<<1].sum+tree[p<<1|1].sum)%mod;}\n    inline void maketag(const int p,const int num){\n        tree[p].sum=(tree[p].sum+tree[p].size*num)%mod;\n        tree[p].tag=(tree[p].tag+num)%mod;\n    }\n    inline void pushdown(const int p){\n        if(tree[p].tag){\n            maketag(p<<1,tree[p].tag),maketag(p<<1|1,tree[p].tag);\n            tree[p].tag=0;\n        }\n    }\n    inline void build(const int p,const int l,const int r){\n        tree[p].l=l,tree[p].r=r,tree[p].size=r-l+1;\n        if(l==r) return tree[p].sum=w[l]%mod,void(0);\n        int mid=(l+r)>>1;\n        build(p<<1,l,mid);\n        build(p<<1|1,mid+1,r);\n        pushup(p);\n    }\n    inline void update(const int p,const int l,const int r,const int num){\n        if(l<=tree[p].l&&tree[p].r<=r) return maketag(p,num),void(0);\n        pushdown(p);int mid=(tree[p].l+tree[p].r)>>1;\n        if(l<=mid) update(p<<1,l,r,num);\n        if(r>mid) update(p<<1|1,l,r,num);\n        pushup(p);\n    }\n    inline int ask(const int p,const int l,const int r){\n        if(l<=tree[p].l&&tree[p].r<=r) return tree[p].sum;\n        pushdown(p);int mid=(tree[p].l+tree[p].r)>>1,res=0;\n        if(l<=mid) res=(res+ask(p<<1,l,r))%mod;\n        if(r>mid) res=(res+ask(p<<1|1,l,r))%mod;\n        return res; \n    }\n}\nnamespace HLD{\n    int dep[N],siz[N],fa[N],son[N],dfn[N],top[N],idx;\n    inline void dfs1(const int u,const int f){\n        dep[u]=dep[f]+1;siz[u]=1;fa[u]=f;\n        int maxn=-1;\n        for(int i=head[u];i;i=edge[i].next){\n            int v=edge[i].to;\n            if(f==v) continue;\n            dfs1(v,u);\n            siz[u]+=siz[v];\n            if(siz[son[u]]<siz[v]) son[u]=v;\n        }\n    }\n    inline void dfs2(const int u,const int f){\n        dfn[u]=++idx,w[idx]=a[u],top[u]=f;\n        if(!son[u]) return;dfs2(son[u],f);\n        for(int i=head[u];i;i=edge[i].next){\n            int v=edge[i].to;\n            if(!dfn[v]) dfs2(v,v);\n        }\n    }\n    inline void update(int x,int y,int num){\n        while(top[x]!=top[y]){\n            if(dep[top[x]]<dep[top[y]]) swap(x,y);\n            SGT::update(1,dfn[top[x]],dfn[x],num);\n            x=fa[top[x]];\n        }\n        if(dep[x]>dep[y]) swap(x,y);\n        SGT::update(1,dfn[x],dfn[y],num);\n    }\n    inline int ask(int x,int y){\n        int res=0;\n        while(top[x]!=top[y]){\n            if(dep[top[x]]<dep[top[y]]) swap(x,y);\n            res=(res+SGT::ask(1,dfn[top[x]],dfn[x]))%mod;\n            x=fa[top[x]];\n        }\n        if(dep[x]>dep[y]) swap(x,y);\n        res=(res+SGT::ask(1,dfn[x],dfn[y]))%mod;\n        return res;\n    }\n    inline void init(){dfs1(rt,0);dfs2(rt,rt);}\n}\nsigned main(){\n    n=read(),m=read(),rt=read(),mod=read();\n    for(int i=1;i<=n;i++) a[i]=read();\n    for(int i=1;i<n;i++){\n        int u=read(),v=read();\n        add(u,v),add(v,u);\n    }\n    HLD::init();SGT::build(1,1,n);\n    while(m--){\n        int op=read();\n        if(op==1){\n            int x=read(),y=read(),z=read()%mod;\n            HLD::update(x,y,z);\n        }\n        if(op==2){\n            int x=read(),y=read();\n            print(HLD::ask(x,y),'\\n');\n        }\n        if(op==3){\n            int x=read(),z=read()%mod;\n            SGT::update(1,HLD::dfn[x],HLD::dfn[x]+HLD::siz[x]-1,z);\n        }\n        if(op==4){\n            int x=read();\n            print(SGT::ask(1,HLD::dfn[x],HLD::dfn[x]+HLD::siz[x]-1),'\\n');\n        }\n    }\n    return 0;\n}\n```\n\n## 长链剖分\n长链剖分本质上就是另外一种链剖分方式。\n\n定义 重子节点 表示其子节点中子树深度最大的子结点。如果有多个子树最大的子结点，取其一。如果没有子节点，就无重子节点。\n\n定义**轻子节点**表示剩余的子结点。\n\n从这个结点到重子节点的边为**重边**。\n\n到其他轻子节点的边为**轻边**。\n\n若干条首尾衔接的重边构成**重链**。\n\n把落单的结点也当作重链，那么整棵树就被剖分成若干条重链。\n\n如图（这种剖分方式既可以看成重链剖分也可以看成长链剖分）：\n![](https://oi-wiki.org/graph/images/hld.png)\n长链剖分实现方式和重链剖分类似，这里就不再展开。\n\n### 长链剖分求 k 级祖先\n即询问一个点向父亲跳 $k$ 次跳到的节点。\n\n首先我们假设我们已经预处理了每一个节点的 $2^i$ 级祖先。\n\n现在我们假设我们找到了询问节点的 $2^i$ 级祖先满足 $2^i \\le k < 2^{i+1}$。\n\n我们考虑求出其所在重链的节点并且按照深度列入表格。假设重链长度为 $d$。\n\n同时我们在预处理的时候找到每条重链的根节点的 $1$ 到 $d$ 级祖先，同样放入表格。\n\n根据长链剖分的性质，$k-2^i \\le 2^i \\leq d$, 也就是说，我们可以 $O(1)$ 在这条重链的表格上求出的这个节点的 k 级祖先。\n\n预处理需要倍增出 $2^i$ 次级祖先，同时需要预处理每条重链对应的表格。\n\n预处理复杂度 $O(n\\log n)$, 询问复杂度 $O(1)$。","src/content/posts/Tree.md","3478db999811f9e6",{html:236,metadata:237},"<hr>\n<section><h1 id=\"dfs-序\">dfs 序<a class=\"anchor\" href=\"#dfs-序\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>对于一棵树，我们从根节点处开始 dfs，过程中在每个点第一次遇到的时候把它记录下来，就得到了一棵树的 dfs 序，一般记作 dfn。</p><p>它有一个优势在于一棵子树中的节点在 dfs 序上是连续的，这可以帮我们解决很多子树修改、子树查询问题。</p><hr><section><h2 id=\"例题\">例题：<a class=\"anchor\" href=\"#例题\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2></section><section><h2 id=\"子树加子树求和\">子树加子树求和<a class=\"anchor\" href=\"#子树加子树求和\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>给出一棵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个节点的树，以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 为根，初始时所有点的点权均为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 次操作，每次操作给出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">u,x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>，你需要给子树 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 中的所有点点权都加上 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>，然后输出子树 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 的点权和。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>q</mi><mo>≤</mo><mn>5</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,q\\le 5\\times10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></p><hr><p>求出树的 dfn 后该问题就变成了区间加、区间求和问题，线段树维护即可。</p><hr></section><section><h2 id=\"nearest-leaf\"><a href=\"https://www.luogu.com.cn/problem/CF1110F\">Nearest Leaf</a><a class=\"anchor\" href=\"#nearest-leaf\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Difficulty:<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2600</mn></mrow><annotation encoding=\"application/x-tex\">2600</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2600</span></span></span></span></p><p>给定一棵树，边有边权，保证其有一种 dfn 为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1,2,3,\\dots ,n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>。</p><p>保证 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 号节点不是叶子。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 次询问，每次给定 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo separator=\"true\">,</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">x,l,r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span>，你需要求出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><munder><mrow><mi>min</mi><mo>⁡</mo></mrow><mrow><mi>i</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi><mo stretchy=\"false\">]</mo><mo separator=\"true\">,</mo><mi>i</mi><mtext>是叶子</mtext></mrow></munder><mi>d</mi><mi>i</mi><mi>s</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\min\\limits_{i\\in [l,r],i \\text{是叶子}}dis(x,i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.716em;vertical-align:-0.966em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6679em;\"><span style=\"top:-2.309em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">∈</span><span class=\"mopen mtight\">[</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose mtight\">]</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord text mtight\"><span class=\"mord cjk_fallback mtight\">是叶子</span></span></span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\">min</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.966em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">s</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">)</span></span></span></span> 。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>5</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><mi>m</mi><mo>≤</mo><mn>5</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">3\\le n\\le 5\\times10^5,1\\le m\\le 5\\times 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0085em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></p><hr><p>考虑一个弱化的问题：如果查询的始终是根节点，那么我们只需求出每个点到根节点的距离，然后查询就变成了一个区间最小值问题。</p><p>回到原题，此处涉及一个换根的问题，如果要把根节点换成一个相邻的节点，经过一条长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span> 的边到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span>，那么每个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 子树内的点，它到根的距离会减少 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span>，其余节点到根的距离会增加 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span>，这就是一个子树加减的操作，所以直接用线段树维护子树加，子树最小值即可。</p><hr></section></section>\n<section><h1 id=\"欧拉序\">欧拉序<a class=\"anchor\" href=\"#欧拉序\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>在上述 dfs 的过程中，每次进入一个节点就把它记下来，得到的长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo stretchy=\"false\">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">2(n-1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 的序列为欧拉序。</p><p>如果把欧拉序首尾拼接可以得到一个环，选择不同的断点可以得到不同的根下所得的欧拉序，所以欧拉序的换根是方便的。</p><hr></section>\n<section><h1 id=\"最近公共祖先\">最近公共祖先<a class=\"anchor\" href=\"#最近公共祖先\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">u,v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 的公共祖先中深度最大的节点被称为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">u,v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 的最近公共祖先，一般记作 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">lca</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\operatorname{lca}(u,v)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">lca</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span></span></span></span>。</p><hr><p>在欧拉序中，设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">u,v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 最早出现的位置分别为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>d</mi><msub><mi>x</mi><mi>u</mi></msub><mo separator=\"true\">,</mo><mi>i</mi><mi>d</mi><msub><mi>x</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">idx_u,idx_v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，不妨设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>d</mi><msub><mi>x</mi><mi>u</mi></msub><mo>≤</mo><mi>i</mi><mi>d</mi><msub><mi>x</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">idx_u\\le idx_v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，那么它们的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">lca</mi><mo>⁡</mo></mrow><annotation encoding=\"application/x-tex\">\\operatorname{lca}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">lca</span></span></span></span></span> 一定出现在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>i</mi><mi>d</mi><msub><mi>x</mi><mi>u</mi></msub><mo separator=\"true\">,</mo><mi>i</mi><mi>d</mi><msub><mi>x</mi><mi>v</mi></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[idx_u,idx_v]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span> 中，而更浅的祖先不会，所以这就转化为了一个区间最小值问题，可以配合 ST 表做到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 求 LCA。</p><p>在 dfn 中，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>i</mi><mi>d</mi><msub><mi>x</mi><mi>u</mi></msub><mo separator=\"true\">,</mo><mi>i</mi><mi>d</mi><msub><mi>x</mi><mi>v</mi></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[idx_u,idx_v]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span> 中一定会出现它们 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">lca</mi><mo>⁡</mo></mrow><annotation encoding=\"application/x-tex\">\\operatorname{lca}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">lca</span></span></span></span></span> 的一个子节点，那么我们也只需求出区间最小值，然后返回它的父亲节点即可，注意要特判 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 子树中的情况，或者，你也可以询问 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>i</mi><mi>d</mi><msub><mi>x</mi><mi>u</mi></msub><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>i</mi><mi>d</mi><msub><mi>x</mi><mi>v</mi></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[idx_u+1,idx_v]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span> 中的最小值，这样只需要特判 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo>=</mo><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">u=v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 就可以。</p><hr><p>考虑对于每个节点，我们预处理出他的所有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span></span> 级节点。</p><p>对于两个相同深度的节点，我们可以将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">\\log_2n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9386em;vertical-align:-0.2441em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.207em;\"><span style=\"top:-2.4559em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2441em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 起依次减少，每次判断 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">u,v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span></span> 级祖先是否相同，如果不同，则将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">u,v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 同时跳到它们的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span></span> 级祖先，最后再求出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">u,v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 两者的父亲即可。</p><p>对于两个深度不同的节点，我们可以先将深度较大的节点向上跳到和另一节点同一高度，然后再用上面的做法。</p><p>这个做法是单 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>log</mi><mo>⁡</mo></mrow><annotation encoding=\"application/x-tex\">\\log</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span></span></span></span> 的。</p><hr><section><h2 id=\"company\"><a href=\"https://www.luogu.com.cn/problem/CF1062E\">Company</a><a class=\"anchor\" href=\"#company\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Difficulty:<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2300</mn></mrow><annotation encoding=\"application/x-tex\">2300</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2300</span></span></span></span></p><p>给定一颗树，有若干个询问，每个询问给出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span>，要求编号为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mo>∼</mo><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">l\\sim r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span> 的点任意删去一个之后剩余点的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">lca</mi><mo>⁡</mo></mrow><annotation encoding=\"application/x-tex\">\\operatorname{lca}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">lca</span></span></span></span></span> 深度最大，输出删去点的编号和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">lca</mi><mo>⁡</mo></mrow><annotation encoding=\"application/x-tex\">\\operatorname{lca}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">lca</span></span></span></span></span> 的最大深度。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><msup><mn>10</mn><mn>5</mn></msup><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><mi>q</mi><mo>≤</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le n\\le10^5,1\\le q\\le 10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0085em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></p><p>可以做到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>+</mo><mi>q</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log n+q)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mclose\">)</span></span></span></span>。</p><hr><p>考虑区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">lca</mi><mo>⁡</mo></mrow><annotation encoding=\"application/x-tex\">\\operatorname{lca}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">lca</span></span></span></span></span> 怎么求，可以用 st 表或线段树维护，这样的预处理时间复杂度是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><msup><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log^2n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1484em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8984em;\"><span style=\"top:-3.1473em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 的。</p><p>但是这个区间的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">lca</mi><mo>⁡</mo></mrow><annotation encoding=\"application/x-tex\">\\operatorname{lca}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">lca</span></span></span></span></span> 实际上等于其中在 dfn 中的 idx 最大、最小的两个节点的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">lca</mi><mo>⁡</mo></mrow><annotation encoding=\"application/x-tex\">\\operatorname{lca}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">lca</span></span></span></span></span>，可以用 dfn 求 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">lca</mi><mo>⁡</mo></mrow><annotation encoding=\"application/x-tex\">\\operatorname{lca}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">lca</span></span></span></span></span> 的方法直接证明。</p><p>所以可以做到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 预处理，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 查询。</p><p>那么题目中的去掉一个点就是去掉 idx 最大或最小的点，简单分讨即可。</p><hr></section></section>\n<section><h1 id=\"树上距离\">树上距离<a class=\"anchor\" href=\"#树上距离\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>一般定义树上两点之间的唯一一条简单路径的长度为这两点之间的距离。</p><p>不妨设每个点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 到根的距离为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">dep_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">u,v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 之间的距离为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>u</mi></msub><mo>+</mo><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>v</mi></msub><mo>−</mo><mn>2</mn><mi>d</mi><mi>e</mi><msub><mi>p</mi><mrow><mi mathvariant=\"normal\">lca</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">dep_u+dep_v-2dep_{\\operatorname{lca}(u,v)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0496em;vertical-align:-0.3552em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mop mtight\"><span class=\"mord mathrm mtight\">lca</span></span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3552em;\"><span></span></span></span></span></span></span></span></span></span>，可以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 求出。</p><hr></section>\n<section><h1 id=\"树的直径\">树的直径<a class=\"anchor\" href=\"#树的直径\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>（以下的讨论建立于树的边权均为非负数的情况）</p><p>树上最长的链为这棵树的直径，直径可以有多条。</p><p>在前面已经讲了一个换根，维护所有点到根的距离的方式，显然可以做到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 求直径，但是，还能再强一点吗？</p><hr><p>不妨让我们先发现一下直径的性质，我们可以发现：</p><p>对于每个节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span>，以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 为一端的最长链另一端一定是直径的一端，否则可以考虑把这条链的另一端接到直径上去。</p><hr><p>于是我们可以得到一个极简做法：</p><p>随便找一个点，求出离它最远的点，这个点即直径的一个端点。</p><p>然后再求出离这个端点最远的一个点，就是直径的另一个端点。</p><p>时间复杂度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p><hr><p>当然，也不难想到一个 dp 做法，即对于每一个节点，求出它跟子树内离它最远的点之间的距离，然后把两条拼接成一条，不难得到直径，时间复杂度也是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 的。</p><hr><p>或者，我们考虑一条路径的长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>u</mi></msub><mo>+</mo><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>v</mi></msub><mo>−</mo><mn>2</mn><mi>d</mi><mi>e</mi><msub><mi>p</mi><mrow><mi mathvariant=\"normal\">lca</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">dep_u+dep_v-2dep_{\\operatorname{lca}(u,v)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0496em;vertical-align:-0.3552em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mop mtight\"><span class=\"mord mathrm mtight\">lca</span></span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3552em;\"><span></span></span></span></span></span></span></span></span></span>，在欧拉序上，我们只需找到三个位置 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo>≤</mo><mi>q</mi><mo>≤</mo><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">p\\le q\\le r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span>，使得 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>p</mi></msub><mo>+</mo><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>r</mi></msub><mo>−</mo><mn>2</mn><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>q</mi></msub></mrow><annotation encoding=\"application/x-tex\">dep_p+dep_r-2dep_q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 最大即可，可以转化为欧拉序上 dp。</p><hr><section><h2 id=\"例题区间直径\">例题：区间直径<a class=\"anchor\" href=\"#例题区间直径\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>给定一棵树，设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">dis</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\operatorname{dis}(x,y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">dis</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span> 表示节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x,y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 在树上的距离。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 次询问，每次给出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">l,r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span>，求：</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>max</mi><mo>⁡</mo></mrow><mrow><mi>l</mi><mo>≤</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo>≤</mo><mi>r</mi></mrow></msub><mi mathvariant=\"normal\">dis</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\max_{l\\le x,y\\le r}\\operatorname{dis}(x,y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mop\"><span class=\"mop\">max</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">x</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">dis</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span></p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>2</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><mi>q</mi><mo>≤</mo><msup><mn>10</mn><mn>6</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 2\\times10^5,1\\le q\\le 10^6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0085em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span></span></span></p><hr><p>直径是可合并的，如果两个点集中的直径分别为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><mi>p</mi><mo separator=\"true\">,</mo><mi>q</mi><mo stretchy=\"false\">}</mo><mo separator=\"true\">,</mo><mo stretchy=\"false\">{</mo><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{p,q\\},\\{u,v\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord mathnormal\">p</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mclose\">}</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mopen\">{</span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">}</span></span></span></span>，那么两个点集的并集的直径两个端点必定是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo separator=\"true\">,</mo><mi>q</mi><mo separator=\"true\">,</mo><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">p,q,u,v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 中的两个，凭借这个性质，我们可以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 合并两个点集的直径。</p><p>结合 ST 表可以做到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 预处理，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 查询区间直径。</p><hr></section><section><h2 id=\"dynamic-diameter\"><a href=\"https://www.luogu.com.cn/problem/CF1192B\">Dynamic</a><a href=\"https://www.luogu.com.cn/problem/P6845\"> Diameter</a><a class=\"anchor\" href=\"#dynamic-diameter\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>有一棵树，含 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个节点，边带权。</p><p>会有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 次修改，每次会将树上的一条边的边权进行修改，在每次修改后，您需要求出这棵树的直径长度。</p><p><strong>强制在线。</strong></p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>q</mi><mo>≤</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n,q\\le10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></p><hr><p>优化欧拉序上 dp，用线段树维护以下几个值：</p><ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>max</mi><mo>⁡</mo></mrow><mrow><mi>l</mi><mo>≤</mo><mi>x</mi><mo>≤</mo><mi>r</mi></mrow></msub><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\max_{l\\le x\\le r} dep_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9396em;vertical-align:-0.2452em;\"></span><span class=\"mop\"><span class=\"mop\">max</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">x</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2452em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>min</mi><mo>⁡</mo></mrow><mrow><mi>l</mi><mo>≤</mo><mi>x</mi><mo>≤</mo><mi>r</mi></mrow></msub><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\min_{l\\le x\\le r} dep_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9396em;vertical-align:-0.2452em;\"></span><span class=\"mop\"><span class=\"mop\">min</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">x</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2452em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>max</mi><mo>⁡</mo></mrow><mrow><mn>1</mn><mo>≤</mo><mi>x</mi><mo>≤</mo><mi>y</mi><mo>≤</mo><mi>r</mi></mrow></msub><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>x</mi></msub><mo>−</mo><mn>2</mn><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>y</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\max_{1\\le x\\le y\\le r} dep_x-2dep_y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mop\"><span class=\"mop\">max</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">x</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>max</mi><mo>⁡</mo></mrow><mrow><mn>1</mn><mo>≤</mo><mi>x</mi><mo>≤</mo><mi>y</mi><mo>≤</mo><mi>r</mi></mrow></msub><mo>−</mo><mn>2</mn><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>x</mi></msub><mo>+</mo><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>y</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\max_{1\\le x\\le y\\le r} -2dep_x+dep_y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mop\"><span class=\"mop\">max</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">x</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">−</span><span class=\"mord\">2</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>max</mi><mo>⁡</mo></mrow><mrow><mn>1</mn><mo>≤</mo><mi>x</mi><mo>≤</mo><mi>y</mi><mo>≤</mo><mi>z</mi><mo>≤</mo><mi>r</mi></mrow></msub><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>x</mi></msub><mo>−</mo><mn>2</mn><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>y</mi></msub><mo>+</mo><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>z</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\max_{1\\le x\\le y\\le z\\le r} dep_x-2dep_y+dep_z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mop\"><span class=\"mop\">max</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">x</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.04398em;\">z</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.04398em;\">z</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></li>\n</ul><p>维护一个区间加的操作即可。</p><hr><p>很多题目都会出现最长链等关键词，通常这些题目都要用到直径有关的性质。</p><hr></section><section><h2 id=\"roads-and-ramen\"><a href=\"https://www.luogu.com.cn/problem/CF1413F\">Roads and Ramen</a><a class=\"anchor\" href=\"#roads-and-ramen\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Difficulty:<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2800</mn></mrow><annotation encoding=\"application/x-tex\">2800</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2800</span></span></span></span></p><p>给出一棵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个点的树，每条边上有权值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mi mathvariant=\"normal\">/</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">0/1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">0/1</span></span></span></span>，定义路径的长度为路径上边的数量。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 次修改，每次修改会修改一条边的权值，每次修改后回答最长的有偶数个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 的路径长度。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>5</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><mi>q</mi><mo>≤</mo><mn>5</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le n\\le 5\\times10^5,1\\le q\\le 5\\times10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0085em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></p><hr><p>随意定一个根，令点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 到根路径上边权异或和为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>s</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">s_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，那么一条路径 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{x,y\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">}</span></span></span></span> 上有偶数个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 当且仅当 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>s</mi><mi>x</mi></msub><mo>=</mo><msub><mi>s</mi><mi>y</mi></msub></mrow><annotation encoding=\"application/x-tex\">s_x=s_y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>。</p><p>对于直径 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><mi>p</mi><mo separator=\"true\">,</mo><mi>q</mi><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{p,q\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord mathnormal\">p</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mclose\">}</span></span></span></span>，如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>s</mi><mi>p</mi></msub><mo>=</mo><msub><mi>s</mi><mi>q</mi></msub></mrow><annotation encoding=\"application/x-tex\">s_p=s_q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>，那么答案显然就是直径的长度。</p><p>否则，对于任意一个点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span>，由于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>s</mi><mi>p</mi></msub><mo mathvariant=\"normal\">≠</mo><msub><mi>s</mi><mi>q</mi></msub></mrow><annotation encoding=\"application/x-tex\">s_p\\neq s_q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>，则必有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>s</mi><mi>u</mi></msub><mo>=</mo><msub><mi>s</mi><mi>p</mi></msub></mrow><annotation encoding=\"application/x-tex\">s_u=s_p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 或 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>s</mi><mi>u</mi></msub><mo>=</mo><msub><mi>s</mi><mi>q</mi></msub></mrow><annotation encoding=\"application/x-tex\">s_u=s_q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>，所以答案的链的一个端点一定是直径的一个端点。</p><p>用线段树维护区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mi mathvariant=\"normal\">/</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">0/1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">0/1</span></span></span></span> 翻转即可动态维护最长直链，以直径两端为根分别做一遍即可。</p><p>时间复杂度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>+</mo><mi>q</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n+q\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p><hr></section></section>\n<section><h1 id=\"树的中心\">树的中心<a class=\"anchor\" href=\"#树的中心\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>对于一个节点，如果所有节点到它距离的最大值取到最小值，那么这个节点就是树的中心。</p><p>树的中心可以直接考虑求出树的直径，然后找到直径中点即可，时间复杂度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p><hr><section><h2 id=\"tree-compass\"><a href=\"https://www.luogu.com.cn/problem/CF1943C\">Tree Compass</a><a class=\"anchor\" href=\"#tree-compass\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Difficulty:<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2300</mn></mrow><annotation encoding=\"application/x-tex\">2300</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2300</span></span></span></span></p><p>给出一棵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个点的树，初始时所有点都是白色的，每次你可以选择一个点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 和一个非负整数半径 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span>，将树上所有与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 距离为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span> 的点染成黑色，求把所有点染成黑色的最少操作次数，并给出一组方案。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>2</mn><mo>×</mo><msup><mn>10</mn><mn>3</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le2\\times10^3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span></p><p>可以做到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p><hr><p>求出树的直径和中点，设直径长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span>。</p><p>如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span> 为奇数：</p><p>此时有一个中心，对于这个中心操作 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">⌈</mo><mfrac><mi>l</mi><mn>2</mn></mfrac><mo stretchy=\"false\">⌉</mo></mrow><annotation encoding=\"application/x-tex\">\\lceil\\frac{l}{2}\\rceil</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2251em;vertical-align:-0.345em;\"></span><span class=\"mopen\">⌈</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8801em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">⌉</span></span></span></span> 次，可以证明是最优方案。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span> 为偶数时有两个中心，同理操作即可。</p><hr></section></section>\n<section><h1 id=\"树的重心\">树的重心<a class=\"anchor\" href=\"#树的重心\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>对于一个节点，如果删掉这个节点后，所有连通块大小的最大值取到最小值，那么这个节点就是树的重心。</p><hr><p>树的重心有一系列性质：</p><ul>\n<li>树的重心如果不唯一，则至多有两个，且这两个重心相邻。</li>\n<li>以树的重心为根时，所有子树的大小都不超过整棵树大小的一半。</li>\n<li>树中所有点到某个点的距离和中，到重心的距离和是最小的；如果有两个重心，那么到它们的距离和一样。</li>\n<li>把两棵树通过一条边相连得到一棵新的树，那么新的树的重心在连接原来两棵树的重心的路径上。</li>\n<li>在一棵树上添加或删除一个叶子，那么它的重心最多只移动一条边的距离。</li>\n</ul><hr><p>通过以上性质可以推得：设子树 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 的大小为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>i</mi><msub><mi>z</mi><mi>u</mi></msub></mrow><annotation encoding=\"application/x-tex\">siz_u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8095em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.044em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 的子节点中的最大子树大小为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><msub><mi>x</mi><mi>u</mi></msub></mrow><annotation encoding=\"application/x-tex\">mx_u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，则如果某个节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 满足 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>−</mo><mi>s</mi><mi>i</mi><msub><mi>z</mi><mi>u</mi></msub><mo>≤</mo><mfrac><mi>n</mi><mn>2</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">n-siz_u\\le \\frac{n}{2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8095em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.044em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0404em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6954em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span> 且 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><msub><mi>x</mi><mi>u</mi></msub><mo>≤</mo><mfrac><mi>n</mi><mn>2</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">mx_u\\le\\frac{n}{2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.786em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0404em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6954em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>，那么这个节点就是重心，即 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mi>m</mi><msub><mi>x</mi><mi>u</mi></msub><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>2</mn><mi>s</mi><mi>i</mi><msub><mi>z</mi><mi>u</mi></msub></mrow><annotation encoding=\"application/x-tex\">2mx_u\\le n\\le 2siz_u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7944em;vertical-align:-0.15em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">m</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8095em;vertical-align:-0.15em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.044em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p><p>通过上述性质可以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 求出重心。</p><hr><section><h2 id=\"例题kay-and-snowflake\">例题：<a href=\"https://www.luogu.com.cn/problem/CF685B\">Kay and Snowflake</a><a class=\"anchor\" href=\"#例题kay-and-snowflake\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>给出一棵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个节点的树，求每个子树的重心。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>3</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le n\\le 3\\times10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></p><p>可以做到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p><hr><p>我们称一个节点的所有儿子中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>i</mi><mi>z</mi></mrow><annotation encoding=\"application/x-tex\">siz</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span></span></span></span> 最大的节点为它的重儿子，其它的为轻儿子。</p><p>发现对于子树 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span>，它的重心不可能在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 的轻儿子的子树。</p><p>设重儿子为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span>，子树 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 的重心为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mi>e</mi><mi>n</mi><msub><mi>t</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">cent_v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7651em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">ce</span><span class=\"mord mathnormal\">n</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，那么 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mi>e</mi><mi>n</mi><msub><mi>t</mi><mi>u</mi></msub></mrow><annotation encoding=\"application/x-tex\">cent_u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7651em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">ce</span><span class=\"mord mathnormal\">n</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 一定在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mi>e</mi><mi>n</mi><msub><mi>t</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">cent_v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7651em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">ce</span><span class=\"mord mathnormal\">n</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的路径上，因为除了这些点以外的点为根的子树大小都小于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>s</mi><mi>i</mi><msub><mi>z</mi><mi>u</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\frac{1}{2}siz_u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1901em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.044em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p><p>所以直接从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mi>e</mi><mi>n</mi><msub><mi>t</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">cent_v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7651em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">ce</span><span class=\"mord mathnormal\">n</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 开始往上跳即可，每个点最多被跳到一次，所以是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 的。</p><hr></section><section><h2 id=\"csp-s2019-树的重心\"><a href=\"https://www.luogu.com.cn/problem/P5666\">[CSP-S2019] 树的重心</a><a class=\"anchor\" href=\"#csp-s2019-树的重心\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>求对于每条边，删除这条边后产生的两棵树的重心编号和之和，若有多个重心则全都计算。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>7</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>3</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup><mo>−</mo><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">7\\le n\\le 3\\times10^5-5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">7</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">5</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 为奇数。</p><p>可以做到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p><hr><p>通过上一题的做法，我们可以求出每个子树的重心，那么接下来还需考虑去掉每个子树后的重心。</p><p>如果删掉的边不在重子树内，那么原来的重心只会不断走向重儿子，显然删的子树越大跳的越多，把那些子树大小桶排之后直接从重心开始跳即可。</p><p>否则，重心不断向根节点的次重节点移动，同理维护即可。</p><p>需要处理两个重心的细节，时间复杂度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p><hr></section></section>\n<section><h1 id=\"dfs-生成树\">dfs 生成树<a class=\"anchor\" href=\"#dfs-生成树\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>我们对一个图进行 dfs，每一个点搜到后就打标记不再搜，保留搜索通过的边，删掉其它的边可以得到一棵 dfs 生成树。</p><hr><p><img src=\"https://oi-wiki.org/graph/images/bcc-1.svg\" alt=\"\"></p><hr><p>可以证明 dfs 生成树没有横跨边，而 bfs 生成树则没有返祖边。</p><p>dfs 生成树没有横跨边的性质非常优秀，这使我们始终能从下往上处理问题。</p><hr><section><h2 id=\"例题choose-your-queries\">例题：<a href=\"https://www.luogu.com.cn/problem/CF2025F\">Choose Your Queries</a><a class=\"anchor\" href=\"#例题choose-your-queries\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Difficulty:<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2700</mn></mrow><annotation encoding=\"application/x-tex\">2700</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2700</span></span></span></span></p><p>给定长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 的数组 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>，初始全是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 次操作，每次给出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x,y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>，你必须选择以下两种操作中的一种执行：</p><ul>\n<li>将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 或 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>y</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 加一。</li>\n<li>将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 或 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>y</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 减一。</li>\n</ul><p>你需要保证任何时刻，序列中所有数非负，并且最终序列的和最小，求一组方案。\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>3</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><mi>q</mi><mo>≤</mo><mn>3</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">3\\le n\\le3\\times 10^5,1\\le q\\le3\\times10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0085em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span>，可以做到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>+</mo><mi>q</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n+q)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mclose\">)</span></span></span></span>。</p><hr><p>对于二元的条件，很多时候需要使用建图的方式处理。</p><p>对于每对给出的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x,y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>，我们在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 之间连一条边，现在相当于对于每条边都要选一个端点操作，那么对于同一个点，我们一定会交替的选择加一和减一，这样肯定是最优的，那么每次操作相当于选一个点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>01</mn></mrow><annotation encoding=\"application/x-tex\">01</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">01</span></span></span></span> 反转。</p><p>那么我们建出 dfs 生成树，从低往高考虑，对于每个点往上连的所有边，如果这个点是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>，那么就选一条边用来反转他，剩下的所有边都往上反转，否则就直接全都往上反转，由于除了根以外的节点至少有连向父亲的一条边，所以这些点的权值一定是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>，只有根可能是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>，不难证明此时总和达到了最小值。</p><hr><p>值得注意的是，图不一定是连通的，要对每个连通块跑一遍。</p><hr></section><section><h2 id=\"pairs-of-pairs\"><a href=\"https://www.luogu.com.cn/problem/CF1391E\">Pairs of Pairs</a><a class=\"anchor\" href=\"#pairs-of-pairs\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Difficulty:<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2600</mn></mrow><annotation encoding=\"application/x-tex\">2600</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2600</span></span></span></span></p><p>给出一张 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 条边的无向简单连通图，选择以下一个任务完成：</p><ul>\n<li>输出一条长度至少为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">⌈</mo><mfrac><mi>n</mi><mn>2</mn></mfrac><mo stretchy=\"false\">⌉</mo></mrow><annotation encoding=\"application/x-tex\">\\lceil\\frac{n}{2}\\rceil</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.095em;vertical-align:-0.345em;\"></span><span class=\"mopen\">⌈</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6954em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">⌉</span></span></span></span> 的路径。</li>\n<li>选出偶数个点（至少 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">⌈</mo><mfrac><mi>n</mi><mn>2</mn></mfrac><mo stretchy=\"false\">⌉</mo></mrow><annotation encoding=\"application/x-tex\">\\lceil\\frac{n}{2}\\rceil</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.095em;vertical-align:-0.345em;\"></span><span class=\"mopen\">⌈</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6954em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">⌉</span></span></span></span> 个），将它们两两配对，使得每两对中的四个点的导出子图最多有两条边。</li>\n</ul><hr><p>搜出一棵 dfs 生成树，如果有长度大于等于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">⌈</mo><mfrac><mi>n</mi><mn>2</mn></mfrac><mo stretchy=\"false\">⌉</mo></mrow><annotation encoding=\"application/x-tex\">\\lceil\\frac{n}{2}\\rceil</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.095em;vertical-align:-0.345em;\"></span><span class=\"mopen\">⌈</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6954em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">⌉</span></span></span></span> 的直链，那么直接输出。</p><p>否则，把每个点按深度归类，将每个深度中的点两两配对，这样每个深度中只有最多一个点没有被配对，而最大深度不超过 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">⌊</mo><mfrac><mi>n</mi><mn>2</mn></mfrac><mo stretchy=\"false\">⌋</mo></mrow><annotation encoding=\"application/x-tex\">\\lfloor\\frac{n}{2}\\rfloor</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.095em;vertical-align:-0.345em;\"></span><span class=\"mopen\">⌊</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6954em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">⌋</span></span></span></span>，那么就有至少 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">⌈</mo><mfrac><mi>n</mi><mn>2</mn></mfrac><mo stretchy=\"false\">⌉</mo></mrow><annotation encoding=\"application/x-tex\">\\lceil\\frac{n}{2}\\rceil</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.095em;vertical-align:-0.345em;\"></span><span class=\"mopen\">⌈</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6954em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">⌉</span></span></span></span> 个点被配对，而 dfs 生成树没有横跨边，所以每两对中的四个点的导出子图最多有两条边。</p><hr></section></section>\n<section><h1 id=\"树上启发式合并\">树上启发式合并<a class=\"anchor\" href=\"#树上启发式合并\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>众所周知并查集有两种优化方式，一种是路径压缩，一种是按秩合并，那么在按秩合并的过程中，每次我们会把大小较小的集合合并到较大的集合中，这看上去很暴力，但是它的复杂度就是对的，这是<strong>启发式合并</strong>的思想。</p><p>这种思想在树上问题中会比较常见，当对于每个节点，我们需要合并它所有子节点的答案来得到它本身的答案的时候，经常会用到<strong>树上启发式合并</strong>。</p><hr><section><h2 id=\"例题lomsat-gelral\">例题：<a href=\"https://www.luogu.com.cn/problem/CF600E\">Lomsat gelral</a><a class=\"anchor\" href=\"#例题lomsat-gelral\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Difficulty:<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2300</mn></mrow><annotation encoding=\"application/x-tex\">2300</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2300</span></span></span></span></p><p>给出一棵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个点的有根树，点有点权，对于每棵子树，求出其中点权的所有众数之和。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><msup><mn>10</mn><mn>5</mn></msup><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><mtext>点权</mtext><mo>≤</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 10^5,1\\le \\text{点权}\\le n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0085em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord text\"><span class=\"mord cjk_fallback\">点权</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>。</p><hr><p>考虑维护每个点权出现的次数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">cnt</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span></span></span></span>，同时不难维护答案，如果直接去合并 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">cnt</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span></span></span></span> 会比较困难。</p><p>可以考虑每个节点都可以继承一个儿子的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">cnt</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span></span></span></span> 数组，然后对于其它的儿子，将那些子树都跑一遍并更新 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">cnt</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span></span></span></span>，只要每次继承子树大小最大的儿子即可，时间复杂度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p><hr><p>复杂度分析：</p><p>我们考虑只保留每个点到重儿子的边，把其他边都删了，那么维护每一个连通块的答案总复杂度是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 的，接下来考虑重新更新 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">cnt</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span></span></span></span> 的复杂度。</p><p>每次我们更新一次 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">cnt</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span></span></span></span> 就把这个连通块连到父亲上，由于这个连通块不是这个父亲的重儿子，所以连通块大小一定会翻倍，那么对于每个节点，它所在的连通块大小只会翻倍 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 次，所以每个点的更新次数都是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 次，总复杂度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p><hr></section><section><h2 id=\"arpas-letter-marked-tree-and-mehrdads-dokhtar-kosh-paths\"><a href=\"https://www.luogu.com.cn/problem/CF741D\">Arpa’s letter-marked tree and Mehrdad’s Dokhtar-kosh paths</a><a class=\"anchor\" href=\"#arpas-letter-marked-tree-and-mehrdads-dokhtar-kosh-paths\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Difficulty:<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2900</mn></mrow><annotation encoding=\"application/x-tex\">2900</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2900</span></span></span></span></p><p>给定一棵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个点的树，根为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>，每条边上有一个字符（a 到 v 共 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>22</mn></mrow><annotation encoding=\"application/x-tex\">22</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">22</span></span></span></span> 种）。一条简单路径被称为 Dokhtar-kosh，当且仅当路径上的字符经过重新排序后可以变成一个回文串。 求每个子树中最长的 Dokhtar-kosh 路径的长度。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>5</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">1\\le n\\le 5\\times10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></p><hr><p>首先发现一个字符串能重排成回文串当且仅当有最多一个字符出现了奇数次。</p><p>我们用一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mo>∼</mo><msup><mn>2</mn><mn>22</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">0\\sim2^{22}-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">22</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 之间的数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">val_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示一个点到根路径上每种字母出现了奇数次还是偶数次，那么从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 的路径上的信息就是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>x</mi></msub><mi mathvariant=\"normal\">xor</mi><mo>⁡</mo><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>y</mi></msub></mrow><annotation encoding=\"application/x-tex\">val_x\\operatorname{xor}val_y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">xor</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>。</p><p>那么也就是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>x</mi></msub><mi mathvariant=\"normal\">xor</mi><mo>⁡</mo><mi>v</mi><mi>a</mi><msub><mi>l</mi><mi>y</mi></msub></mrow><annotation encoding=\"application/x-tex\">val_x\\operatorname{xor}val_y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">xor</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 等于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> 或 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>p</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6644em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span></span></span></span></span></span></span></span> 时合法。</p><p>直接用一个数组记录每个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">val</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span> 在子树内的最大深度，转移这个数组即可，时间复杂度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi mathvariant=\"normal\">∣</mi><mi mathvariant=\"normal\">Σ</mi><mi mathvariant=\"normal\">∣</mi><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(|\\Sigma|n\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">∣Σ∣</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p><hr></section></section>\n<section><h1 id=\"树上随机游走\">树上随机游走<a class=\"anchor\" href=\"#树上随机游走\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>一张图的随机游走问题一般复杂度是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^3)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>，但是由于树的优秀性质，所以在此类问题上复杂度通常为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p><hr><p>有时候，我们可以把走一条路径的贡献拆成其中每一条边的贡献。</p><hr><section><h2 id=\"alices-adventures-in-the-rabbit-hole\"><a href=\"https://www.luogu.com.cn/problem/CF2028E\">Alice’s Adventures in the Rabbit Hole</a><a class=\"anchor\" href=\"#alices-adventures-in-the-rabbit-hole\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Difficulty:<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2300</mn></mrow><annotation encoding=\"application/x-tex\">2300</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2300</span></span></span></span></p><p>给出一棵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个点的树，初始时棋子在节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>，每次有相同的概率选 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi><mo separator=\"true\">,</mo><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">A,B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span> 中的一人操作，操作为将棋子往相邻的一条边移动，若棋子移到根则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> 胜，若棋子移到叶子则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span> 胜，若两人都以最优决策操作，对于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>=</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">x=1,2,\\dots,n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>，分别求出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> 赢的概率，答案对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">998244353</span></span></span></span> 取模。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>2</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le n\\le2\\times10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></p><p>可以做到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p><hr><p>考虑如果树是一条直链，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> 赢的概率是多少？</p><p>实际上等于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>n</mi><mo>−</mo><mi>d</mi><mi>e</mi><msub><mi>p</mi><mi>x</mi></msub></mrow><mi>n</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{n-dep_x}{n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2772em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9322em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4461em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">−</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>。</p><p>那么如果现在对于节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>，在子树中深度最浅的叶子到他的距离为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">len</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span></span></span></span>，那么在不到达叶子的情况下，它能往上走一步的概率为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>l</mi><mi>e</mi><mi>n</mi><mo>+</mo><mn>1</mn></mrow><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{len+1}{len}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2251em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8801em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">n</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>，设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 处开始 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> 能赢的概率，则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>x</mi></msub><mo>=</mo><mfrac><mrow><mi>l</mi><mi>e</mi><mi>n</mi><mo>+</mo><mn>1</mn></mrow><mrow><mi>l</mi><mi>e</mi><mi>n</mi></mrow></mfrac><msub><mi>f</mi><mrow><mi>f</mi><msub><mi>a</mi><mi>x</mi></msub></mrow></msub></mrow><annotation encoding=\"application/x-tex\">f_x=\\frac{len+1}{len}f_{fa_x}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.2251em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8801em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">n</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>，直接 dp 即可。</p><hr><p>也有时候，我们不能简单地处理贡献。</p><hr></section><section><h2 id=\"例题random-walk\">例题：<a href=\"https://www.luogu.com.cn/problem/CF1823F\">Random Walk</a><a class=\"anchor\" href=\"#例题random-walk\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Difficulty:<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2600</mn></mrow><annotation encoding=\"application/x-tex\">2600</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2600</span></span></span></span></p><p>给出一棵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个点的树和起点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span>，终点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span>，求从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span> 开始随机游走，经过每个点的期望次数，答案对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">998244353</span></span></span></span> 取模。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><mn>2</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">2\\le n\\le 2\\times10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></p><hr><p>我们设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">dp_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示期望经过 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 点的次数，那么对于除了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span> 之外的节点，有：</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mi>i</mi></msub><mo>=</mo><msub><mo>∑</mo><mrow><mo stretchy=\"false\">{</mo><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo stretchy=\"false\">}</mo><mo>∈</mo><mi>E</mi><mo>∧</mo><mi>j</mi><mo mathvariant=\"normal\">≠</mo><mi>t</mi></mrow></msub><mfrac><mrow><mi>d</mi><msub><mi>p</mi><mi>j</mi></msub></mrow><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>j</mi></msub></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">dp_i=\\sum_{\\{i,j\\}\\in E\\land j\\neq t}\\frac{dp_j}{deg_j}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.5357em;vertical-align:-0.5423em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2253em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">{</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mclose mtight\">}</span><span class=\"mrel mtight\">∈</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">E</span><span class=\"mbin mtight\">∧</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\"><span class=\"mrel mtight\"><span class=\"mord vbox mtight\"><span class=\"thinbox mtight\"><span class=\"rlap mtight\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord mtight\"><span class=\"mrel mtight\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel mtight\">=</span></span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4747em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9934em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.5073em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5423em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></p><p>其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>j</mi></msub></mrow><annotation encoding=\"application/x-tex\">deg_j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 表示节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span></span> 的度数。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mi>s</mi></msub></mrow><annotation encoding=\"application/x-tex\">dp_s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是上述的式子加一而 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">dp_t=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2806em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">t</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>。</p><p>发现这个式子没法转移。</p><hr><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mi>i</mi></msub><mo>=</mo><msub><mo>∑</mo><mrow><mo stretchy=\"false\">{</mo><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo stretchy=\"false\">}</mo><mo>∈</mo><mi>E</mi><mo>∧</mo><mi>j</mi><mo mathvariant=\"normal\">≠</mo><mi>t</mi></mrow></msub><mfrac><mrow><mi>d</mi><msub><mi>p</mi><mi>j</mi></msub></mrow><mrow><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>j</mi></msub></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">dp_i=\\sum_{\\{i,j\\}\\in E\\land j\\neq t}\\frac{dp_j}{deg_j}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.5357em;vertical-align:-0.5423em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2253em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">{</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mclose mtight\">}</span><span class=\"mrel mtight\">∈</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">E</span><span class=\"mbin mtight\">∧</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\"><span class=\"mrel mtight\"><span class=\"mord vbox mtight\"><span class=\"thinbox mtight\"><span class=\"rlap mtight\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord mtight\"><span class=\"mrel mtight\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel mtight\">=</span></span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4747em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9934em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.5073em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5423em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></p><p>重新观察一下这个式子，我们虽然没有办法快速转移这个式子，但是我们可以方便地将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">dp_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub><mo>×</mo><mi>d</mi><msub><mi>p</mi><mrow><mi>f</mi><msub><mi>a</mi><mi>i</mi></msub></mrow></msub><mo>+</mo><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">k_i\\times dp_{fa_i}+b_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的形式。</p><p>首先叶子结点可以直接表示，然后对于每个节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span>，如果它的所有子节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mi>j</mi></msub></mrow><annotation encoding=\"application/x-tex\">dp_j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 都已经被表示成 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>k</mi><mi>j</mi></msub><mo>×</mo><mi>d</mi><msub><mi>p</mi><mi>i</mi></msub><mo>+</mo><msub><mi>b</mi><mi>j</mi></msub></mrow><annotation encoding=\"application/x-tex\">k_j\\times dp_i+b_j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>，那么直接代入到上面的式子里，这个式子就会变成一个只跟 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">dp_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mrow><mi>f</mi><msub><mi>a</mi><mi>i</mi></msub></mrow></msub></mrow><annotation encoding=\"application/x-tex\">dp_{fa_i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 有关的等式，那么显然可以将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">dp_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub><mo>×</mo><mi>d</mi><msub><mi>p</mi><mrow><mi>f</mi><msub><mi>a</mi><mi>i</mi></msub></mrow></msub><mo>+</mo><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">k_i\\times dp_{fa_i}+b_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的形式。</p><p>发现根节点没有父亲，所以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mrow><mi>r</mi><mi>o</mi><mi>o</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>b</mi><mrow><mi>r</mi><mi>o</mi><mi>o</mi><mi>t</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">dp_{root}=b_{root}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2806em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">roo</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2806em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">roo</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，然后再不断下传即可。</p><hr></section><section><h2 id=\"send-the-fool-further\"><a href=\"https://www.luogu.com.cn/problem/CF802L\">Send the Fool Further!</a><a class=\"anchor\" href=\"#send-the-fool-further\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>Difficulty:<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2400</mn></mrow><annotation encoding=\"application/x-tex\">2400</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2400</span></span></span></span></p><p>给出一棵 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个点的带权树，从根开始随机游走直到走到叶子结点，求经过的期望距离，答案对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>10</mn><mn>9</mn></msup><mo>+</mo><mn>7</mn></mrow><annotation encoding=\"application/x-tex\">10^9+7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">7</span></span></span></span> 取模。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding=\"application/x-tex\">3\\le n\\le10^5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></p><hr><p>设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">dp_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 为从节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 走到叶子结点的期望距离，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">out_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7651em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">u</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 出边之和。</p><p>显然有：</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mi>x</mi></msub><mo>=</mo><mfrac><mrow><mi>o</mi><mi>u</mi><msub><mi>t</mi><mi>x</mi></msub><mo>+</mo><mi>d</mi><msub><mi>p</mi><mrow><mi>f</mi><msub><mi>a</mi><mi>x</mi></msub></mrow></msub><mo>+</mo><munder><mo>∑</mo><mrow><mi>y</mi><mo>∈</mo><mi>s</mi><mi>o</mi><msub><mi>n</mi><mi>x</mi></msub></mrow></munder><mi>d</mi><msub><mi>p</mi><mi>y</mi></msub></mrow><mrow><mi>d</mi><mi>e</mi><mi>g</mi><mi>r</mi><mi>e</mi><msub><mi>e</mi><mi>x</mi></msub></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">dp_x=\\frac{out_x+dp_{fa_x}+\\sum\\limits_{y\\in son_x}dp_y}{degree_x}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1189em;vertical-align:-0.4811em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6378em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal mtight\">re</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-4.1128em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2306em;\"><span style=\"top:-2.3em;margin-left:0em;margin-right:0.1em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"mord mathnormal mtight\">x</span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2941em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"mop op-limits mtight\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.75em;\"><span style=\"top:-1.889em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:2.75em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"mrel mtight\">∈</span><span class=\"mord mathnormal mtight\">so</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2306em;\"><span style=\"top:-2.3em;margin-left:0em;margin-right:0.1em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"mord mathnormal mtight\">x</span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-2.75em;\"><span class=\"pstrut\" style=\"height:2.75em;\"></span><span><span class=\"mop op-symbol small-op mtight\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1469em;\"><span></span></span></span></span></span><span class=\"mspace mtight\" style=\"margin-right:0.1952em;\"></span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4811em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></p><p>用上一个题的套路处理即可。</p><hr></section></section>\n<section><h1 id=\"树链剖分\">树链剖分<a class=\"anchor\" href=\"#树链剖分\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>树链剖分的思想及能解决的问题\n树链剖分用于将树分割成若干条链的形式，以维护树上路径的信息。</p><p>具体来说，将整棵树剖分为若干条链，使它组合成线性结构，然后用其他的数据结构维护信息。</p><p>树链剖分（树剖/链剖）有多种形式，如重链剖分，长链剖分 和用于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>Link/cut Tree</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{Link/cut Tree}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">Link/cut Tree</span></span></span></span></span> 的剖分（有时被称作「实链剖分」），大多数情况下（没有特别说明时），「树链剖分」都指「重链剖分」。</p><p>重链剖分可以将树上的任意一条路径划分成不超过 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 条连续的链，每条链上的点深度互不相同（即是自底向上的一条链，链上所有点的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>LCA</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{LCA}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">LCA</span></span></span></span></span> 为链的一个端点）。</p><p>重链剖分还能保证划分出的每条链上的节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>dfs</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{dfs}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">dfs</span></span></span></span></span> 序连续，因此可以方便地用一些维护序列的数据结构（如线段树）来维护树上路径的信息。</p><p>如：</p><ul>\n<li>修改 树上两点之间的路径上 所有点的值。</li>\n<li>查询 树上两点之间的路径上 节点权值的 和/极值/其它（在序列上可以用数据结构维护，便于合并的信息）。</li>\n</ul><p>除了配合数据结构来维护树上路径信息，树剖还可以用来 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>（且常数较小）地求 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>LCA</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{LCA}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">LCA</span></span></span></span></span>。在某些题目中，还可以利用其性质来灵活地运用树剖。</p><section><h2 id=\"重链剖分\">重链剖分<a class=\"anchor\" href=\"#重链剖分\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>我们给出一些定义：</p><p>定义<strong>重子节点</strong>表示其子节点中子树最大的子结点。如果有多个子树最大的子结点，取其一。如果没有子节点，就无重子节点。</p><p>定义<strong>轻子节点</strong>表示剩余的所有子结点。</p><p>从这个结点到重子节点的边为<strong>重边</strong>。</p><p>到其他轻子节点的边为<strong>轻边</strong>。</p><p>若干条首尾衔接的重边构成<strong>重链</strong>。</p><p>把落单的结点也当作重链，那么整棵树就被剖分成若干条重链。\n<img src=\"https://oi-wiki.org/graph/images/hld.png\" alt=\"\"></p><p>实现\n树剖的实现分两个 DFS 的过程。伪代码如下：</p><p>第一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 记录每个结点的父节点（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>father</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{father}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">father</span></span></span></span></span>）、深度（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>deep</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{deep}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">deep</span></span></span></span></span>）、子树大小（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>size</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{size}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6679em;\"></span><span class=\"mord text\"><span class=\"mord\">size</span></span></span></span></span>）、重子节点（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>hson</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{hson}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">hson</span></span></span></span></span>）。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mtable rowspacing=\"0.16em\" columnalign=\"left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mtext>TREE-BUILD </mtext><mo stretchy=\"false\">(</mo><mi>u</mi><mo separator=\"true\">,</mo><mi>d</mi><mi>e</mi><mi>p</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mtable rowspacing=\"0.16em\" columnalign=\"left left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>h</mi><mi>s</mi><mi>o</mi><mi>n</mi><mo>←</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>h</mi><mi>s</mi><mi>o</mi><mi>n</mi><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo>←</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>d</mi><mi>e</mi><mi>e</mi><mi>p</mi><mo>←</mo><mi>d</mi><mi>e</mi><mi>p</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>4</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo>←</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>5</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mrow><mtext mathvariant=\"bold\">for</mtext><mtext> </mtext></mrow><mtext>each </mtext><mi>u</mi><mtext>’s son </mtext><mi>v</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>6</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"2em\"></mspace><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo>←</mo><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo>+</mo><mtext>TREE-BUILD </mtext><mo stretchy=\"false\">(</mo><mi>v</mi><mo separator=\"true\">,</mo><mi>d</mi><mi>e</mi><mi>p</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>7</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"2em\"></mspace><mi>v</mi><mi mathvariant=\"normal\">.</mi><mi>f</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mo>←</mo><mi>u</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>8</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"2em\"></mspace><mrow><mtext mathvariant=\"bold\">if</mtext><mtext> </mtext></mrow><mi>v</mi><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo>></mo><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>h</mi><mi>s</mi><mi>o</mi><mi>n</mi><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>9</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"2em\"></mspace><mspace width=\"2em\"></mspace><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>h</mi><mi>s</mi><mi>o</mi><mi>n</mi><mo>←</mo><mi>v</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>10</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mrow><mtext mathvariant=\"bold\">return</mtext><mtext> </mtext></mrow><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi></mrow></mstyle></mtd></mtr></mtable></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{array}{l}\n\\text{TREE-BUILD }(u,dep) \\\\\n\\begin{array}{ll}\n1 &#x26; u.hson\\gets 0 \\\\\n2 &#x26; u.hson.size\\gets 0 \\\\\n3 &#x26; u.deep\\gets dep \\\\\n4 &#x26; u.size\\gets 1 \\\\\n5 &#x26; \\textbf{for }\\text{each }u\\text{'s son }v \\\\\n6 &#x26; \\qquad u.size\\gets u.size + \\text{TREE-BUILD }(v,dep+1) \\\\\n7 &#x26; \\qquad v.father\\gets u \\\\\n8 &#x26; \\qquad \\textbf{if }v.size> u.hson.size \\\\\n9 &#x26; \\qquad \\qquad u.hson\\gets v \\\\\n10 &#x26; \\textbf{return } u.size\n\\end{array}\n\\end{array}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:13.2em;vertical-align:-6.35em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.85em;\"><span style=\"top:-14.26em;\"><span class=\"pstrut\" style=\"height:8.25em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">TREE-BUILD </span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">p</span><span class=\"mclose\">)</span></span></span><span style=\"top:-7.65em;\"><span class=\"pstrut\" style=\"height:8.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.25em;\"><span style=\"top:-8.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span><span style=\"top:-7.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-6.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">3</span></span></span><span style=\"top:-4.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">4</span></span></span><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">5</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">6</span></span></span><span style=\"top:-1.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">7</span></span></span><span style=\"top:-0.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">8</span></span></span><span style=\"top:1.19em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">9</span></span></span><span style=\"top:2.39em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">10</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.75em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.25em;\"><span style=\"top:-8.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">so</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">0</span></span></span><span style=\"top:-7.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">so</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">ze</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">0</span></span></span><span style=\"top:-6.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">ee</span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">p</span></span></span><span style=\"top:-4.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">ze</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">1</span></span></span><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">for </span></span><span class=\"mord text\"><span class=\"mord\">each </span></span><span class=\"mord mathnormal\">u</span><span class=\"mord text\"><span class=\"mord\">’s son </span></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">ze</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">ze</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord text\"><span class=\"mord\">TREE-BUILD </span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span><span style=\"top:-1.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">er</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">u</span></span></span><span style=\"top:-0.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">if </span></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">ze</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">so</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">ze</span></span></span><span style=\"top:1.19em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">so</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span><span style=\"top:2.39em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">return </span></span><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">ze</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.75em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.35em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span></span></span></span></p><p>第二个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 记录所在链的链顶（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>top</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{top}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8095em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">top</span></span></span></span></span>，应初始化为结点本身）、重边优先遍历时的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 序（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>dfn</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{dfn}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">dfn</span></span></span></span></span>）、<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 序对应的节点编号（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>rank</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{rank}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">rank</span></span></span></span></span>）。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mtable rowspacing=\"0.16em\" columnalign=\"left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mtext>TREE-DECOMPOSITION </mtext><mo stretchy=\"false\">(</mo><mi>u</mi><mo separator=\"true\">,</mo><mi>t</mi><mi>o</mi><mi>p</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mtable rowspacing=\"0.16em\" columnalign=\"left left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>t</mi><mi>o</mi><mi>p</mi><mo>←</mo><mi>t</mi><mi>o</mi><mi>p</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mo>←</mo><mi>t</mi><mi>o</mi><mi>t</mi><mo>+</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>d</mi><mi>f</mi><mi>n</mi><mo>←</mo><mi>t</mi><mi>o</mi><mi>t</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>4</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>r</mi><mi>a</mi><mi>n</mi><mi>k</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mi>o</mi><mi>t</mi><mo stretchy=\"false\">)</mo><mo>←</mo><mi>u</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>5</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mrow><mtext mathvariant=\"bold\">if</mtext><mtext> </mtext></mrow><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>h</mi><mi>s</mi><mi>o</mi><mi>n</mi><mtext> is not </mtext><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>6</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"2em\"></mspace><mtext>TREE-DECOMPOSITION </mtext><mo stretchy=\"false\">(</mo><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>h</mi><mi>s</mi><mi>o</mi><mi>n</mi><mo separator=\"true\">,</mo><mi>t</mi><mi>o</mi><mi>p</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>7</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"2em\"></mspace><mrow><mtext mathvariant=\"bold\">for</mtext><mtext> </mtext></mrow><mtext>each </mtext><mi>u</mi><mtext>’s son </mtext><mi>v</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>8</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"2em\"></mspace><mspace width=\"2em\"></mspace><mrow><mtext mathvariant=\"bold\">if</mtext><mtext> </mtext></mrow><mi>v</mi><mtext> is not </mtext><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>h</mi><mi>s</mi><mi>o</mi><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>9</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"2em\"></mspace><mspace width=\"2em\"></mspace><mspace width=\"2em\"></mspace><mtext>TREE-DECOMPOSITION </mtext><mo stretchy=\"false\">(</mo><mi>v</mi><mo separator=\"true\">,</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr></mtable></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{array}{l}\n\\text{TREE-DECOMPOSITION }(u,top) \\\\\n\\begin{array}{ll}\n1 &#x26; u.top\\gets top \\\\\n2 &#x26; tot\\gets tot+1\\\\\n3 &#x26; u.dfn\\gets tot \\\\\n4 &#x26; rank(tot)\\gets u \\\\\n5 &#x26; \\textbf{if }u.hson\\text{ is not }0 \\\\\n6 &#x26; \\qquad \\text{TREE-DECOMPOSITION }(u.hson,top) \\\\\n7 &#x26; \\qquad \\textbf{for }\\text{each }u\\text{'s son }v \\\\\n8 &#x26; \\qquad \\qquad \\textbf{if }v\\text{ is not }u.hson \\\\\n9 &#x26; \\qquad \\qquad \\qquad \\text{TREE-DECOMPOSITION }(v,v) \n\\end{array}\n\\end{array}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:12em;vertical-align:-5.75em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:6.25em;\"><span style=\"top:-13.06em;\"><span class=\"pstrut\" style=\"height:7.65em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">TREE-DECOMPOSITION </span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span><span class=\"mclose\">)</span></span></span><span style=\"top:-7.05em;\"><span class=\"pstrut\" style=\"height:7.65em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.65em;\"><span style=\"top:-7.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span><span style=\"top:-6.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-5.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">3</span></span></span><span style=\"top:-4.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">4</span></span></span><span style=\"top:-3.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">5</span></span></span><span style=\"top:-1.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">6</span></span></span><span style=\"top:-0.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">7</span></span></span><span style=\"top:0.59em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">8</span></span></span><span style=\"top:1.79em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">9</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.15em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.65em;\"><span style=\"top:-7.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span></span></span><span style=\"top:-6.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span></span></span><span style=\"top:-5.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">df</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span></span></span><span style=\"top:-4.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">ank</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">u</span></span></span><span style=\"top:-3.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">if </span></span><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">so</span><span class=\"mord mathnormal\">n</span><span class=\"mord text\"><span class=\"mord\"> is not </span></span><span class=\"mord\">0</span></span></span><span style=\"top:-1.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord text\"><span class=\"mord\">TREE-DECOMPOSITION </span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">so</span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span><span class=\"mclose\">)</span></span></span><span style=\"top:-0.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">for </span></span><span class=\"mord text\"><span class=\"mord\">each </span></span><span class=\"mord mathnormal\">u</span><span class=\"mord text\"><span class=\"mord\">’s son </span></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span><span style=\"top:0.59em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">if </span></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord text\"><span class=\"mord\"> is not </span></span><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">so</span><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:1.79em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord text\"><span class=\"mord\">TREE-DECOMPOSITION </span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.15em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.75em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span></span></span></span></p><p>以下为代码实现。</p><p>我们先给出一些定义：</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mi>a</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">fa[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">a</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span> 表示节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 在树上的父亲。\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>e</mi><mi>p</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">dep[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span> 表示节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 在树上的深度。\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>i</mi><mi>z</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">siz[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span> 表示节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 的子树的节点个数。\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>o</mi><mi>n</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">son[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">so</span><span class=\"mord mathnormal\">n</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span> 表示节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 的 重儿子。\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>o</mi><mi>p</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">top[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span> 表示节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 所在 重链 的顶部节点（深度最小）。\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>f</mi><mi>n</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">dfn[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">df</span><span class=\"mord mathnormal\">n</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span> 表示节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span>  序，也是其在线段树中的编号。\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi><mi>n</mi><mi>k</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">rnk[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">nk</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span> 表示 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 序所对应的节点编号，有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi><mi>n</mi><mi>k</mi><mo stretchy=\"false\">[</mo><mi>d</mi><mi>f</mi><mi>n</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo><mo stretchy=\"false\">]</mo><mo>=</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">rnk[dfn[x]]=x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">nk</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">df</span><span class=\"mord mathnormal\">n</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]]</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>。\n我们进行两遍 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span>  预处理出这些值，其中第一次 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 求出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mi>a</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">fa[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">a</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>e</mi><mi>p</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">dep[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>i</mi><mi>z</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">siz[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>o</mi><mi>n</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">son[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">so</span><span class=\"mord mathnormal\">n</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span>，第二次 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span>  求出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>o</mi><mi>p</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">top[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>f</mi><mi>n</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">dfn[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">df</span><span class=\"mord mathnormal\">n</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi><mi>n</mi><mi>k</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">rnk[x]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">nk</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">]</span></span></span></span>。</p><div class=\"expressive-code\"><link rel=\"stylesheet\" href=\"/_astro/ec.d1dr8.css\"><script type=\"module\" src=\"/_astro/ec.qopfj.js\"></script><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:65ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">o</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">son[o]</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,siz[o]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> j</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">h[o];j; j </span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> nxt[j])</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#F97583;--1:#F97583\">!</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dep[p[j]]) {</span></div></div><div class=\"ec-line\" style=\"--ecIndent:6ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">      </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dep[p[j]] </span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> dep[o] </span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:6ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">      </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">fa[p[j]] </span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> o;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:6ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">      </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p[j]);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:6ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">      </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[o] </span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> siz[p[j]];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:6ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\">      </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (son[o] </span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> siz[p[j]] </span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> siz[son[o]]) son[o] </span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> p[j];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\">\n</div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">o</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">, </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">t</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) {</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top[o] </span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> t;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cnt</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dfn[o] </span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> cnt;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">rnk[cnt] </span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> o;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (son[o] </span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(son[o], t);</span><span style=\"--0:#99A0A6;--1:#99A0A6\">  // 优先对重儿子进行 DFS，可以保证同一条重链上的点 DFS 序连续</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> j </span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> h[o]; j; j </span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> nxt[j])</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (p[j] </span><span style=\"--0:#F97583;--1:#F97583\">!=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> son[o] </span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> p[j] </span><span style=\"--0:#F97583;--1:#F97583\">!=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> fa[o]) </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p[j], p[j]);</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><section><h3 id=\"重链剖分的性质\">重链剖分的性质<a class=\"anchor\" href=\"#重链剖分的性质\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>树上每个节点都属于且仅属于一条重链。</p><p>重链开头的结点不一定是重子节点（因为重边是对于每一个结点都有定义的）。</p><p>所有的重链将整棵树<strong>完全剖分</strong>。</p><p>在剖分时 重边优先遍历，最后树的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 序上，重链内的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 序是连续的。按 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFN</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFN}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFN</span></span></span></span></span> 排序后的序列即为剖分后的链。</p><p>一颗子树内的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 序是连续的。</p><p>可以发现，当我们向下经过一条<strong>轻边</strong>时，所在子树的大小至少会 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>÷</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">\\div 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">÷</span><span class=\"mord\">2</span></span></span></span>。</p><p>因此，对于树上的任意一条路径，把它拆分成从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>LCA</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{LCA}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">LCA</span></span></span></span></span> 分别向两边往下走，分别最多走 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 次，因此，树上的每条路径都可以被拆分成不超过 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 条重链。</p><p>用树链剖分求树上两点路径权值和，伪代码如下：</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mtable rowspacing=\"0.16em\" columnalign=\"left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mtext>TREE-PATH-SUM </mtext><mo stretchy=\"false\">(</mo><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mtable rowspacing=\"0.16em\" columnalign=\"left left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mo>←</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mrow><mtext mathvariant=\"bold\">while</mtext><mtext> </mtext></mrow><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>t</mi><mi>o</mi><mi>p</mi><mtext> is not </mtext><mi>v</mi><mi mathvariant=\"normal\">.</mi><mi>t</mi><mi>o</mi><mi>p</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"2em\"></mspace><mrow><mtext mathvariant=\"bold\">if</mtext><mtext> </mtext></mrow><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>t</mi><mi>o</mi><mi>p</mi><mi mathvariant=\"normal\">.</mi><mi>d</mi><mi>e</mi><mi>e</mi><mi>p</mi><mo>&#x3C;</mo><mi>v</mi><mi mathvariant=\"normal\">.</mi><mi>t</mi><mi>o</mi><mi>p</mi><mi mathvariant=\"normal\">.</mi><mi>d</mi><mi>e</mi><mi>e</mi><mi>p</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>4</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"2em\"></mspace><mspace width=\"2em\"></mspace><mtext>SWAP</mtext><mo stretchy=\"false\">(</mo><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>5</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"2em\"></mspace><mi>t</mi><mi>o</mi><mi>t</mi><mo>←</mo><mi>t</mi><mi>o</mi><mi>t</mi><mo>+</mo><mtext>sum of values between </mtext><mi>u</mi><mtext> and </mtext><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>t</mi><mi>o</mi><mi>p</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>6</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mspace width=\"2em\"></mspace><mi>u</mi><mo>←</mo><mi>u</mi><mi mathvariant=\"normal\">.</mi><mi>t</mi><mi>o</mi><mi>p</mi><mi mathvariant=\"normal\">.</mi><mi>f</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>7</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mo>←</mo><mi>t</mi><mi>o</mi><mi>t</mi><mo>+</mo><mtext>sum of values between </mtext><mi>u</mi><mtext> and </mtext><mi>v</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>8</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mrow><mtext mathvariant=\"bold\">return</mtext><mtext> </mtext></mrow><mi>t</mi><mi>o</mi><mi>t</mi></mrow></mstyle></mtd></mtr></mtable></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{array}{l}\n\\text{TREE-PATH-SUM }(u,v) \\\\\n\\begin{array}{ll}\n1 &#x26; tot\\gets 0 \\\\\n2 &#x26; \\textbf{while }u.top\\text{ is not }v.top \\\\\n3 &#x26; \\qquad \\textbf{if }u.top.deep&#x3C; v.top.deep \\\\\n4 &#x26; \\qquad \\qquad \\text{SWAP}(u, v) \\\\\n5 &#x26; \\qquad tot\\gets tot + \\text{sum of values between }u\\text{ and }u.top \\\\\n6 &#x26; \\qquad u\\gets u.top.father \\\\\n7 &#x26; tot\\gets tot + \\text{sum of values between }u\\text{ and }v \\\\\n8 &#x26; \\textbf{return } tot \n\\end{array}\n\\end{array}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:10.8em;vertical-align:-5.15em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.65em;\"><span style=\"top:-11.86em;\"><span class=\"pstrut\" style=\"height:7.05em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">TREE-PATH-SUM </span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span></span></span><span style=\"top:-6.45em;\"><span class=\"pstrut\" style=\"height:7.05em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.05em;\"><span style=\"top:-7.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span><span style=\"top:-6.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-4.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">3</span></span></span><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">4</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">5</span></span></span><span style=\"top:-1.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">6</span></span></span><span style=\"top:-0.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">7</span></span></span><span style=\"top:1.19em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">8</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4.55em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.05em;\"><span style=\"top:-7.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">0</span></span></span><span style=\"top:-6.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">while </span></span><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span><span class=\"mord text\"><span class=\"mord\"> is not </span></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span></span></span><span style=\"top:-4.81em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord text\"><span class=\"mord textbf\">if </span></span><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">ee</span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&#x3C;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">ee</span><span class=\"mord mathnormal\">p</span></span></span><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord text\"><span class=\"mord\">SWAP</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mclose\">)</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord text\"><span class=\"mord\">sum of values between </span></span><span class=\"mord mathnormal\">u</span><span class=\"mord text\"><span class=\"mord\"> and </span></span><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span></span></span><span style=\"top:-1.21em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mspace\" style=\"margin-right:2em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">er</span></span></span><span style=\"top:-0.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord text\"><span class=\"mord\">sum of values between </span></span><span class=\"mord mathnormal\">u</span><span class=\"mord text\"><span class=\"mord\"> and </span></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span><span style=\"top:1.19em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord textbf\">return </span></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4.55em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.15em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span></span></span></span></p><p>链上的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 序是连续的，可以使用线段树、树状数组维护。</p><p>每次选择深度较大的链往上跳，直到两点在同一条链上。</p><p>同样的跳链结构适用于维护、统计路径上的其他信息。</p><p>子树维护\n有时会要求，维护子树上的信息，譬如将以 x 为根的子树的所有结点的权值增加 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span>。</p><p>在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 搜索的时候，子树中的结点的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 序是连续的。</p><p>每一个结点记录 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi><mi>o</mi><mi>t</mi><mi>t</mi><mi>o</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">bottom</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">tt</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">m</span></span></span></span> 表示所在子树连续区间末端的结点。</p><p>这样就把子树信息转化为连续的一段区间信息。</p><p>求最近公共祖先\n不断向上跳重链，当跳到同一条重链上时，深度较小的结点即为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>LCA</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{LCA}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">LCA</span></span></span></span></span>。</p><p>向上跳重链时需要先跳所在重链顶端深度较大的那个。</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:49ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">lca</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">v</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top[u]</span><span style=\"--0:#F97583;--1:#F97583\">!=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top[v]){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(dep[top[u]]</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dep[top[v]]) u</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">fa[top[u]];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">else</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> v</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">fa[top[v]];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> dep[u]</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dep[v]</span><span style=\"--0:#F97583;--1:#F97583\">?</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">v</span><span style=\"--0:#F97583;--1:#F97583\">:</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">u;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section></section><section><h2 id=\"长链剖分\">长链剖分<a class=\"anchor\" href=\"#长链剖分\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>长链剖分本质上就是另外一种链剖分方式。</p><p>定义 重子节点 表示其子节点中子树深度最大的子结点。如果有多个子树最大的子结点，取其一。如果没有子节点，就无重子节点。</p><p>定义<strong>轻子节点</strong>表示剩余的子结点。</p><p>从这个结点到重子节点的边为<strong>重边</strong>。</p><p>到其他轻子节点的边为<strong>轻边</strong>。</p><p>若干条首尾衔接的重边构成<strong>重链</strong>。</p><p>把落单的结点也当作重链，那么整棵树就被剖分成若干条重链。</p><p>如图（这种剖分方式既可以看成重链剖分也可以看成长链剖分）：\n<img src=\"https://oi-wiki.org/graph/images/hld.png\" alt=\"\">\n长链剖分实现方式和重链剖分类似，这里就不再展开。</p><section><h3 id=\"长链剖分求-k-级祖先\">长链剖分求 k 级祖先<a class=\"anchor\" href=\"#长链剖分求-k-级祖先\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>即询问一个点向父亲跳 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 次跳到的节点。</p><p>首先我们假设我们已经预处理了每一个节点的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8247em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span></span></span></span></span></span></span> 级祖先。</p><p>现在我们假设我们找到了询问节点的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8247em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span></span></span></span></span></span></span> 级祖先满足 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>i</mi></msup><mo>≤</mo><mi>k</mi><mo>&#x3C;</mo><msup><mn>2</mn><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">2^i \\le k &#x3C; 2^{i+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9606em;vertical-align:-0.136em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7335em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&#x3C;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8247em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>。</p><p>我们考虑求出其所在重链的节点并且按照深度列入表格。假设重链长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span></span></span></span>。</p><p>同时我们在预处理的时候找到每条重链的根节点的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span></span></span></span> 级祖先，同样放入表格。</p><p>根据长链剖分的性质，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>−</mo><msup><mn>2</mn><mi>i</mi></msup><mo>≤</mo><msup><mn>2</mn><mi>i</mi></msup><mo>≤</mo><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">k-2^i \\le 2^i \\leq d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9606em;vertical-align:-0.136em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9606em;vertical-align:-0.136em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span></span></span></span>, 也就是说，我们可以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 在这条重链的表格上求出的这个节点的 k 级祖先。</p><p>预处理需要倍增出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8247em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span></span></span></span></span></span></span> 次级祖先，同时需要预处理每条重链对应的表格。</p><p>预处理复杂度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>, 询问复杂度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>。</p></section><section><h3 id=\"luogu-p3384-模板重链剖分树链剖分\"><em><a href=\"https://www.luogu.com.cn/problem/P3384\">Luogu P3384 【模板】重链剖分/树链剖分</a></em><a class=\"anchor\" href=\"#luogu-p3384-模板重链剖分树链剖分\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>如题，已知一棵包含 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> 个结点的树（连通且无环），每个节点上包含一个数值，需要支持以下操作：</p><ul>\n<li>\n<p><code>1 x y z</code>，表示将树从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 结点最短路径上所有节点的值都加上 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>z</mi></mrow><annotation encoding=\"application/x-tex\">z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span></span></span></span>。</p>\n</li>\n<li>\n<p><code>2 x y</code>，表示求树从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 结点最短路径上所有节点的值之和。</p>\n</li>\n<li>\n<p><code>3 x z</code>，表示将以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 为根节点的子树内所有节点值都加上 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>z</mi></mrow><annotation encoding=\"application/x-tex\">z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span></span></span></span>。</p>\n</li>\n<li>\n<p><code>4 x</code> 表示求以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 为根节点的子树内所有节点值之和。</p>\n</li>\n</ul><p><strong>Code</strong></p><div class=\"expressive-code\"><figure class=\"frame\" style=\"--lnWidth:3ch\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:88ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#include</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">&#x3C;bits/stdc++.h></span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">std</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> N</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">e</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">struct</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">E</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> to,next;}edge[N</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> n,m,rt,mod,w[N],a[N],head[N],cnt;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">add</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">v</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cnt].next</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[cnt].to</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">v;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cnt;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,t</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) t</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),x</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">static</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> sta[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">35</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> top</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{sta[top</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sta[</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">23</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">24</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">file</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">25</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".in\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"r\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdin);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">26</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".out\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"w\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdout);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">27</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">28</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">ch</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x),</span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch)),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">29</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">30</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">SGT</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">31</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">struct</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">node</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> l,r,sum,size,tag;}tree[N</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">32</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">pushup</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">33</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">maketag</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">num</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">34</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].size</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">35</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].tag</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">36</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">37</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">pushdown</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">38</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].tag){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">39</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#B392F0;--1:#B392F0\">maketag</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,tree[p].tag),</span><span style=\"--0:#B392F0;--1:#B392F0\">maketag</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,tree[p].tag);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">40</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">            </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">41</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">42</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">43</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">44</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l,tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r,tree[p].size</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">45</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">w[l]</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod,</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">46</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> mid</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r)</span><span style=\"--0:#F97583;--1:#F97583\">>></span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">47</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,mid);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">48</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,mid</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">49</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">pushup</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">50</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">51</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">num</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">52</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">maketag</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p,num),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">53</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">pushdown</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p);</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> mid</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r)</span><span style=\"--0:#F97583;--1:#F97583\">>></span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">54</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mid) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">55</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(r</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mid) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">56</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">pushup</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">57</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">58</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">59</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">60</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">pushdown</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p);</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> mid</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r)</span><span style=\"--0:#F97583;--1:#F97583\">>></span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,res</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">61</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mid) res</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(res</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r))</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">62</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(r</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mid) res</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(res</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r))</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">63</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> res;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">64</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">65</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">66</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">HLD</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">67</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> dep[N],siz[N],fa[N],son[N],dfn[N],top[N],idx;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">68</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">f</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">69</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dep[u]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dep[f]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;siz[u]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;fa[u]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">70</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> maxn</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">71</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u];i;i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].next){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">72</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> v</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].to;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">73</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(f</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">v) </span><span style=\"--0:#F97583;--1:#F97583\">continue</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">74</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(v,u);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">75</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">            </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[u]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[v];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">76</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(siz[son[u]]</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[v]) son[u]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">v;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">77</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">78</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">79</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">f</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">80</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dfn[u]</span><span style=\"--0:#F97583;--1:#F97583\">=++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">idx,w[idx]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">a[u],top[u]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">81</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">!</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">son[u]) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#B392F0;--1:#B392F0\">dfs2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(son[u],f);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">82</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u];i;i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].next){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">83</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> v</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].to;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">84</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">!</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dfn[v]) </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(v,v);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">85</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">86</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">87</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">y</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">num</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">88</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top[x]</span><span style=\"--0:#F97583;--1:#F97583\">!=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top[y]){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">89</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(dep[top[x]]</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dep[top[y]]) </span><span style=\"--0:#B392F0;--1:#B392F0\">swap</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x,y);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">90</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#B392F0;--1:#B392F0\">SGT</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::</span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,dfn[top[x]],dfn[x],num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">91</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">            </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">fa[top[x]];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">92</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">93</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(dep[x]</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dep[y]) </span><span style=\"--0:#B392F0;--1:#B392F0\">swap</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x,y);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">94</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">SGT</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::</span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,dfn[x],dfn[y],num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">95</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">96</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">y</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">97</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> res</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">98</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top[x]</span><span style=\"--0:#F97583;--1:#F97583\">!=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top[y]){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">99</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(dep[top[x]]</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dep[top[y]]) </span><span style=\"--0:#B392F0;--1:#B392F0\">swap</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x,y);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">100</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">            </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">res</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(res</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#B392F0;--1:#B392F0\">SGT</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,dfn[top[x]],dfn[x]))</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">101</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">            </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">fa[top[x]];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">102</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">103</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(dep[x]</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dep[y]) </span><span style=\"--0:#B392F0;--1:#B392F0\">swap</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x,y);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">104</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">res</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(res</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#B392F0;--1:#B392F0\">SGT</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,dfn[x],dfn[y]))</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">105</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> res;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">106</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">107</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">init</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span><span style=\"--0:#B392F0;--1:#B392F0\">dfs1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(rt,</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span><span style=\"--0:#B392F0;--1:#B392F0\">dfs2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(rt,rt);}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">108</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">109</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">signed</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">main</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">110</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),m</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),rt</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),mod</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">111</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) a[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">112</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">113</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> u</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),v</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">114</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">add</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(u,v),</span><span style=\"--0:#B392F0;--1:#B392F0\">add</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(v,u);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">115</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">116</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">HLD</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::</span><span style=\"--0:#B392F0;--1:#B392F0\">init</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span><span style=\"--0:#B392F0;--1:#B392F0\">SGT</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::</span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,n);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">117</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(m</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">118</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> op</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">119</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(op</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">120</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> x</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),y</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),z</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">()</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">121</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#B392F0;--1:#B392F0\">HLD</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::</span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x,y,z);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">122</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">123</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(op</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">124</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> x</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),y</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">125</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#B392F0;--1:#B392F0\">HLD</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x,y),</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#79B8FF;--1:#79B8FF\">\\n</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">126</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">127</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(op</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#79B8FF;--1:#79B8FF\">3</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">128</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> x</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),z</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">()</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">129</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#B392F0;--1:#B392F0\">SGT</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::</span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#B392F0;--1:#B392F0\">HLD</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::dfn[x],</span><span style=\"--0:#B392F0;--1:#B392F0\">HLD</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::dfn[x]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#B392F0;--1:#B392F0\">HLD</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::siz[x]</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,z);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">130</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">131</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(op</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#79B8FF;--1:#79B8FF\">4</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">132</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> x</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">133</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#B392F0;--1:#B392F0\">SGT</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#B392F0;--1:#B392F0\">HLD</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::dfn[x],</span><span style=\"--0:#B392F0;--1:#B392F0\">HLD</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::dfn[x]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#B392F0;--1:#B392F0\">HLD</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">::siz[x]</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#79B8FF;--1:#79B8FF\">\\n</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">134</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">135</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">136</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">137</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section></section><section><h2 id=\"长链剖分-1\">长链剖分<a class=\"anchor\" href=\"#长链剖分-1\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>长链剖分本质上就是另外一种链剖分方式。</p><p>定义 重子节点 表示其子节点中子树深度最大的子结点。如果有多个子树最大的子结点，取其一。如果没有子节点，就无重子节点。</p><p>定义<strong>轻子节点</strong>表示剩余的子结点。</p><p>从这个结点到重子节点的边为<strong>重边</strong>。</p><p>到其他轻子节点的边为<strong>轻边</strong>。</p><p>若干条首尾衔接的重边构成<strong>重链</strong>。</p><p>把落单的结点也当作重链，那么整棵树就被剖分成若干条重链。</p><p>如图（这种剖分方式既可以看成重链剖分也可以看成长链剖分）：\n<img src=\"https://oi-wiki.org/graph/images/hld.png\" alt=\"\">\n长链剖分实现方式和重链剖分类似，这里就不再展开。</p><section><h3 id=\"长链剖分求-k-级祖先-1\">长链剖分求 k 级祖先<a class=\"anchor\" href=\"#长链剖分求-k-级祖先-1\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>即询问一个点向父亲跳 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 次跳到的节点。</p><p>首先我们假设我们已经预处理了每一个节点的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8247em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span></span></span></span></span></span></span> 级祖先。</p><p>现在我们假设我们找到了询问节点的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8247em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span></span></span></span></span></span></span> 级祖先满足 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>i</mi></msup><mo>≤</mo><mi>k</mi><mo>&#x3C;</mo><msup><mn>2</mn><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">2^i \\le k &#x3C; 2^{i+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9606em;vertical-align:-0.136em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7335em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&#x3C;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8247em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>。</p><p>我们考虑求出其所在重链的节点并且按照深度列入表格。假设重链长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span></span></span></span>。</p><p>同时我们在预处理的时候找到每条重链的根节点的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span></span></span></span> 级祖先，同样放入表格。</p><p>根据长链剖分的性质，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>−</mo><msup><mn>2</mn><mi>i</mi></msup><mo>≤</mo><msup><mn>2</mn><mi>i</mi></msup><mo>≤</mo><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">k-2^i \\le 2^i \\leq d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9606em;vertical-align:-0.136em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9606em;vertical-align:-0.136em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span></span></span></span>, 也就是说，我们可以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 在这条重链的表格上求出的这个节点的 k 级祖先。</p><p>预处理需要倍增出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8247em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span></span></span></span></span></span></span> 次级祖先，同时需要预处理每条重链对应的表格。</p><p>预处理复杂度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>, 询问复杂度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>。</p></section></section></section>",{headings:238,localImagePaths:342,remoteImagePaths:343,frontmatter:344,imagePaths:350},[239,242,245,248,251,254,257,260,263,266,269,272,275,278,281,284,287,290,293,296,299,302,305,308,311,314,317,320,323,326,329,332,335,338,340],{depth:14,slug:240,text:241},"dfs-序","dfs 序#",{depth:52,slug:243,text:244},"例题","例题：#",{depth:52,slug:246,text:247},"子树加子树求和","子树加子树求和#",{depth:52,slug:249,text:250},"nearest-leaf","Nearest Leaf#",{depth:14,slug:252,text:253},"欧拉序","欧拉序#",{depth:14,slug:255,text:256},"最近公共祖先","最近公共祖先#",{depth:52,slug:258,text:259},"company","Company#",{depth:14,slug:261,text:262},"树上距离","树上距离#",{depth:14,slug:264,text:265},"树的直径","树的直径#",{depth:52,slug:267,text:268},"例题区间直径","例题：区间直径#",{depth:52,slug:270,text:271},"dynamic-diameter","Dynamic Diameter#",{depth:52,slug:273,text:274},"roads-and-ramen","Roads and Ramen#",{depth:14,slug:276,text:277},"树的中心","树的中心#",{depth:52,slug:279,text:280},"tree-compass","Tree Compass#",{depth:14,slug:282,text:283},"树的重心","树的重心#",{depth:52,slug:285,text:286},"例题kay-and-snowflake","例题：Kay and Snowflake#",{depth:52,slug:288,text:289},"csp-s2019-树的重心","[CSP-S2019] 树的重心#",{depth:14,slug:291,text:292},"dfs-生成树","dfs 生成树#",{depth:52,slug:294,text:295},"例题choose-your-queries","例题：Choose Your Queries#",{depth:52,slug:297,text:298},"pairs-of-pairs","Pairs of Pairs#",{depth:14,slug:300,text:301},"树上启发式合并","树上启发式合并#",{depth:52,slug:303,text:304},"例题lomsat-gelral","例题：Lomsat gelral#",{depth:52,slug:306,text:307},"arpas-letter-marked-tree-and-mehrdads-dokhtar-kosh-paths","Arpa’s letter-marked tree and Mehrdad’s Dokhtar-kosh paths#",{depth:14,slug:309,text:310},"树上随机游走","树上随机游走#",{depth:52,slug:312,text:313},"alices-adventures-in-the-rabbit-hole","Alice’s Adventures in the Rabbit Hole#",{depth:52,slug:315,text:316},"例题random-walk","例题：Random Walk#",{depth:52,slug:318,text:319},"send-the-fool-further","Send the Fool Further!#",{depth:14,slug:321,text:322},"树链剖分","树链剖分#",{depth:52,slug:324,text:325},"重链剖分","重链剖分#",{depth:171,slug:327,text:328},"重链剖分的性质","重链剖分的性质#",{depth:52,slug:330,text:331},"长链剖分","长链剖分#",{depth:171,slug:333,text:334},"长链剖分求-k-级祖先","长链剖分求 k 级祖先#",{depth:171,slug:336,text:337},"luogu-p3384-模板重链剖分树链剖分","Luogu P3384 【模板】重链剖分/树链剖分#",{depth:52,slug:339,text:331},"长链剖分-1",{depth:171,slug:341,text:334},"长链剖分求-k-级祖先-1",[],[],{title:229,published:345,description:37,image:37,tags:346,category:39,draft:36,lang:37,minutes:347,words:348,excerpt:349},["Date","2025-06-11T00:00:00.000Z"],[39],38,7672,"对于一棵树，我们从根节点处开始 dfs，过程中在每个点第一次遇到的时候把它记录下来，就得到了一棵树的 dfs 序，一般记作 dfn。",[],"Tree.md","sgt",{id:352,data:354,body:358,filePath:359,digest:360,rendered:361,legacyId:404},{title:355,published:356,draft:36,description:37,image:37,tags:357,category:39,lang:37,prevTitle:37,prevSlug:37,nextTitle:37,nextSlug:37},"线段树",["Date","2025-06-10T00:00:00.000Z"],[39],"对于区间(线段)的修改、维护，从 $O(n)$ 变为 $O(\\log n)$。\n\n---\n\n# 构建\n\n![](https://i-blog.csdnimg.cn/blog_migrate/97c81e47838bc3a2941aaf4c68933de0.png)\n这是什么意思呢？ 如果你要表示线段的和，那么最上面的根节点的权值表示的是这个线段 $1 \\sim 4$ 的和。根的两个儿子分别表示这个线段中 $1 \\sim 2$ 的和，与 $3 \\sim 4$ 的和。以此类推。\n\n然后我们还可以的到一个性质：节点 $i$ 的权值 $=$ 她的左儿子权值 $+$ 她的右儿子权值。因为 $1 \\sim 4$ 的和就是等于 $1 \\sim 2$ 的和与 $2\\sim 3$ 的和的和。\n\n根据这个思路，我们就可以建树了，我们设一个结构体 `tree`，`tree[i].l` 与 `tree[i].r` 分别表示这个点代表的线段的左右下标，`tree[i].sum` 表示这个节点表示的线段和。\n\n我们知道，一颗从 1 11 开始编号的二叉树，结点 i ii 的左儿子和右儿子编号分别是 $2 \\times i$ 和 $2\\times i + 1$。\n\n再根据刚才的性质，得到式子：$tree[i].sum=tree [i∗2].sum+tree[i∗2+1 ].sum$; $tree[i].sum=tree[i*2].sum+tree[i*2+1].sum;tree[i].sum=tree[i∗2].sum+tree[i∗2+1].sum$; 就可以建一颗线段树了！代码如下：\n\n```cpp\ninline void build(const int p,const int l,const int r){\n    tree[p].l=l,tree[p].r=r;\n    if(l==r) return tree[p].sum=input[l],void(0);\n    int mid=(l+r)>>1;\n    build(p<<1,l,mid);\n    build(p<<1|1,mid+1,r);\n    tree[p].sum=tree[p<<1].sum+tree[p<<1|1].sum;\n}\n```\n\n---\n\n# 简单线段树\n\n## 单点修改，区间查询\n\n![](https://i-blog.csdnimg.cn/blog_migrate/22a46ac7055f8f700832ef014ed7a489.png)\n然后我们要求 $1 \\sim 3$ 的和，我们先从根节点开始查询，发现她的左儿子1-2这个区间和答案区间 $1 \\sim 3$ 有交集，那么我们跑到左儿子这个区间。\n\n然后，我们发现这个区间 $1 \\sim 2$ 被完全包括在答案区间 $1 \\sim 3$ 这个区间里面，那就把她的值 $3$ 返回。\n\n我们回到了 $1 \\sim 4$ 区间，发现她的右儿子 $3 \\sim 4$ 区间和答案区间 $1 \\sim 3$ 有交集，那么我们走到 $3\\sim 4$ 区间。\n\n到了 $3 \\sim 4$ 区间，我们发现她并没有完全包含在答案区间 $1\\sim 3$ 里面，但发现她的左儿子 $3\\sim 3$ 区间和 $1\\sim 3$ 区间又交集，那么久走到 $3\\sim 3$ 区间。\n\n到了 $3\\sim 3$ 区间，发现其被答案区间完全包含，就返回她的值 $3$ 一直到最开始。\n\n$3\\sim 3$ 区间的 $3 + 1\\sim 2$ 区间的 $3 = 6$，我们知道了 $1\\sim 3$ 区间和为 $6$。\n\n有人可能会说你这样是不是疯了，我拿脚都能算出 $1 + 2 + 3 = 6$，为什么这么麻烦？！\n\n因为这才几个数，如果一百万个数，这样时间会大大增快。\n\n我们总结一下，线段树的查询方法：\n\n- 如果这个区间被完全包括在目标区间里面，直接返回这个区间的值。\n- 如果这个区间的左儿子和目标区间有交集，那么搜索左儿子。\n- 如果这个区间的右儿子和目标区间有交集，那么搜索右儿子。\n\n代码如下：\n\n```cpp\ninline int ask(const int p,const int l,const int r){\n    if(tree[p].r<l||r<tree[p].l) return 0;\n    if(l<=tree[p].l&&tree[p].r<=r) return tree[p].sum;\n    int res=0;\n    if(tree[p<<1].r>=l) res+=ask(p<<1,l,r);\n    if(tree[p<<1|1].l<=r) res+=ask(p<<1|1,l,r);\n    return res;\n}\n```\n\n关于那几个if的条件一定要看清楚，最好背下来，以防考场上脑抽推错。\n\n然后,我们怎么修改这个区间的单点，其实这个相对简单很多，你要把区间的第 $dis$ 位加上 $k$。那么你从根节点开始，看这个 $dis$ 是在左儿子还是在右儿子，在哪往哪跑，然后返回的时候，还是按照$tree[i].sum=tree[i*2].sum+tree[i*2+1].sum$ 的原则，更新所有路过的点。\n\n如果不理解，我还是画个图吧，其中深蓝色是去的路径，浅蓝色是返回的路径，回来时候红色的 $+$ 标记就是把这个点加上这个值。\n![](https://i-blog.csdnimg.cn/blog_migrate/b0f6769ede881ffe60e77f38bec50400.png)\n\n代码如下：\n\n```cpp\ninline void update(const int p,const int pos,const int num){\n    if(tree[p].l==tree[p].r) return tree[p].sum+=num,void(0);//如果是叶子节点，那么说明找到了\n    if(pos<=tree[p<<1].r) update(p<<1,pos,num);//在哪往哪跑\n    else update(p<<1|1,pos,num);\n    tree[p].sum=tree[p<<1].sum+tree[p<<1|1].sum;//返回更新\n}\n```\n\n## 区间修改，单点查询\n\n区间修改和单点查询，我们的思路就变为：如果把这个区间加上 $k$，相当于把这个区间涂上一个 $k$ 的标记，然后单点查询的时候，就从上跑到下，把沿路的标记加起来就好。\n\n这里面给区间贴标记的方式与上面的区间查找类似，原则还是那三条，只不过第一条：如果这个区间被完全包括在目标区间里面，直接返回这个区间的值变为了如果这个区间如果这个区间被完全包括在目标区间里面，讲这个区间标记 $k$。\n\n```cpp\ninline void update(const int p,const int l,const int r,const int num){\n    if(l<=tree[p].l&&tree[p].r<=r) return tree[p].sum+=num,void(0);\n    int mid=(tree[p].l+tree[p].r)>>1;\n    if(l<=mid) update(p<<1,l,r,num);\n    if(r>mid) update(p<<1|1,l,r,num);\n}\n```\n\n查询\n\n```cpp\ninline void ask(const int p,const int pos){\n    ans+=tree[p].sum;\n    if(tree[p].l==tree[p].r) return;\n    int mid=(tree[p].l+tree[p].r)>>1;\n    if(pos<=mid) ask(p<<1,pos);\n    else ask(p<<1|1,pos);\n}\n```\n\n### 区间修改单点查询完整代码\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=5e5+5;\nint n,q,a[N],ans;\nnamespace rw{\n    inline int read(){\n        int tot=0,t=1;char ch=getchar();\n        while(ch<'0'||ch>'9'){if(ch=='-') t=-1;ch=getchar();}\n        while(ch>='0'&&ch<='9'){tot=tot*10+ch-'0';ch=getchar();}\n        return tot*t;\n    }\n    inline void write(int x){\n        if(x<0) putchar('-'),x=-x;\n        static int sta[35];int top=0;\n        do{sta[top++]=x%10,x/=10;}while(x);\n        while(top) putchar(sta[--top]+'0');\n    }\n    inline void print(const int x,const char ch){return (write(x),putchar(ch)),void(0);}\n}using namespace rw;\nnamespace SGT{\n    struct node{int l,r,sum;}tree[N<<2];\n    inline void build(const int p,const int l,const int r){\n        tree[p].l=l,tree[p].r=r;\n        if(l==r) return;\n        int mid=(l+r)>>1;\n        build(p<<1,l,mid);\n        build(p<<1|1,mid+1,r);\n    }\n    inline void update(const int p,const int l,const int r,const int num){\n        if(l<=tree[p].l&&tree[p].r<=r) return tree[p].sum+=num,void(0);\n        if(tree[p<<1].r>=l) update(p<<1,l,r,num);\n        if(tree[p<<1|1].l<=r) update(p<<1|1,l,r,num);\n    }\n    inline void ask(const int p,const int pos){\n        ans+=tree[p].sum;\n        if(tree[p].l==tree[p].r) return;\n        if(tree[p<<1].r>=pos) ask(p<<1,pos);\n        if(tree[p<<1|1].l<=pos) ask(p<<1|1,pos);\n    }\n}using namespace SGT;\nsigned main(){\n    n=read(),q=read();\n    for(int i=1;i<=n;i++) a[i]=read();\n    build(1,1,n);\n    while(q--){\n        int op=read();\n        if(op==1){\n            int l=read(),r=read(),x=read();\n            update(1,l,r,x);\n        }\n        if(op==2){\n            ans=0;int x=read();ask(1,x);\n            print(ans+a[x],'\\n');\n        }\n    }\n    return 0;\n}\n```\n\n### 为什么需要把路上的 $\\text{num}$ 加起来?\n\n因为我们在进行区间修改的时候，若当前区间已经被完全包含在目标区间 $[ l , r ]$ 里，直接将该区间 $tree[i].num += k$，不需要再继续往下走了，类似 lazy 标记，所以单点查询的时候要再加上路径上的值（即原本的权值再加上经过的若干次修改的值才是这个单点的值）。\n\n# 进阶线段树\n\n区间修改、区间查询，你可能会认为，把上一章里面的这两个模块加在一起就好了，然后你就会发现你大错特错。\n\n因为如果对于 $1\\sim 4$ 这个区间，你把 $1\\sim 3$ 区间 $+ 1$ ，相当于把节点 $1\\sim 2$ 和 $3$ 标记，但是如果你查询 $2\\sim 4$ 时，你会发现你加的时没有标记的 $2$节点和没有标记的 $3\\sim 4$ 节点加上去，结果当然是错的。\n\n那么我们应该怎么办？这时候 $\\text{pushdown}$ 的作用就显现出来了。\n\n你会想到，我们只需要在查询的时候，如果我们要查的 $2$ 节点在 $1\\sim 2$ 区间的里面，那我们就可以把 $1\\sim 2$ 区间标记的那个 $+ 1$ 给推下去这样就能顺利地加上了。\n怎么记录这个标记呢？我们需要记录一个“懒标记” $\\text{lazytage}$，来记录这个区间。\n\n区间修改的时候，我们按照如下原则：\n\n- 如果当前区间被完全覆盖在目标区间里，讲这个区间的 $sum+k \\times (tree[i].r-tree[i].l+1)$。\n- 如果没有完全覆盖，则先下传懒标记。\n- 如果这个区间的左儿子和目标区间有交集，那么搜索左儿子。\n- 如果这个区间的右儿子和目标区间有交集，那么搜索右儿子。\n\n然后查询的时候，将这个懒标记下传就好了，下面图解一下：\n如图，区间 $1\\sim 4$ 分别是 $1 、 2 、 3 、 4$ ，我们要把 $1\\sim 3$ 区间 $+ 1$ 。因为 $1\\sim 2$ 区间被完全覆盖，所以将其 $+2$，并将紫色的 $\\text{lazytage}+1$，$3$ 区间同理。\n![](https://i-blog.csdnimg.cn/blog_migrate/b64f0efc922c03968527c0310317e7dc.png)\n注意我们处理完这些以后，还是要按照$tree[i].sum=tree[i*2].sum+tree[i*2+1].sum$ 的原则返回，代码如下：\n\n```cpp\ninline void pushdown(const int p){\n    if(tree[p].tag){\n        tree[p<<1].tag+=tree[p].tag;\n        tree[p<<1|1].tag+=tree[p].tag;\n        int mid=(tree[p].l+tree[p].r)>>1;\n        tree[p<<1].sum+=tree[p].tag*(mid-tree[p<<1].l+1);\n        tree[p<<1|1].sum+=tree[p].tag*(tree[p<<1|1].r-mid);\n        tree[p].tag=0;\n    }\n}\ninline void update(const int p,const int l,const int r,const int num){\n    if(l<=tree[p].l&&tree[p].r<=r){\n        tree[p].sum+=num*(tree[p].r-tree[p].l+1);\n        tree[p].tag+=num;\n        return;\n    }\n    pushdown(p);\n    if(tree[p<<1].r>=l) update(p<<1,l,r,num);\n    if(tree[p<<1|1].l<=r) update(p<<1|1,l,r,num);\n    pushup(p);//tree[p].sum=tree[p<<1].sum+tree[p<<1|1].sum;\n}\n```\n\n查询的时候，和上一章的几乎一样，就是也要像修改一样加入 $\\text{pushdown}$，这里用图模拟一下。我们要查询 $2\\sim 4$ 区间的和，这是查询前的情况，所有紫色的代表 $\\text{lazytage}$。\n![](https://i-blog.csdnimg.cn/blog_migrate/5d01a871871b4f1393eeb3f3f333324c.png)\n然后，我们查到区间 $1\\sim 2$ 时，发现这个区间并没有被完全包括在目标区间里，于是我们就 $\\text{pushdown}$，$\\text{lazytage}$ 下传，并让每个区间 $sum$ 加上 $(r−l) \\times lazytag(r-l)$。\n![](https://i-blog.csdnimg.cn/blog_migrate/e56190e962a139b0760084236352fe90.png)\n然后查到 $2\\sim 2$ 区间，发现被完全包含，所以就返 $3$，再搜索到 $3\\sim 4$ 区间，发现被完全包含，那么直接返回 $8$，最后 $3+8=1$ 就是答案\n\n这里是代码实现：\n\n```cpp\ninline int ask(const int p,const int l,const int r){\n    if(tree[p].r<l||r<tree[p].l) return 0;\n    if(l<=tree[p].l&&tree[p].r<=r) return tree[p].sum;\n    pushdown(p);int res=0;\n    if(tree[p<<1].r>=l) res+=ask(p<<1,l,r);\n    if(tree[p<<1|1].l<=r) res+=ask(p<<1|1,l,r);\n    return res;\n}\n```\n\n---\n\n# 乘法（根号）线段树\n\n## 乘法线段树\n\n如果这个线段树只有乘法，那么直接加入 $\\text{lazytag}$ 变成乘，然后 $tree[i].sum*=k$ 就好了。但是，如果我们是又加又乘，那就不一样了。\n\n当 $\\text{lazytag}$ 下标传递的时候，我们需要考虑，是先加再乘还是先乘再加。我们只需要对 $\\text{lazytag}$ 做这样一个处理。\n\n$\\text{lazytag}$ 分为两种，分别是加法的 $\\text{plz}$ 和乘法的 $\\text{mlz}$。\n\n$\\text{mlz}$ 很简单处理，$\\text{pushdown}$ 时直接 $\\times$父亲的就可以了，那么加法呢？\n\n我们需要把原先的 $\\text{plz} \\times$ 父亲的 $\\text{mlz}$ 再 $+$ 父亲的$\\text{plz}$。\n\n```cpp\ninline void pushdwon(const int p){\n    int t1=tree[p].mlz,t2=tree[p].plz;\n    tree[p<<1].sum=(tree[p<<1].sum*t1+t2*(tree[p<<1].r-tree[p<<1].l+1))%mod;\n    tree[p<<1|1].sum=(tree[p<<1|1].sum*t1+t2*(tree[p<<1|1].r-tree[p<<1|1].l+1))%mod;\n    tree[p<<1].mlz=(tree[p<<1].mlz*t1)%mod;\n    tree[p<<1|1].mlz=(tree[p<<1|1].mlz*t1)%mod;\n    tree[p<<1].plz=(tree[p<<1].plz*t1+t2)%mod;\n    tree[p<<1|1].plz=(tree[p<<1|1].plz*t1+t2)%mod;\n    tree[p].mlz=0,tree[p].plz=0;\n}\n```\n\n然后加法和减法的函数同理，维护 $\\text{lazytag}$ 的时候加法标记一定要记得现乘再加。\n\n## 根号线段树\n\n其实，根号线段树和除法线段树一样。她们乍眼一看感觉直接用 $\\text{lazytag}$ 标记除了多少，但是实际上，会出现精度问题。\n\nc++的除法是向下取整，很明显，$(a+b)/k \\neq a/k+b/k$（在向下取整的情况下），而根号，很明显 $\\sqrt{a}+ \\sqrt{b} \\neq \\sqrt{a+b}$那么怎么办？\n\n第一个想法就是暴力，对于每个要改动的区间l~r,把里面的每个点都单独除，但这样就会把时间复杂度卡得比大暴力都慢（因为多个常数），所以怎么优化？\n\n我们对于每个区间，维护她的最大值和最小值，然后每次修改时，如果这个区间的最大值根号和最小值的根号一样，说明这个区间整体根号不会产生误差，就直接修改（除法同理）\n\n其中，$\\text{lazytag}$ 把除法当成减法，记录的是这个区间里每个元素减去的值。\n\n下面是根号线段树的修改过程：\n\n```cpp\ninline void Sqrt(const int i,const int l,const int r){\n    if(tree[i].r<l||tree[i].l>r)  return;\n    if(tree[i].l>=l&&tree[i].r<=r&&(tree[i].minn-(long long)sqrt(tree[i].minn))\n    ==(tree[i].maxx-(long long)sqrt(tree[i].maxx))){//如果这个区间的最大值最小值一样\n        long long u=tree[i].minn-(long long)sqrt(tree[i].minn);//计算区间中每个元素需要减去的\n        tree[i].lz+=u;\n        tree[i].sum-=(tree[i].r-tree[i].l+1)*u;\n        tree[i].minn-=u;\n        tree[i].maxx-=u;\n        return ;\n    }\n    push_down(i);\n    if(tree[i<<1].r>=l) Sqrt(i<<1,l,r);\n    if(tree[i<<1|1].l<=r) Sqrt(i<<1|1,l,r);\n    tree[i].sum=tree[i<<1].sum+tree[i<<1|1].sum;\n    tree[i].minn=min(tree[i<<1].minn,tree[i<<1|1].minn);\n    tree[i].maxx=max(tree[i<<1].maxx,tree[i<<1|1].maxx);\n}\n```\n\n然后 $\\text{pushdown}$ 没什么变化，就是要记得 $tree[i].minn$、$tree[i].maxx$ 也要记得$- \\text{lazytage}$。","src/content/posts/SGT.md","43865fc5eb1dfe4d",{html:362,metadata:363},"<p>对于区间(线段)的修改、维护，从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 变为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(\\log n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p>\n<hr>\n<section><h1 id=\"构建\">构建<a class=\"anchor\" href=\"#构建\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/97c81e47838bc3a2941aaf4c68933de0.png\" alt=\"\">\n这是什么意思呢？ 如果你要表示线段的和，那么最上面的根节点的权值表示的是这个线段 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 的和。根的两个儿子分别表示这个线段中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 的和，与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">3 \\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 的和。以此类推。</p><p>然后我们还可以的到一个性质：节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 的权值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>=</mo></mrow><annotation encoding=\"application/x-tex\">=</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">=</span></span></span></span> 她的左儿子权值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo></mrow><annotation encoding=\"application/x-tex\">+</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span></span></span></span> 她的右儿子权值。因为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 的和就是等于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 的和与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">2\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 的和的和。</p><p>根据这个思路，我们就可以建树了，我们设一个结构体 <code>tree</code>，<code>tree[i].l</code> 与 <code>tree[i].r</code> 分别表示这个点代表的线段的左右下标，<code>tree[i].sum</code> 表示这个节点表示的线段和。</p><p>我们知道，一颗从 1 11 开始编号的二叉树，结点 i ii 的左儿子和右儿子编号分别是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>×</mo><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">2 \\times i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>×</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2\\times i + 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7429em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>。</p><p>再根据刚才的性质，得到式子：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].sum=tree [i∗2].sum+tree[i∗2+1 ].sum</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span></span></span></span>; <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo separator=\"true\">;</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].sum=tree[i*2].sum+tree[i*2+1].sum;tree[i].sum=tree[i∗2].sum+tree[i∗2+1].sum</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span></span></span></span>; 就可以建一颗线段树了！代码如下：</p><div class=\"expressive-code\"><link rel=\"stylesheet\" href=\"/_astro/ec.d1dr8.css\"><script type=\"module\" src=\"/_astro/ec.qopfj.js\"></script><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:55ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l,tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">input[l],</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> mid</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r)</span><span style=\"--0:#F97583;--1:#F97583\">>></span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,mid);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,mid</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><hr></section>\n<section><h1 id=\"简单线段树\">简单线段树<a class=\"anchor\" href=\"#简单线段树\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><section><h2 id=\"单点修改区间查询\">单点修改，区间查询<a class=\"anchor\" href=\"#单点修改区间查询\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/22a46ac7055f8f700832ef014ed7a489.png\" alt=\"\">\n然后我们要求 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 的和，我们先从根节点开始查询，发现她的左儿子1-2这个区间和答案区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 有交集，那么我们跑到左儿子这个区间。</p><p>然后，我们发现这个区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 被完全包括在答案区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 这个区间里面，那就把她的值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 返回。</p><p>我们回到了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 区间，发现她的右儿子 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">3 \\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 区间和答案区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1 \\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 有交集，那么我们走到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 区间。</p><p>到了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">3 \\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 区间，我们发现她并没有完全包含在答案区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 里面，但发现她的左儿子 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间又交集，那么久走到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间。</p><p>到了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间，发现其被答案区间完全包含，就返回她的值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 一直到最开始。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>+</mo><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">3 + 1\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 区间的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>=</mo><mn>6</mn></mrow><annotation encoding=\"application/x-tex\">3 = 6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">6</span></span></span></span>，我们知道了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间和为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>6</mn></mrow><annotation encoding=\"application/x-tex\">6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">6</span></span></span></span>。</p><p>有人可能会说你这样是不是疯了，我拿脚都能算出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>+</mo><mn>2</mn><mo>+</mo><mn>3</mn><mo>=</mo><mn>6</mn></mrow><annotation encoding=\"application/x-tex\">1 + 2 + 3 = 6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">6</span></span></span></span>，为什么这么麻烦？！</p><p>因为这才几个数，如果一百万个数，这样时间会大大增快。</p><p>我们总结一下，线段树的查询方法：</p><ul>\n<li>如果这个区间被完全包括在目标区间里面，直接返回这个区间的值。</li>\n<li>如果这个区间的左儿子和目标区间有交集，那么搜索左儿子。</li>\n<li>如果这个区间的右儿子和目标区间有交集，那么搜索右儿子。</li>\n</ul><p>代码如下：</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:54ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> res</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l) res</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) res</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> res;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><p>关于那几个if的条件一定要看清楚，最好背下来，以防考场上脑抽推错。</p><p>然后,我们怎么修改这个区间的单点，其实这个相对简单很多，你要把区间的第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>i</mi><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">dis</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">s</span></span></span></span> 位加上 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>。那么你从根节点开始，看这个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>i</mi><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">dis</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">s</span></span></span></span> 是在左儿子还是在右儿子，在哪往哪跑，然后返回的时候，还是按照<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].sum=tree[i*2].sum+tree[i*2+1].sum</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span></span></span></span> 的原则，更新所有路过的点。</p><p>如果不理解，我还是画个图吧，其中深蓝色是去的路径，浅蓝色是返回的路径，回来时候红色的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo></mrow><annotation encoding=\"application/x-tex\">+</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span></span></span></span> 标记就是把这个点加上这个值。\n<img src=\"https://i-blog.csdnimg.cn/blog_migrate/b0f6769ede881ffe60e77f38bec50400.png\" alt=\"\"></p><p>代码如下：</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:78ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">pos</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">num</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num,</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//如果是叶子节点，那么说明找到了</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(pos</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,pos,num);</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//在哪往哪跑</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">else</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,pos,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum;</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//返回更新</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h2 id=\"区间修改单点查询\">区间修改，单点查询<a class=\"anchor\" href=\"#区间修改单点查询\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>区间修改和单点查询，我们的思路就变为：如果把这个区间加上 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>，相当于把这个区间涂上一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 的标记，然后单点查询的时候，就从上跑到下，把沿路的标记加起来就好。</p><p>这里面给区间贴标记的方式与上面的区间查找类似，原则还是那三条，只不过第一条：如果这个区间被完全包括在目标区间里面，直接返回这个区间的值变为了如果这个区间如果这个区间被完全包括在目标区间里面，讲这个区间标记 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>。</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:70ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">num</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num,</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> mid</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r)</span><span style=\"--0:#F97583;--1:#F97583\">>></span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mid) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(r</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mid) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><p>查询</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:43ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">pos</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ans</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].sum;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> mid</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r)</span><span style=\"--0:#F97583;--1:#F97583\">>></span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(pos</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mid) </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,pos);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">else</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,pos);</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><section><h3 id=\"区间修改单点查询完整代码\">区间修改单点查询完整代码<a class=\"anchor\" href=\"#区间修改单点查询完整代码\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:88ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#include</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">&#x3C;bits/stdc++.h></span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">std</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> N</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#F97583;--1:#F97583\">e</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> n,q,a[N],ans;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,t</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) t</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),x</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">static</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> sta[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">35</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> top</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{sta[top</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sta[</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">ch</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x),</span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch)),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">SGT</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">struct</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">node</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> l,r,sum;}tree[N</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">23</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l,tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">24</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">25</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> mid</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r)</span><span style=\"--0:#F97583;--1:#F97583\">>></span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">26</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,mid);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">27</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,mid</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">28</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">29</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">num</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">30</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num,</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">31</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">32</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">33</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">34</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">pos</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">35</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ans</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].sum;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">36</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">37</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">pos) </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,pos);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">38</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">pos) </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,pos);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">39</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">40</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">SGT</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">41</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">signed</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">main</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">42</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),q</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">43</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) a[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">44</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">build</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,n);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">45</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(q</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">46</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> op</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">47</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(op</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">48</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> l</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),r</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),x</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">49</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">50</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">51</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(op</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">52</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">            </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ans</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> x</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">53</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ans</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">a[x],</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#79B8FF;--1:#79B8FF\">\\n</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">54</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">55</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">56</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">57</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h3 id=\"为什么需要把路上的-numtextnumnum-加起来\">为什么需要把路上的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>num</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{num}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord text\"><span class=\"mord\">num</span></span></span></span></span> 加起来?<a class=\"anchor\" href=\"#为什么需要把路上的-numtextnumnum-加起来\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>因为我们在进行区间修改的时候，若当前区间已经被完全包含在目标区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[ l , r ]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">]</span></span></span></span> 里，直接将该区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>n</mi><mi>u</mi><mi>m</mi><mo>+</mo><mo>=</mo><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].num += k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mord\">+</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>，不需要再继续往下走了，类似 lazy 标记，所以单点查询的时候要再加上路径上的值（即原本的权值再加上经过的若干次修改的值才是这个单点的值）。</p></section></section></section>\n<section><h1 id=\"进阶线段树\">进阶线段树<a class=\"anchor\" href=\"#进阶线段树\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>区间修改、区间查询，你可能会认为，把上一章里面的这两个模块加在一起就好了，然后你就会发现你大错特错。</p><p>因为如果对于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 这个区间，你把 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">+ 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">1</span></span></span></span> ，相当于把节点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 标记，但是如果你查询 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">2\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 时，你会发现你加的时没有标记的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span>节点和没有标记的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 节点加上去，结果当然是错的。</p><p>那么我们应该怎么办？这时候 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>pushdown</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{pushdown}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">pushdown</span></span></span></span></span> 的作用就显现出来了。</p><p>你会想到，我们只需要在查询的时候，如果我们要查的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 节点在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 区间的里面，那我们就可以把 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 区间标记的那个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">+ 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">1</span></span></span></span> 给推下去这样就能顺利地加上了。\n怎么记录这个标记呢？我们需要记录一个“懒标记” <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytage</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytage}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytage</span></span></span></span></span>，来记录这个区间。</p><p>区间修改的时候，我们按照如下原则：</p><ul>\n<li>如果当前区间被完全覆盖在目标区间里，讲这个区间的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>k</mi><mo>×</mo><mo stretchy=\"false\">(</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>r</mi><mo>−</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>l</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">sum+k \\times (tree[i].r-tree[i].l+1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>。</li>\n<li>如果没有完全覆盖，则先下传懒标记。</li>\n<li>如果这个区间的左儿子和目标区间有交集，那么搜索左儿子。</li>\n<li>如果这个区间的右儿子和目标区间有交集，那么搜索右儿子。</li>\n</ul><p>然后查询的时候，将这个懒标记下传就好了，下面图解一下：\n如图，区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 分别是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mtext>、</mtext><mn>2</mn><mtext>、</mtext><mn>3</mn><mtext>、</mtext><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">1 、 2 、 3 、 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">1</span><span class=\"mord cjk_fallback\">、</span><span class=\"mord\">2</span><span class=\"mord cjk_fallback\">、</span><span class=\"mord\">3</span><span class=\"mord cjk_fallback\">、</span><span class=\"mord\">4</span></span></span></span> ，我们要把 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">+ 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">1</span></span></span></span> 。因为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 区间被完全覆盖，所以将其 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">+2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">2</span></span></span></span>，并将紫色的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytage</mtext><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">\\text{lazytage}+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytage</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 区间同理。\n<img src=\"https://i-blog.csdnimg.cn/blog_migrate/b64f0efc922c03968527c0310317e7dc.png\" alt=\"\">\n注意我们处理完这些以后，还是要按照<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>+</mo><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo>∗</mo><mn>2</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].sum=tree[i*2].sum+tree[i*2+1].sum</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span></span></span></span> 的原则返回，代码如下：</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:70ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">pushdown</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].tag){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].tag</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].tag</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> mid</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r)</span><span style=\"--0:#F97583;--1:#F97583\">>></span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(mid</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mid);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">num</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].sum</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].tag</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">pushdown</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#B392F0;--1:#B392F0\">update</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r,num);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">pushup</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p);</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//tree[p].sum=tree[p&#x3C;&#x3C;1].sum+tree[p&#x3C;&#x3C;1|1].sum;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><p>查询的时候，和上一章的几乎一样，就是也要像修改一样加入 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>pushdown</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{pushdown}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">pushdown</span></span></span></span></span>，这里用图模拟一下。我们要查询 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">2\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 区间的和，这是查询前的情况，所有紫色的代表 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytage</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytage}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytage</span></span></span></span></span>。\n<img src=\"https://i-blog.csdnimg.cn/blog_migrate/5d01a871871b4f1393eeb3f3f333324c.png\" alt=\"\">\n然后，我们查到区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">1\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 时，发现这个区间并没有被完全包括在目标区间里，于是我们就 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>pushdown</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{pushdown}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">pushdown</span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytage</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytage}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytage</span></span></span></span></span> 下传，并让每个区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">sum</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span></span></span></span> 加上 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>r</mi><mo>−</mo><mi>l</mi><mo stretchy=\"false\">)</mo><mo>×</mo><mi>l</mi><mi>a</mi><mi>z</mi><mi>y</mi><mi>t</mi><mi>a</mi><mi>g</mi><mo stretchy=\"false\">(</mo><mi>r</mi><mo>−</mo><mi>l</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(r−l) \\times lazytag(r-l)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">zy</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mclose\">)</span></span></span></span>。\n<img src=\"https://i-blog.csdnimg.cn/blog_migrate/e56190e962a139b0760084236352fe90.png\" alt=\"\">\n然后查到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>∼</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2\\sim 2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 区间，发现被完全包含，所以就返 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span>，再搜索到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>∼</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">3\\sim 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span> 区间，发现被完全包含，那么直接返回 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>8</mn></mrow><annotation encoding=\"application/x-tex\">8</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">8</span></span></span></span>，最后 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>+</mo><mn>8</mn><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">3+8=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">8</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 就是答案</p><p>这里是代码实现：</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:54ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tree[p].sum;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">pushdown</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p);</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> res</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l) res</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) res</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#B392F0;--1:#B392F0\">ask</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> res;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><hr></section>\n<section><h1 id=\"乘法根号线段树\">乘法（根号）线段树<a class=\"anchor\" href=\"#乘法根号线段树\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><section><h2 id=\"乘法线段树\">乘法线段树<a class=\"anchor\" href=\"#乘法线段树\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>如果这个线段树只有乘法，那么直接加入 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 变成乘，然后 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>s</mi><mi>u</mi><mi>m</mi><mo>∗</mo><mo>=</mo><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].sum*=k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mord\">∗</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 就好了。但是，如果我们是又加又乘，那就不一样了。</p><p>当 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 下标传递的时候，我们需要考虑，是先加再乘还是先乘再加。我们只需要对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 做这样一个处理。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 分为两种，分别是加法的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>plz</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{plz}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">plz</span></span></span></span></span> 和乘法的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>mlz</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{mlz}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">mlz</span></span></span></span></span>。</p><p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>mlz</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{mlz}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">mlz</span></span></span></span></span> 很简单处理，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>pushdown</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{pushdown}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">pushdown</span></span></span></span></span> 时直接 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>×</mo></mrow><annotation encoding=\"application/x-tex\">\\times</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">×</span></span></span></span>父亲的就可以了，那么加法呢？</p><p>我们需要把原先的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>plz</mtext><mo>×</mo></mrow><annotation encoding=\"application/x-tex\">\\text{plz} \\times</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">plz</span></span><span class=\"mord\">×</span></span></span></span> 父亲的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>mlz</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{mlz}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">mlz</span></span></span></span></span> 再 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo></mrow><annotation encoding=\"application/x-tex\">+</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span></span></span></span> 父亲的<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>plz</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{plz}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">plz</span></span></span></span></span>。</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:84ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">pushdwon</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">p</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> t1</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].mlz,t2</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].plz;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t1</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t2</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">))</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t1</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t2</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">))</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].mlz</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].mlz</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t1)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].mlz</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].mlz</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t1)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].plz</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].plz</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t1</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t2)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].plz</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[p</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].plz</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t1</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t2)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[p].mlz</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,tree[p].plz</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><p>然后加法和减法的函数同理，维护 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 的时候加法标记一定要记得现乘再加。</p></section><section><h2 id=\"根号线段树\">根号线段树<a class=\"anchor\" href=\"#根号线段树\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>其实，根号线段树和除法线段树一样。她们乍眼一看感觉直接用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 标记除了多少，但是实际上，会出现精度问题。</p><p>c++的除法是向下取整，很明显，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mi>k</mi><mo mathvariant=\"normal\">≠</mo><mi>a</mi><mi mathvariant=\"normal\">/</mi><mi>k</mi><mo>+</mo><mi>b</mi><mi mathvariant=\"normal\">/</mi><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">(a+b)/k \\neq a/k+b/k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>（在向下取整的情况下），而根号，很明显 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msqrt><mi>a</mi></msqrt><mo>+</mo><msqrt><mi>b</mi></msqrt><mo mathvariant=\"normal\">≠</mo><msqrt><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow></msqrt></mrow><annotation encoding=\"application/x-tex\">\\sqrt{a}+ \\sqrt{b} \\neq \\sqrt{a+b}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.2397em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8003em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-2.7603em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2397em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1267em;vertical-align:-0.1944em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9322em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathnormal\">b</span></span></span><span style=\"top:-2.8922em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1078em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.1494em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8906em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">b</span></span></span><span style=\"top:-2.8506em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1494em;\"><span></span></span></span></span></span></span></span></span>那么怎么办？</p><p>第一个想法就是暴力，对于每个要改动的区间l~r,把里面的每个点都单独除，但这样就会把时间复杂度卡得比大暴力都慢（因为多个常数），所以怎么优化？</p><p>我们对于每个区间，维护她的最大值和最小值，然后每次修改时，如果这个区间的最大值根号和最小值的根号一样，说明这个区间整体根号不会产生误差，就直接修改（除法同理）</p><p>其中，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>lazytag</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{lazytag}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">lazytag</span></span></span></span></span> 把除法当成减法，记录的是这个区间里每个元素减去的值。</p><p>下面是根号线段树的修改过程：</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:79ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">Sqrt</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">i</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">l</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">r</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].l</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r)  </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].l</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].r</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].minn</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#B392F0;--1:#B392F0\">sqrt</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].minn))</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].maxx</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#B392F0;--1:#B392F0\">sqrt</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].maxx))){</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//如果这个区间的最大值最小值一样</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> u</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].minn</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#B392F0;--1:#B392F0\">sqrt</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].minn);</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//计算区间中每个元素需要减去的</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].lz</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">u;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].sum</span><span style=\"--0:#F97583;--1:#F97583\">-=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i].r</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].l</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">u;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].minn</span><span style=\"--0:#F97583;--1:#F97583\">-=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">u;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].maxx</span><span style=\"--0:#F97583;--1:#F97583\">-=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">u;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">push_down</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].r</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">l) </span><span style=\"--0:#B392F0;--1:#B392F0\">Sqrt</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">r) </span><span style=\"--0:#B392F0;--1:#B392F0\">Sqrt</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,l,r);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].sum</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].sum;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].minn</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">min</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].minn,tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].minn);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tree[i].maxx</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">max</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].maxx,tree[i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">|</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">].maxx);</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><p>然后 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>pushdown</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{pushdown}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">pushdown</span></span></span></span></span> 没什么变化，就是要记得 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].minn</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">minn</span></span></span></span>、<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>i</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>a</mi><mi>x</mi><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">tree[i].maxx</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ree</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">]</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">ma</span><span class=\"mord mathnormal\">xx</span></span></span></span> 也要记得<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mtext>lazytage</mtext></mrow><annotation encoding=\"application/x-tex\">- \\text{lazytage}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">−</span><span class=\"mord text\"><span class=\"mord\">lazytage</span></span></span></span></span>。</p></section></section>",{headings:364,localImagePaths:395,remoteImagePaths:396,frontmatter:397,imagePaths:403},[365,368,371,374,377,380,383,386,389,392],{depth:14,slug:366,text:367},"构建","构建#",{depth:14,slug:369,text:370},"简单线段树","简单线段树#",{depth:52,slug:372,text:373},"单点修改区间查询","单点修改，区间查询#",{depth:52,slug:375,text:376},"区间修改单点查询","区间修改，单点查询#",{depth:171,slug:378,text:379},"区间修改单点查询完整代码","区间修改单点查询完整代码#",{depth:171,slug:381,text:382},"为什么需要把路上的-numtextnumnum-加起来","为什么需要把路上的 num\\text${num}num 加起来?#",{depth:14,slug:384,text:385},"进阶线段树","进阶线段树#",{depth:14,slug:387,text:388},"乘法根号线段树","乘法（根号）线段树#",{depth:52,slug:390,text:391},"乘法线段树","乘法线段树#",{depth:52,slug:393,text:394},"根号线段树","根号线段树#",[],[],{title:355,published:398,description:37,image:37,tags:399,category:39,draft:36,lang:37,minutes:400,words:401,excerpt:402},["Date","2025-06-10T00:00:00.000Z"],[39],13,2657,"对于区间(线段)的修改、维护，从 O(n) 变为 O(\\log n)。",[],"SGT.md","dp_impove",{id:405,data:407,body:411,filePath:412,digest:413,rendered:414,legacyId:508},{title:408,published:409,draft:36,description:37,image:37,tags:410,category:39,lang:37,prevTitle:37,prevSlug:37,nextTitle:37,nextSlug:37},"DP进阶",["Date","2025-06-11T00:00:00.000Z"],[39],"---\n# 树形DP\n\n树形 $\\text{DP}$，即在树上进行的 $\\text{DP}$。\n由于遍历树固有的递归性质，树形 $\\text{DP}$ 一般都是递归进行的。我们将从一些经典模型和例子开始。\n## 求所有点的子树大小\n```cpp\ninline void dfs(const int u,const int f){\n\tsiz[u]=1;\n\tfor(int i=head[u];i;i=edge[i].next){\n\t\tint v=edge[i].to;\n\t\tif(f!=v) dfs(v,u);\n\t\tsiz[u]+=siz[v];\n\t}\n}\n```\n## 树上最大独立集\n给出⼀个 $n$ 个点的树，每个点有权值 $w_{i}$，要求选出⼀个点集权值和最大。使得没有⼀条边两端的点同时被选。\n要求时间复杂度 $O(n)$。\n\n常见的树形 $\\text{DP}$ 都会记录 $f_{u,0/1}$ 答案（视情况分析）。\n在这个题里，可以这样设计状态 $f_{u,0/1}$ 分别表⽰**不选**和**选了**的情况下的答案。\n因为树天生具有⼀种无后效性，想要合并儿子的信息只需要儿子那⼀个点的信息。\n也就是子树内做完 $\\text{DP}$ 之后，只需要保留根的信息就好了，同时采用 $\\text{dfs}$ 的方法来 $\\text{DP}$。\n\n```cpp\ninline void dfs(const int u,const int f){\n\tf[u][0]=0,f[u][1]=w[u];\n\tfor(int i=head[u];i;i=edge[i].next){\n\t\tint v=edge[i].to;\n\t\tif(f!=v) dfs(v,u);\n\t\tf[u][0]+=max(f[v][0],f[v][1]); // 若u不选，则⼉⼦可选可不选，取⼤者。\n\t\tf[u][1]+=f[v][0];// 若u选上，则⼉⼦只能不选。\n\t}\n}\n```\n## 树上背包\n树上的背包问题，简单来说就是背包问题与树形 $\\text{DP}$ 的结合。\n在此之前需要了解基本的**背包模型**和**背包的合并**。\n> Attention:\n> 树上背包问题代码时间复杂度是 $O(n^{2})$ 的。\n### 例题：[P2014 [CTSC1997] 选课](https://www.luogu.com.cn/problem/P2014)\n给出 $n$ 个点的森林，每个点有权值 $a_{i}$，要求选了⼀个点必然要选其父亲。求出选择 $m$ 个点能得到的最⼤权值和。\n数据范围：$1 \\le n,m \\le 300$。\n\n可以加 $1$ 个点编号为 $0$，将森林变为一棵树。\n考虑背包问题解法为设当前取了多少个元素。可以借鉴此方法，设 $f_{u,i}$ 为以 $u$ 为根的子树选了 $i$ 个节点的最大权值和。一个点如果选了，则它的父亲节点必定选了，那么每个节点的初始值为 $1$。接着考虑每个背包的合并。\n\n可得状态转移方程为：$f_{u,i+j} = \\max \\limits_{1 \\le i \\le \\min(siz_{u},m+1),1 \\le j \\le siz_{v},i + j \\le m+1} (f_{u,i+j},f_{u,i}+f_{v,j})$。\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=3e2+5;\nstruct node{int to,next;}edge[N<<1];\nint n,m,w[N],head[N],cnt,f[N][N],g[N],siz[N];\ninline void add(const int u,const int v){\n    edge[++cnt].next=head[u];\n    edge[cnt].to=v;\n    head[u]=cnt;\n}\nnamespace rw{\n    inline int read(){\n        int tot=0,t=1;char ch=getchar();\n        while(ch<'0'||ch>'9'){if(ch=='-') t=-1;ch=getchar();}\n        while(ch>='0'&&ch<='9'){tot=tot*10+ch-'0';ch=getchar();}\n        return tot*t;\n    }\n    inline void write(int x){\n        if(x<0) putchar('-'),x=-x;\n        static int sta[35];int top=0;\n        do{sta[top++]=x%10,x/=10;}while(x);\n        while(top) putchar(sta[--top]+'0');\n    }\n    inline void file(){\n        freopen(\".in\",\"r\",stdin);\n        freopen(\".out\",\"w\",stdout);\n    }\n    inline void print(const int x,const char ch){return (write(x),putchar(ch)),void(0);}\n}using namespace rw;\ninline void bag(const int u,const int v){\n    for(int i=1;i<=siz[u];i++){\n        for(int j=0;j<=siz[v];j++){\n            g[i+j]=max(g[i+j],f[u][i]+f[v][j]);\n        }\n    }\n    siz[u]+=siz[v];\n    for(int i=1;i<=siz[u];i++) f[u][i]=g[i],g[i]=0;\n}\ninline void dfs(const int u){\n    f[u][1]=w[u],siz[u]=1;\n    for(int i=head[u];i;i=edge[i].next){\n        int v=edge[i].to;dfs(v);\n        bag(u,v);\n    }\n}\nsigned main(){\n    n=read(),m=read();m++;\n    for(int i=1;i<=n;i++){\n        int k=read();w[i]=read();\n        add(k,i);\n    }\n    dfs(0);\n    print(f[0][m],'\\n');\n    return 0;\n}\n```\n### [P11363 [NOIP2024] 树的遍历](https://www.luogu.com.cn/problem/P11363)\n题意详见原题。\n\n首先考虑 $k=1$ 的答案。已经知道开始边，对于每一条边是从一条边转移过来，在以任意顺序遍历它的子树，则答案就是：$\\prod{(deg_i-1)!}$。\n接着考虑 $k=2$ 的答案。将两边连成一条链显然答案为 $(deg_i-2)!$。\n![](https://cdn.luogu.com.cn/upload/image_hosting/hxos5ogw.png)\n上图中，红边为可能为起始边的边，蓝边为其中一种遍历方法。\n\n然后，思考若起始边一定是一条从叶子节点出发去往叶子节点的一条链。证明：考虑一个点的周围全是黑边，这些边内部的蓝边一定为一条链，对于一条链来说，起始边必然为链的一端。当一条链确定是答案为：$\\prod{(deg_i-1)!} \\times \\prod{(deg_u-1)^{-1}}$，$i$ 为所有点，$u$ 为链上的节点。\n\n现在问题转化为：**有一棵边权为 $0/1$ 的树，点有点权，求所有叶子到叶子的链，满足链上有一条 $1$ 的边，点的权值乘积的和**。\n\n对于这个问题可以取一个非叶子节点做根，记录每个子树内有无 $1$ 总和为 $dp_{u,0/1}$，计算贡献即可。\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=1e5+5,mod=1e9+7;\nstruct node{int to,next,flag;}edge[N<<1];\nint n,k,head[N],cnt,chose[N],du[N],u[N],v[N],ans,f[N][2],inv[N];\ninline void add(const int u,const int v,const int flag){\n    edge[++cnt].next=head[u];\n    edge[cnt].to=v;\n    edge[cnt].flag=flag;\n    head[u]=cnt;\n}\nnamespace rw{\n    inline int read(){\n        int tot=0,t=1;char ch=getchar();\n        while(ch<'0'||ch>'9'){if(ch=='-') t=-1;ch=getchar();}\n        while(ch>='0'&&ch<='9'){tot=tot*10+ch-'0';ch=getchar();}\n        return tot*t;\n    }\n    inline void write(int x){\n        if(x<0) putchar('-'),x=-x;\n        static int sta[35];int top=0;\n        do{sta[top++]=x%10,x/=10;}while(x);\n        while(top) putchar(sta[--top]+'0');\n    }\n    inline void file(){\n        freopen(\".in\",\"r\",stdin);\n        freopen(\".out\",\"w\",stdout);\n    }\n    inline void print(const int x,const char ch){return (write(x),putchar(ch)),void(0);}\n}using namespace rw;\ninline void dfs(const int u,const int fa){\n    f[u][1]=f[u][0]=0;int val=0;\n    for(int i=head[u];i;i=edge[i].next){\n        int v=edge[i].to,flag=edge[i].flag;if(fa==v) continue;dfs(v,u);\n        if(flag) f[v][1]+=f[v][0],f[v][0]=0;\n        val=(val+f[v][1]*(f[u][0]+f[u][1])+f[v][0]*f[u][1])%mod;\n        f[u][0]=(f[u][0]+f[v][0])%mod,f[u][1]=(f[u][1]+f[v][1])%mod;\n    }\n    int INV=inv[du[u]];ans=(ans+val*INV)%mod;if(!du[u]) f[u][0]++;\n    f[u][0]=(f[u][0]*INV)%mod;\n    f[u][1]=(f[u][1]*INV)%mod;\n}\ninline void init(){for(int i=1;i<=n;i++) head[i]=0,du[i]=-1,chose[i]=0;cnt=0,ans=0;}\ninline void solve(){\n    n=read(),k=read();init();\n    for(int i=1;i<n;i++){u[i]=read(),v[i]=read();du[u[i]]++,du[v[i]]++;}\n    for(int i=1;i<=k;i++){int x=read();chose[x]=1;}\n    if(n==2) return print(1,'\\n'),void(0);\n    for(int i=1;i<n;i++) add(u[i],v[i],chose[i]),add(v[i],u[i],chose[i]);\n    int rt=0;for(int i=1;i<=n;i++) if(du[i]) rt=i;dfs(rt,0);\n    for(int i=1;i<=n;i++) for(int j=1;j<=du[i];j++) ans=(ans*j)%mod;\n    print(ans,'\\n');\n}\nsigned main(){\n    inv[0]=inv[1]=1;\n    for(int i=2;i<=N;i++) inv[i]=inv[mod%i]*(mod-mod/i)%mod;\n    int c=read(),T=read();\n    while(T--) solve();\n    return 0;\n}\n```\n## 换根 $\\text{DP}$\n树形换根 $\\text{DP}$ 问题又称为*二次扫描*，通常不会指定树的根，且随着根的变换某些值也会发生改变，如子节点深度和、点权值和。\n通常进行两次 $\\text{DFS}$，第一次 $\\text{DFS}$ 求出子树内的值，第二次 $\\text{DFS}$ 进行换根操作。\n### 例题：[P3478 [POI 2008] STA-Station](https://www.luogu.com.cn/problem/P3478)\n给定一个 $n$ 个点的树，请求出一个结点，使得以这个结点为根时，所有结点的深度之和最大。\n一个结点的深度之定义为该节点到根的简单路径上边的数量。\n对于全部的测试点，保证 $1 \\le n \\le 10^{6},1 \\le u,v \\le n$，给出的是一棵树。\n\n很明显换根 $\\text{DP}$。对于第一次 $\\text{DFS}$ 求出以 $1$ 为根的 每个子树的深度和&每个子树的大小，将每个子树的深度加入 $f_{1}$。对于第二次 $\\text{DFS}$ 考虑换根，将根为 $u$ 转换为 $v$，则根为 $v$ 的子树的深度 $-1$，其他 $+1$，转移方程为：$f_{v}=f_{u}+n-2 \\times siz_{v}$。最后将所有的 $f_{i}$ 最大值输出即可。\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=1e6+5;\nstruct node{int to,next;}edge[N<<1];\nint n,head[N],cnt,siz[N],dep[N],f[N],ans,maxn;\ninline void add(const int u,const int v){\n    edge[++cnt].next=head[u];\n    edge[cnt].to=v;\n    head[u]=cnt;\n}\nnamespace rw{\n    inline int read(){\n        int tot=0,t=1;char ch=getchar();\n        while(ch<'0'||ch>'9'){if(ch=='-') t=-1;ch=getchar();}\n        while(ch>='0'&&ch<='9'){tot=tot*10+ch-'0';ch=getchar();}\n        return tot*t;\n    }\n    inline void write(int x){\n        if(x<0) putchar('-'),x=-x;\n        static int sta[35];int top=0;\n        do{sta[top++]=x%10,x/=10;}while(x);\n        while(top) putchar(sta[--top]+'0');\n    }\n    inline void file(){\n        freopen(\".in\",\"r\",stdin);\n        freopen(\".out\",\"w\",stdout);\n    }\n    inline void print(const int x,const char ch){return (write(x),putchar(ch)),void(0);}\n}using namespace rw;\ninline void dfs_init(const int u,const int fa){\n    siz[u]=1,dep[u]=dep[fa]+1;\n    for(int i=head[u];i;i=edge[i].next){\n        int v=edge[i].to;\n        if(fa==v) continue;\n        dfs_init(v,u);siz[u]+=siz[v];\n    }\n}\ninline void dfs_do(const int u,const int fa){\n    for(int i=head[u];i;i=edge[i].next){\n        int v=edge[i].to;\n        if(fa==v) continue;\n        f[v]=f[u]+n-2*siz[v];\n        dfs_do(v,u);\n    }\n}\nsigned main(){\n    n=read();\n    for(int i=1;i<n;i++){\n        int u=read(),v=read();\n        add(u,v),add(v,u);\n    }\n    dfs_init(1,0);for(int i=1;i<=n;i++) f[1]+=dep[i];dfs_do(1,0);\n    for(int i=1;i<=n;i++) if(maxn<f[i]) maxn=f[i],ans=i;\n    print(ans,'\\n');\n    return 0;\n}\n```\n---\n# 状压 $\\text{DP}$\n状压 $\\text{DP}$ 是动态规划的一种，通过将状态压缩为整数来达到优化转移的目的。是利用计算机二进制的性质来描述状态的一种 $\\text{DP}$ 方式。\n\n状压 $\\text{DP}$ 其实就是将状态压缩成 $2$ 进制来保存 其特征就是看起来有点像搜索，每个格子的状态只有 $1$ 或 $0$，是另一类非常典型的动态规划。\n\n为了更好的理解状压 $\\text{DP}$，首先介绍**位运算**相关的知识。\n\n- `&`符号，$x \\& y$，会将两个十进制数在二进制下进行与运算（都 $1$ 为 $1$，其余为 $0$） 然后返回其十进制下的值。例如$3(11)\\&2(10)=2(10)$。\n- `|`符号，$x | y$，会将两个十进制数在二进制下进行或运算（都0为0，其余为1） 然后返回其十进制下的值。例如 $3(11) | 2(10)=3(11)$。\n- `^`符号，$x \\  \\^{} \\ y$，会将两个十进制数在二进制下进行异或运算（不同为1，其余 为0）然后返回其十进制下的值。例如 $3(11)\\ \\^{} \\ 2(10)=1(01)$。\n- `~`符号，$\\~{} \\ x$，按位取反。例如 $\\~{} \\ 101=010$。\n- `<<`符号，左移操作，$x<<2$，将 $x$ 在二进制下的每一位向左移动两位，最右边用 $0$ 填充，$x<<2$ 相当于让 $x$ $\\times 4$。\n- `>>`符号，是右移操作，$x>>1$ 相当于给 $x/2$，去掉 $x$ 二进制下的最右一位\n\n1. 判断一个数字 $x$ 二进制下第 $i$ 位是不是等于 $1$。（最低第 $1$ 位）\n方法：`if(((1<<(i−1))&x)>0)` 将 $1$ 左移 $i-1$ 位，相当于制造了一个只有第 $i$ 位上是 $1$，其他位上都是 $0$ 的二进制数。然后与 $x$ 做与运算，如果结果 $>0$， 说明 $x$ 第 $i$ 位上是 $1$，反之则是 $0$。\n2. 将 $x$ 的第i位更改成 $1$。\n方法：`x|=(1<<(i−1))`证明方法与 $1$ 类似。\n3. 将 $x$ 的第 $i$ 位更改成$0$。\n方法：`x&=(~(1<<(i−1)))`\n4. 将 $x$ 最靠右的 $1$ 去掉。\n方法：`x=x&(x−1)`\n5. 取出 $x$ 的第 $i$ 位。\n方法：`(x>>(i-1))&1`\n6. 将 $x$ 的第 $i$ 位取反。\n方法：`x^=((1<<(i-1))`\n7. 取出 $x$ 最靠右的 $1$。\n方法：`x&(-x)`\n8. 判断是否有两个连续的 $1$。\n方法：`if(x&(x<<1))`\n9. 枚举子集。\n方法：`for(int x=sta;x;x=((x-1)&sta) cout<<x;`\n\n\n### 例题1：[P1896 [SCOI2005] 互不侵犯](https://www.luogu.com.cn/problem/P1896)\n在 $N \\times N$ 的棋盘里面放 $K$ 个国王，使他们互不攻击，共有多少种摆放方案。国王能攻击到它上下左右，以及左上左下右上右下八个方向上附近的各一个格子，共 $8$ 个格子。\n对于全部数据，$1 \\le N \\le 9，0  \\le K \\le N \\times N$。\n\n首先只考虑一行，此时这一行的国王的状态只与上一行和这一行的国王有关。\n![](https://oi-wiki.org/dp/images/SCOI2005-%E4%BA%92%E4%B8%8D%E4%BE%B5%E7%8A%AF.png)\n以上这个例子中国王的状态可以用二进制表示为 $101001_{(2)}$。\n于是我们有了三个状态：第几行 $i$、此行的状态 $j$、已经使用的国王数 $s$。\n考虑状态转移。先预处理出每个状态 $sit_x$，其中包含了二进制的 $1$ 的个数，及这行放的国王个数 $cnt_x$，于是就有状态转移方程：$f_{i,j,s} = \\sum \\limits_{2 \\le i \\le n,1 \\le j \\le tot,1 \n\\le k \\le tot} f_{i-1,k,s-cnt_{j}}$。\n接着考虑国王的合法情况，运用位运算来判断两个状态在同一个或相邻位置是否有国王：\n- `if(sit[j]&sit[k])`(上下有重复的国王)\n- `if((sit[j]<<1)&sit[k])`(左上右下有重复的国王)\n- `if(sit[j]&(sit[k]<<1))`(右上左下有重复的国王)\n\n这样就将不符合题意的状态去掉。\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=2e3+5;\nint n,k,f[10][N][105]={0},sit[N],cnt[N],tot=0,ans=0;\nnamespace rw{\n    inline int read(){\n        int tot=0,t=1;char ch=getchar();\n        while(ch<'0'||ch>'9'){if(ch=='-') t=-1;ch=getchar();}\n        while(ch>='0'&&ch<='9'){tot=tot*10+ch-'0';ch=getchar();}\n        return tot*t;\n    }\n    inline void write(int x){\n        if(x<0) putchar('-'),x=-x;\n        static int sta[35];int top=0;\n        do{sta[top++]=x%10,x/=10;}while(x);\n        while(top) putchar(sta[--top]+'0');\n    }\n    inline void file(){\n        freopen(\".in\",\"r\",stdin);\n        freopen(\".out\",\"w\",stdout);\n    }\n    inline void print(const int x,const char ch){return (write(x),putchar(ch)),void(0);}\n}using namespace rw;\ninline void dfs(const int h,const int sum,const int step){\n    if(step>=n){\n        sit[++tot]=h;\n        cnt[tot]=sum;\n        return;\n    }\n    dfs(h,sum,step+1);\n    dfs(h+(1<<step),sum+1,step+2);\n}\nsigned main(){\n    n=read(),k=read();dfs(0,0,0);\n    for(int i=1;i<=tot;i++) f[1][i][cnt[i]]=1;\n    for(int i=2;i<=n;i++){\n        for(int j=1;j<=tot;j++){\n            for(int l=1;l<=tot;l++){\n                if((sit[j]&sit[l])||((sit[j]<<1)&sit[l])||(sit[j]&(sit[l]<<1))) continue;\n                for(int s=k;s>=cnt[j];s--) f[i][j][s]+=f[i-1][l][s-cnt[j]];\n            }\n        }\n    }\n    for(int i=1;i<=tot;i++) ans+=f[n][i][k];\n    print(ans,'\\n');\n    return 0;\n}\n```\n\n### 例题2：[P3959 [NOIP 2017 提高组] 宝藏](https://www.luogu.com.cn/problem/P3959)\n题面详见原题。\n\n### 例题3：[CF1767E](https://www.luogu.com.cn/problem/CF1767E) [Algebra Flash](https://codeforces.com/problemset/problem/1767/E)\n给出⼀个 $n \\le 40$ 个点的图，每个点有权值，求其最大权独立集。\n\n---\n# 数位 $\\text{DP}$\n此类问题的特征比较明显，常见的形式是数 $[l,r]$ 内满足某个条件的数字个数，这个数字可能很大。\n\n考虑人类计数的⽅式，最朴素的计数就是从小到大开始依次加⼀。但我们发现对于位数比较多的数，这样的过程中有许多重复的部分。\n例如，从 $7000$ 数到 $7999$ 从 $8000$ 数到 $8999$、和从 $9000$ 数到 $9999$ 的过程⾮常相似，它们都是后三位从 $000$ 变到 $999$，不⼀样的地⽅只有千位这⼀位，所以我们可以把这些过程合并起来，⽤ $\\text{DP}$ 的⽅式进⾏状态转移。\n\n我们可以用 $f ( n )$ 表示 $[ 0 , n ]$ 的所有满足条件的个数，那么对于 $[ l , r ]$ 我们就可以用 $[ l , r ] \\iff f ( r ) − f ( l − 1 )$，前缀和思想。那么也就是说我们只要求出 $f ( n )$ 即可。那么数位 $\\text{DP}$ 关键的思想就是从树的角度来考虑。将数拆分成位，从高位到低位开始枚举。我们可以视 $N$ 为 $n$ 位数，那么我们拆分$N:a_{n}、a_{n-1}...a_1$。那么我们就可以开始分解建树，如下。之后我们就可以预处理再求解 $f ( n )$ 了。\n![](https://i-blog.csdnimg.cn/blog_migrate/e4e4bdb49dde528bc9e22713b7fde44a.png)\n\n### 例题1：[P2602 [ZJOI2010] 数字计数](https://www.luogu.com.cn/problem/P2602)\n给定两个正整数 $a$ 和 $b$，求在 $[a,b]$ 中的所有整数中，每个数码各出现了多少次。\n对于 $100 \\%$ 的数据，保证 $1 \\le a \\le b \\le 10^{12}$。 \n\n首先差分⼀下，变成求解 $[1,r]$ 的答案。\n发现唯⼀的⼀个问题是前导零和当前是否顶着 $r$ 的上界，记录这两者即可。常见的实现方法是记忆化搜索。\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nint f[20][20],num[20],a,b;\nnamespace rw{\n    inline int read(){\n        int tot=0,t=1;char ch=getchar();\n        while(ch<'0'||ch>'9'){if(ch=='-') t=-1;ch=getchar();}\n        while(ch>='0'&&ch<='9'){tot=tot*10+ch-'0';ch=getchar();}\n        return tot*t;\n    }\n    inline void write(int x){\n        if(x<0) putchar('-'),x=-x;\n        static int sta[35];int top=0;\n        do{sta[top++]=x%10,x/=10;}while(x);\n        while(top) putchar(sta[--top]+'0');\n    }\n    inline void file(){\n        freopen(\".in\",\"r\",stdin);\n        freopen(\".out\",\"w\",stdout);\n    }\n    inline void print(const int x,const char ch){return (write(x),putchar(ch)),void(0);}\n}using namespace rw;\ninline int dp(const int pos,const int flag,const int sum,const int d,const int qdl){\n    int res=0,up=9;//flag为1表示有限制，lead为0表示有前导0\n    if(pos==0) return sum;//边界条件\n    if(!flag&&qdl&&f[pos][sum]!=-1) return f[pos][sum];//记忆化\n    if(flag) up=num[pos];\n    for(int i=0;i<=up;i++){\n        res+=dp(pos-1,(i==up&&flag),sum+((i||qdl)&&(i==d)),d,qdl||i);\n    }\n    if(!flag&&qdl) f[pos][sum]=res;\n    return res;\n}\ninline int solve(int x,const int d){\n    memset(f,-1,sizeof(f));\n    int len=0;\n    while(x){\n        num[++len]=x%10;//最高位在第一位 \n        x/=10;\n    }\n    return dp(len,1,0,d,0);\n}\nsigned main(){\n    a=read(),b=read();\n    for(int i=0;i<=9;i++) print(solve(b,i)-solve(a-1,i),' ');\n    return 0;\n}\n```\n---\n# 概率 $\\text{DP}$ 和期望 $\\text{DP}$\n前置知识：概率和期望，高斯消元法。\n由于概率和期望联系紧密，且常常以期望 $\\text{DP}$ 的形式出现，所以下面会多讲⼀点期望相关。虽然随机变量的期望在大纲中是超纲的，但是平时运用还是非常广泛的。\n\n## 概率 $\\text{DP}$\n这类题目采用顺推，也就是从初始状态推向结果。\n和⼀般的 $\\text{DP}$ 类似，难点依然是对状态转移方程的刻画，只是这类题目经过了概率论知识的包装。\n### 例题：[CF148D](https://codeforces.com/problemset/problem/148/D) [Bag of mice](https://www.luogu.com.cn/problem/CF148D)\n袋子里有 $w$ 只白鼠和 $b$ 只黑鼠 ，$A$ 和 $B$ 轮流从袋子里抓，谁先抓到白色谁就赢。$A$ 每次随机抓一只，$B$ 每次随机抓完一只之后会有另一只随机老鼠跑出来。如果两个人都没有抓到白色则 $B$ 赢。$A$ 先抓，问 $A$ 赢的概率。\n范围：$0 \\le w ,b \\le 1000$。\n\n设 $f_{i,j}$ 表示当前有 $i$ 只白鼠，$j$ 只黑鼠时 $A$ 的获胜概率。\n考虑一论中的情况：\n - 先手摸到白鼠，直接获胜。\n - 先手摸到黑鼠，后手摸到白鼠，直接失败。\n - 先手摸到黑鼠，后手摸到黑鼠，跑出白鼠。通过 $f_{i-1,j-2}$ 转移。\n - 先手摸到黑鼠，后手摸到黑鼠，跑出黑鼠。通过 $f_{i,j-3}$ 转移。\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=1005;\nint w,b;double f[N][N];\nnamespace rw{\n    inline int read(){\n        int tot=0,t=1;char ch=getchar();\n        while(ch<'0'||ch>'9'){if(ch=='-') t=-1;ch=getchar();}\n        while(ch>='0'&&ch<='9'){tot=tot*10+ch-'0';ch=getchar();}\n        return tot*t;\n    }\n    inline void write(int x){\n        if(x<0) putchar('-'),x=-x;\n        static int sta[35];int top=0;\n        do{sta[top++]=x%10,x/=10;}while(x);\n        while(top) putchar(sta[--top]+'0');\n    }\n    inline void file(){\n        freopen(\".in\",\"r\",stdin);\n        freopen(\".out\",\"w\",stdout);\n    }\n    inline void print(const int x,const char ch){return (write(x),putchar(ch)),void(0);}\n}using namespace rw;\nsigned main(){\n    w=read(),b=read();\n    for(int i=1;i<=w;i++) f[i][0]=1.0,f[i][1]=1.0*i/(i+1);\n    if(!b||b==1) return cout<<fixed<<setprecision(9)<<f[w][b]<<'\\n',0;\n    for(int i=1;i<=w;i++){\n        for(int j=2;j<=b;j++){\n            f[i][j]=1.0*i/(i+j);\n            f[i][j]+=1.0*j/(i+j)*(j-1)/(i+j-1)*i/(i+j-2)*f[i-1][j-2];\n            if(j^2) f[i][j]+=1.0*j/(i+j)*(j-1)/(i+j-1)*(j-2)/(i+j-2)*f[i][j-3];\n        }\n    }\n    cout<<fixed<<setprecision(9)<<f[w][b]<<'\\n';\n    return 0;\n}\n```\n## 期望 $\\text{DP}$\n下面的题目都带有“期望”。\n常见的离散期望可以表示为某个事件的权值乘发生的概率之和。\n⼀些期望题就是符合条件的方案数除以总方案数。\n另⼀些考察期望线性性的题就比较难了，需要合理的拆分期望。\n### 例题1：[AT_dp_j](https://atcoder.jp/contests/dp/tasks/dp_j) [Sushi](https://www.luogu.com.cn/problem/AT_dp_j)\n现有 $N$ ($1 \\le N \\le 300$)个盘子，编号为 $1,2,3,…,N$。第 $i$ 个盘子中放有 $a_i$ ($1 \\le a_i \\le 3$)个寿司。接下来每次执行以下操作，直至吃完所有的寿司。从第 $1,2,3,…,N$ 个盘子中任选一个盘子，吃掉其中的一个寿司。若没有寿司则不吃。若将所有寿司吃完，请问此时操作次数的数学期望是多少？\n范围：$1 \\le N \\le 300$，$1 \\le a_i \\le 3$。\n\n设 $f_{i,j,k}$ 表示有 $i$ 个盘子有 $1$ 个寿司，$j$ 个盘子有 $2$ 个寿司，$k$ 个盘子有 $3$ 个寿司时吃完所有寿司的期望值。显然 $0$ 个的有 $n-i-j-k$ 个。\n考虑转移。枚举到那个数，则 $f_{i,j,k}$ 为以下四项之和：\n- 枚举到 $0$，$\\dfrac{n-i-j-k}n(f_{i,j,k}+1)$。\n- 枚举到 $1$，$\\dfrac in(f_{i-1,j,k}+1)$。\n- 枚举到 $2$，$\\dfrac jn(f_{i+1,j-1,k}+1)$。\n- 枚举到 $3$，$\\dfrac kn(f_{i,j+1,k-1}+1)$。\n合并即是：$f_{i,j,k}=\\dfrac{(n-i-j-k)f_{i,j,k}+if_{i-1,j,k}+jf_{i+1,j-1,k}+kf_{i,j+1,k-1}+n}n$。\n将以上式子化简得：$f_{i,j,k}=\\dfrac{if_{i-1,j,k}+jf_{i+1,j-1,k}+kf_{i,j+1,k-1}+n}{i+j+k}$。\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=305;\nint n,a[10];double f[N][N][N];\nnamespace rw{\n    inline int read(){\n        int tot=0,t=1;char ch=getchar();\n        while(ch<'0'||ch>'9'){if(ch=='-') t=-1;ch=getchar();}\n        while(ch>='0'&&ch<='9'){tot=tot*10+ch-'0';ch=getchar();}\n        return tot*t;\n    }\n    inline void write(int x){\n        if(x<0) putchar('-'),x=-x;\n        static int sta[35];int top=0;\n        do{sta[top++]=x%10,x/=10;}while(x);\n        while(top) putchar(sta[--top]+'0');\n    }\n    inline void file(){\n        freopen(\".in\",\"r\",stdin);\n        freopen(\".out\",\"w\",stdout);\n    }\n    inline void print(const int x,const char ch){return (write(x),putchar(ch)),void(0);}\n}using namespace rw;\nsigned main(){\n    n=read();\n    for(int i=1;i<=n;i++){\n        int x=read();\n        a[x]++;\n    }\n    for(int k=0;k<=n;k++){\n        for(int j=0;j<=n;j++){\n            for(int i=0;i<=n;i++){\n                if(!i&&!j&&!k) continue;\n                f[i][j][k]=n;\n                if(i) f[i][j][k]+=i*f[i-1][j][k];\n                if(j) f[i][j][k]+=j*f[i+1][j-1][k];\n                if(k) f[i][j][k]+=k*f[i][j+1][k-1];\n                f[i][j][k]/=i+j+k;\n            }\n        }\n    }\n    cout<<fixed<<setprecision(10)<<f[a[1]][a[2]][a[3]]<<'\\n';\n    return 0;\n}\n```\n\n## 待定系数法\n设 $f_i$ 表⽰从 $i$ 开始走到终点的期望步数。\n那么 $f_i$ 可以用 $k \\times f_0 +b$ 来表⽰，最后解出 $f_0$ 即可。\n\n---\n# $\\text{DP}$ 方法\n## 排列方法\n通常是不给出排列，形如求满足某条件的所有排列的权值之和的问题。\n### 逐步生成\n- 从左往右依次确定绝对值\n- 从小到大依次确定绝对位置\n- 从左往右依次确定相对大小(在前缀中的排名)\n- 从小到大依次插入序列中\n### 例题1：[AT_dp_t](https://atcoder.jp/contests/dp/tasks/dp_t) [Permutation](https://www.luogu.com.cn/problem/AT_dp_t)\n有一个长为 $N$ 的正整数排列。给定一个由 $<$ 和 $>$ 组成长为 $N−1$ 的的字符串。 对于任意满足 $1 \\le i \\le N−1$ 的字符 $s_i$，如果 $s_i$ 是 $<$ 则 $P_i<P_{i+1}$ 如果 $s_i$ 是 $>$ 则 $P_i>P_{i+1}$。求满足这样的性质的排列 $P$ 的方案数。答案对 $10^9+7$ 取模。\n范围：$2 \\le N \\le 3000$。\n\n这里采用 *从左往右依次确定相对大小(在前缀中的排名)* 的方法求解。\n首先设 $f_{i,j}$ 表示在前 $i$ 个位置上填入 $1 \\to i$，且最后一位为 $j$ 的方案数，显然边界为 $f_{1,1}=1$。接下来考虑转移。我们可以将前 $i-1$ 中 $\\geq j$ 都 $+1$ 以保证是排列，枚举第 $i-1$ 个数是多少，我们就得到了转移方程：\n$$ f(x)=\\left\\{\\begin{aligned}{\\textstyle \\sum_{j-1}^{k=1}} f_{i-1,k}，s_i=\"<\" \\\\{\\textstyle \\sum_{i-1}^{k=1}} f_{i-1,k}，s_i=\">\"\\end{aligned}\\right.$$\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=3005,mod=1e9+7;\nint n,f[N][N],sum[N][N];char s[N];\nnamespace rw{\n    inline int read(){\n        int tot=0,t=1;char ch=getchar();\n        while(ch<'0'||ch>'9'){if(ch=='-') t=-1;ch=getchar();}\n        while(ch>='0'&&ch<='9'){tot=tot*10+ch-'0';ch=getchar();}\n        return tot*t;\n    }\n    inline void write(int x){\n        if(x<0) putchar('-'),x=-x;\n        static int sta[35];int top=0;\n        do{sta[top++]=x%10,x/=10;}while(x);\n        while(top) putchar(sta[--top]+'0');\n    }\n    inline void file(){\n        freopen(\".in\",\"r\",stdin);\n        freopen(\".out\",\"w\",stdout);\n    }\n    inline void print(const int x,const char ch){return (write(x),putchar(ch)),void(0);}\n}using namespace rw;\nsigned main(){\n    n=read();for(int i=1;i<=n;i++) s[i]=getchar();f[1][1]=1;\n    for(int i=1;i<=n;i++) sum[1][i]=1;\n    for(int i=2;i<=n;i++){\n        for(int j=1;j<=i;j++){\n            if(s[i-1]=='<') f[i][j]=sum[i-1][j-1]%mod;\n            if(s[i-1]=='>') f[i][j]=(sum[i-1][i-1]-sum[i-1][j-1]+mod)%mod;\n            sum[i][j]=(sum[i][j-1]+f[i][j])%mod;\n        }\n    }\n    print(sum[n][n]%mod,'\\n');\n    return 0;\n}\n```\n\n### 例题2：[CF1806D](https://codeforces.com/contest/1806/problem/D) [DSU Master](https://www.luogu.com.cn/problem/CF1806D)\n给出序列 $a$。对于一个长度为 $m−1$ 的排列 $p$，定义它的价值如下：有一个初始为森林的并查集，按照 $p_1...p_m-1$ 的顺序合并并查集 $p_i$ 和 $p_{i+1}$，如果 $a_{p_{i}}=1$，那么将 $p_{i}+1$ 所在的并查集的根并到 $p_i$ 所在的并查集的根上，否则将 $p_i$ 并所在并查集到 $p_i+1$ 所在的并查集的根上，进行完所有操作后 $1$ 的儿子的个数。你需要对于所有 $k \\in [1,n−1]$ 求出长度为 $k$ 的 $k!$ 中排列顺序的价值和，对 $998244353$ 取模。\n\n根据连边方式，⼀个连通块始终是值域上的⼀个区间。\n首先拆贡献，考虑 $p_i=x$ 什么时候会产生贡献，首先要 $a_x=0$，然后连 $(x,x+1)$，要求是 $1 \\to x$ 已经连通，也就是在 $p_1,p_2,...,p_{i-1}$ 中出现了 $1 \\to x-1$，$a_x=1$ 时满足这个条件会消除后续的所有贡献。\n设 $ans_i$ 表示 $1 \\to i$ 所有排列的答案，$f_i$ 表示若 $a_{i+1}=0$ 额外的贡献，考虑用**从小到大依次插入序列中**的方法。\n转移时考虑枚举 $i$ 的位置，显然放前 $i-1$ 个空隙中不影响答案，$a_i=0$ 时放在最后有额外的贡献，否则将贡献清空。这样状态转移方程就写出来了：\n$$\n\\begin{cases}\nf_i=f_{i-1}\\cdot i,\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ ans_i=ans_{i-1}\\cdot i+f_{i-1}&a_i=0\\\\\nf_i=f_{i-1}\\cdot(i-1),\\ \\ ans_i=ans_{i-1}\\cdot i&a_i=1\n\\end{cases}\n$$\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=5e5+5,mod=998244353;\nint n,a[N],f[N],ans[N];\nnamespace rw{\n    inline int read(){\n        int tot=0,t=1;char ch=getchar();\n        while(ch<'0'||ch>'9'){if(ch=='-') t=-1;ch=getchar();}\n        while(ch>='0'&&ch<='9'){tot=tot*10+ch-'0';ch=getchar();}\n        return tot*t;\n    }\n    inline void write(int x){\n        if(x<0) putchar('-'),x=-x;\n        static int sta[35];int top=0;\n        do{sta[top++]=x%10,x/=10;}while(x);\n        while(top) putchar(sta[--top]+'0');\n    }\n    inline void file(){\n        freopen(\".in\",\"r\",stdin);\n        freopen(\".out\",\"w\",stdout);\n    }\n    inline void print(const int x,const char ch){return (write(x),putchar(ch)),void(0);}\n}using namespace rw;\ninline void solve(){\n    n=read();\n    for(int i=1;i<n;i++) a[i]=read();\n    f[0]=1;\n    for(int i=1;i<n;i++){\n        if(a[i]==0) f[i]=f[i-1]*i%mod;\n        else f[i]=f[i-1]*(i-1)%mod;\n    }\n    ans[0]=0;\n    for(int i=1;i<n;i++){\n        ans[i]=(ans[i-1]*i%mod+(a[i]==0)*f[i-1])%mod;\n        print(ans[i],' ');\n    }\n    puts(\"\");\n}\nsigned main(){\n    int T=read();\n    while(T--) solve();\n    return 0;\n}\n```\n\n## 括号序列问题\n解决这类问题，考虑几个对括号序列经典的刻画。\n- 将左括号看成 $1$，右括号看成 $-1$，一个括号序列合法当且仅当前缀和 $\\le 0$ 且总和为 $0$。\n- 将上述过程画在折线统计图。\n- 递归定义，空串是合法序列，若 $S1,S2$ 是合法序列，则 $(S1),(S2),S1S2$ 均为合法序列。\n\n## Slope Trick\n这是管理连续凸函数 $f:R \\to R$ 的技巧，注意和斜率优化区分开来。\n下面从分段函数入手。\n一个连续的分段函数的每一段斜率范围应为：$[l,l+1,l+2,...r-1,r]$。\n此处要求斜率均为整数。可存在斜率为 $0$ 的线段。","src/content/posts/DP_impove.md","854f480da0d9b92e",{html:415,metadata:416},"<hr>\n<section><h1 id=\"树形dp\">树形DP<a class=\"anchor\" href=\"#树形dp\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>树形 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span>，即在树上进行的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span>。\n由于遍历树固有的递归性质，树形 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 一般都是递归进行的。我们将从一些经典模型和例子开始。</p><section><h2 id=\"求所有点的子树大小\">求所有点的子树大小<a class=\"anchor\" href=\"#求所有点的子树大小\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><div class=\"expressive-code\"><link rel=\"stylesheet\" href=\"/_astro/ec.d1dr8.css\"><script type=\"module\" src=\"/_astro/ec.qopfj.js\"></script><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:41ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">f</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[u]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u];i;i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].next){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> v</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].to;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(f</span><span style=\"--0:#F97583;--1:#F97583\">!=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">v) </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(v,u);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[u]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[v];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h2 id=\"树上最大独立集\">树上最大独立集<a class=\"anchor\" href=\"#树上最大独立集\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>给出⼀个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个点的树，每个点有权值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">w_{i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，要求选出⼀个点集权值和最大。使得没有⼀条边两端的点同时被选。\n要求时间复杂度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>。</p><p>常见的树形 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 都会记录 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>u</mi><mo separator=\"true\">,</mo><mn>0</mn><mi mathvariant=\"normal\">/</mi><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">f_{u,0/1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0496em;vertical-align:-0.3552em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.5198em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\">0/1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3552em;\"><span></span></span></span></span></span></span></span></span></span> 答案（视情况分析）。\n在这个题里，可以这样设计状态 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>u</mi><mo separator=\"true\">,</mo><mn>0</mn><mi mathvariant=\"normal\">/</mi><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">f_{u,0/1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0496em;vertical-align:-0.3552em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.5198em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\">0/1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3552em;\"><span></span></span></span></span></span></span></span></span></span> 分别表⽰<strong>不选</strong>和<strong>选了</strong>的情况下的答案。\n因为树天生具有⼀种无后效性，想要合并儿子的信息只需要儿子那⼀个点的信息。\n也就是子树内做完 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 之后，只需要保留根的信息就好了，同时采用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>dfs</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{dfs}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">dfs</span></span></span></span></span> 的方法来 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span>。</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:56ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">f</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">w[u];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u];i;i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].next){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> v</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].to;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(f</span><span style=\"--0:#F97583;--1:#F97583\">!=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">v) </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(v,u);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#B392F0;--1:#B392F0\">max</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(f[v][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">],f[v][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]);</span><span style=\"--0:#99A0A6;--1:#99A0A6\"> // 若u不选，则⼉⼦可选可不选，取⼤者。</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[v][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#99A0A6;--1:#99A0A6\">// 若u选上，则⼉⼦只能不选。</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h2 id=\"树上背包\">树上背包<a class=\"anchor\" href=\"#树上背包\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>树上的背包问题，简单来说就是背包问题与树形 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 的结合。\n在此之前需要了解基本的<strong>背包模型</strong>和<strong>背包的合并</strong>。</p><blockquote>\n<p>Attention:\n树上背包问题代码时间复杂度是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^{2})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 的。</p>\n</blockquote><section><h3 id=\"例题p2014-ctsc1997-选课\">例题：<a href=\"https://www.luogu.com.cn/problem/P2014\">P2014 [CTSC1997] 选课</a><a class=\"anchor\" href=\"#例题p2014-ctsc1997-选课\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>给出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个点的森林，每个点有权值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_{i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，要求选了⼀个点必然要选其父亲。求出选择 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 个点能得到的最⼤权值和。\n数据范围：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mi>m</mi><mo>≤</mo><mn>300</mn></mrow><annotation encoding=\"application/x-tex\">1 \\le n,m \\le 300</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">300</span></span></span></span>。</p><p>可以加 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 个点编号为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>，将森林变为一棵树。\n考虑背包问题解法为设当前取了多少个元素。可以借鉴此方法，设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">f_{u,i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 为以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 为根的子树选了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 个节点的最大权值和。一个点如果选了，则它的父亲节点必定选了，那么每个节点的初始值为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>。接着考虑每个背包的合并。</p><p>可得状态转移方程为：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>i</mi><mo>+</mo><mi>j</mi></mrow></msub><mo>=</mo><munder><mrow><mi>max</mi><mo>⁡</mo></mrow><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>min</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>s</mi><mi>i</mi><msub><mi>z</mi><mi>u</mi></msub><mo separator=\"true\">,</mo><mi>m</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><mi>j</mi><mo>≤</mo><mi>s</mi><mi>i</mi><msub><mi>z</mi><mi>v</mi></msub><mo separator=\"true\">,</mo><mi>i</mi><mo>+</mo><mi>j</mi><mo>≤</mo><mi>m</mi><mo>+</mo><mn>1</mn></mrow></munder><mo stretchy=\"false\">(</mo><msub><mi>f</mi><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>i</mi><mo>+</mo><mi>j</mi></mrow></msub><mo separator=\"true\">,</mo><msub><mi>f</mi><mrow><mi>u</mi><mo separator=\"true\">,</mo><mi>i</mi></mrow></msub><mo>+</mo><msub><mi>f</mi><mrow><mi>v</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">f_{u,i+j} = \\max \\limits_{1 \\le i \\le \\min(siz_{u},m+1),1 \\le j \\le siz_{v},i + j \\le m+1} (f_{u,i+j},f_{u,i}+f_{v,j})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.716em;vertical-align:-0.966em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4306em;\"><span style=\"top:-2.309em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">≤</span><span class=\"mop mtight\"><span class=\"mtight\">m</span><span class=\"mtight\">i</span><span class=\"mtight\">n</span></span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.04398em;\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:-0.044em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">m</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.04398em;\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:-0.044em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">m</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\">max</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.966em;\"><span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>。</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:88ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#include</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">&#x3C;bits/stdc++.h></span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">std</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> N</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">3</span><span style=\"--0:#F97583;--1:#F97583\">e</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">struct</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">node</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> to,next;}edge[N</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> n,m,w[N],head[N],cnt,f[N][N],g[N],siz[N];</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">add</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">v</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cnt].next</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[cnt].to</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">v;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cnt;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,t</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) t</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),x</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">static</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> sta[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">35</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> top</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{sta[top</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sta[</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">23</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">24</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">file</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">25</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".in\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"r\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdin);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">26</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".out\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"w\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdout);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">27</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">28</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">ch</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x),</span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch)),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">29</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">30</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">bag</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">v</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">31</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[u];i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">32</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> j</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;j</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[v];j</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">33</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">            </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">g[i</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">max</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(g[i</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j],f[u][i]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[v][j]);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">34</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">35</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">36</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[u]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[v];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">37</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[u];i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) f[u][i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">g[i],g[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">38</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">39</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">40</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">w[u],siz[u]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">41</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u];i;i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].next){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">42</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> v</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].to;</span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(v);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">43</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">bag</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(u,v);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">44</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">45</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">46</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">signed</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">main</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">47</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),m</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();m</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">48</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">49</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> k</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();w[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">50</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">add</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(k,i);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">51</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">52</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">53</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(f[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][m],</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#79B8FF;--1:#79B8FF\">\\n</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">54</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">55</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h3 id=\"p11363-noip2024-树的遍历\"><a href=\"https://www.luogu.com.cn/problem/P11363\">P11363 [NOIP2024] 树的遍历</a><a class=\"anchor\" href=\"#p11363-noip2024-树的遍历\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>题意详见原题。</p><p>首先考虑 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">k=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 的答案。已经知道开始边，对于每一条边是从一条边转移过来，在以任意顺序遍历它的子树，则答案就是：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∏</mo><mrow><mo stretchy=\"false\">(</mo><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">!</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\prod{(deg_i-1)!}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∏</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)!</span></span></span></span></span>。\n接着考虑 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">k=2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 的答案。将两边连成一条链显然答案为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>−</mo><mn>2</mn><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">!</mo></mrow><annotation encoding=\"application/x-tex\">(deg_i-2)!</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">)!</span></span></span></span>。\n<img src=\"https://cdn.luogu.com.cn/upload/image_hosting/hxos5ogw.png\" alt=\"\">\n上图中，红边为可能为起始边的边，蓝边为其中一种遍历方法。</p><p>然后，思考若起始边一定是一条从叶子节点出发去往叶子节点的一条链。证明：考虑一个点的周围全是黑边，这些边内部的蓝边一定为一条链，对于一条链来说，起始边必然为链的一端。当一条链确定是答案为：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∏</mo><mrow><mo stretchy=\"false\">(</mo><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>i</mi></msub><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">!</mo></mrow><mo>×</mo><mo>∏</mo><mrow><mo stretchy=\"false\">(</mo><mi>d</mi><mi>e</mi><msub><mi>g</mi><mi>u</mi></msub><mo>−</mo><mn>1</mn><msup><mo stretchy=\"false\">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow></mrow><annotation encoding=\"application/x-tex\">\\prod{(deg_i-1)!} \\times \\prod{(deg_u-1)^{-1}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∏</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)!</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∏</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 为所有点，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 为链上的节点。</p><p>现在问题转化为：<strong>有一棵边权为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mi mathvariant=\"normal\">/</mi><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">0/1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">0/1</span></span></span></span> 的树，点有点权，求所有叶子到叶子的链，满足链上有一条 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 的边，点的权值乘积的和</strong>。</p><p>对于这个问题可以取一个非叶子节点做根，记录每个子树内有无 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 总和为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><msub><mi>p</mi><mrow><mi>u</mi><mo separator=\"true\">,</mo><mn>0</mn><mi mathvariant=\"normal\">/</mi><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">dp_{u,0/1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0496em;vertical-align:-0.3552em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\">0/1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3552em;\"><span></span></span></span></span></span></span></span></span></span>，计算贡献即可。</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:88ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#include</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">&#x3C;bits/stdc++.h></span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#define</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">std</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> N</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">e</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,mod</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">e</span><span style=\"--0:#79B8FF;--1:#79B8FF\">9</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">7</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">struct</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">node</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> to,next,flag;}edge[N</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> n,k,head[N],cnt,chose[N],du[N],u[N],v[N],ans,f[N][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">],inv[N];</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">add</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">v</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">flag</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cnt].next</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[cnt].to</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">v;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[cnt].flag</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">flag;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cnt;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,t</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) t</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),x</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">static</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> sta[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">35</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> top</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">23</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{sta[top</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">24</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sta[</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">25</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">26</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">file</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">27</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".in\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"r\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdin);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">28</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".out\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"w\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdout);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">29</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">30</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">ch</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x),</span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch)),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">31</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">32</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">fa</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">33</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> val</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">34</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u];i;i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].next){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">35</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> v</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].to,flag</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].flag;</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(fa</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">v) </span><span style=\"--0:#F97583;--1:#F97583\">continue</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(v,u);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">36</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(flag) f[v][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[v][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">],f[v][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">37</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">val</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(val</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[v][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">])</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[v][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">])</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">38</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[v][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">])</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod,f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[v][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">])</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">39</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">40</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> INV</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">inv[du[u]];ans</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ans</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">val</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">INV)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">!</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">du[u]) f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">41</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">INV)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">42</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(f[u][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">INV)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">43</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">44</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">init</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) head[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,du[i]</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,chose[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;cnt</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,ans</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">45</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">solve</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">46</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),k</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span><span style=\"--0:#B392F0;--1:#B392F0\">init</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">47</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){u[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),v[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();du[u[i]]</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,du[v[i]]</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">48</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">k;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> x</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();chose[x]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">49</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(n</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#79B8FF;--1:#79B8FF\">\\n</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">50</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">add</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(u[i],v[i],chose[i]),</span><span style=\"--0:#B392F0;--1:#B392F0\">add</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(v[i],u[i],chose[i]);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">51</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> rt</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(du[i]) rt</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i;</span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(rt,</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">52</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> j</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;j</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">du[i];j</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) ans</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ans</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">53</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ans,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#79B8FF;--1:#79B8FF\">\\n</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">54</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">55</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">signed</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">main</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">56</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">inv[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">inv[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">57</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">N;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) inv[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">inv[mod</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i]</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(mod</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod</span><span style=\"--0:#F97583;--1:#F97583\">/</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">58</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> c</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),T</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">59</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(T</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">solve</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">60</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">61</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section></section><section><h2 id=\"换根-dptextdpdp\">换根 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span><a class=\"anchor\" href=\"#换根-dptextdpdp\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>树形换根 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 问题又称为<em>二次扫描</em>，通常不会指定树的根，且随着根的变换某些值也会发生改变，如子节点深度和、点权值和。\n通常进行两次 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span>，第一次 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 求出子树内的值，第二次 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 进行换根操作。</p><section><h3 id=\"例题p3478-poi-2008-sta-station\">例题：<a href=\"https://www.luogu.com.cn/problem/P3478\">P3478 [POI 2008] STA-Station</a><a class=\"anchor\" href=\"#例题p3478-poi-2008-sta-station\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>给定一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个点的树，请求出一个结点，使得以这个结点为根时，所有结点的深度之和最大。\n一个结点的深度之定义为该节点到根的简单路径上边的数量。\n对于全部的测试点，保证 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>n</mi><mo>≤</mo><msup><mn>10</mn><mn>6</mn></msup><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><mi>u</mi><mo separator=\"true\">,</mo><mi>v</mi><mo>≤</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">1 \\le n \\le 10^{6},1 \\le u,v \\le n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0085em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">6</span></span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>，给出的是一棵树。</p><p>很明显换根 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span>。对于第一次 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 求出以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 为根的 每个子树的深度和&#x26;每个子树的大小，将每个子树的深度加入 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">f_{1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。对于第二次 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DFS</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DFS}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DFS</span></span></span></span></span> 考虑换根，将根为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 转换为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span>，则根为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 的子树的深度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>，其他 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">1</span></span></span></span>，转移方程为：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>v</mi></msub><mo>=</mo><msub><mi>f</mi><mi>u</mi></msub><mo>+</mo><mi>n</mi><mo>−</mo><mn>2</mn><mo>×</mo><mi>s</mi><mi>i</mi><msub><mi>z</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_{v}=f_{u}+n-2 \\times siz_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8095em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.044em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。最后将所有的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_{i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 最大值输出即可。</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:88ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#include</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">&#x3C;bits/stdc++.h></span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#define</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">std</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> N</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">e</span><span style=\"--0:#79B8FF;--1:#79B8FF\">6</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">struct</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">node</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> to,next;}edge[N</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> n,head[N],cnt,siz[N],dep[N],f[N],ans,maxn;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">add</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">v</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cnt].next</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[cnt].to</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">v;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cnt;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,t</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) t</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),x</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">static</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> sta[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">35</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> top</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{sta[top</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">23</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sta[</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">24</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">25</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">file</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">26</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".in\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"r\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdin);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">27</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".out\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"w\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdout);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">28</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">29</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">ch</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x),</span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch)),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">30</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">31</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs_init</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">fa</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">32</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[u]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,dep[u]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dep[fa]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">33</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u];i;i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].next){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">34</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> v</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].to;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">35</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(fa</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">v) </span><span style=\"--0:#F97583;--1:#F97583\">continue</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">36</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs_init</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(v,u);siz[u]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[v];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">37</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">38</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">39</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs_do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">u</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">fa</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">40</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">head[u];i;i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].next){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">41</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> v</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">edge[i].to;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">42</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(fa</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">v) </span><span style=\"--0:#F97583;--1:#F97583\">continue</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">43</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[v]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[u]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">siz[v];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">44</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs_do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(v,u);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">45</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">46</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">47</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">signed</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">main</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">48</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">49</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">50</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> u</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),v</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">51</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">add</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(u,v),</span><span style=\"--0:#B392F0;--1:#B392F0\">add</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(v,u);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">52</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">53</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs_init</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) f[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">dep[i];</span><span style=\"--0:#B392F0;--1:#B392F0\">dfs_do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">54</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(maxn</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i]) maxn</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i],ans</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">55</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ans,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#79B8FF;--1:#79B8FF\">\\n</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">56</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">57</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><hr></section></section></section>\n<section><h1 id=\"状压-dptextdpdp\">状压 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span><a class=\"anchor\" href=\"#状压-dptextdpdp\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>状压 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 是动态规划的一种，通过将状态压缩为整数来达到优化转移的目的。是利用计算机二进制的性质来描述状态的一种 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 方式。</p><p>状压 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 其实就是将状态压缩成 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 进制来保存 其特征就是看起来有点像搜索，每个格子的状态只有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 或 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>，是另一类非常典型的动态规划。</p><p>为了更好的理解状压 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span>，首先介绍<strong>位运算</strong>相关的知识。</p><ul>\n<li><code>&#x26;</code>符号，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mi mathvariant=\"normal\">&#x26;</mi><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x \\&#x26; y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mord\">&#x26;</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>，会将两个十进制数在二进制下进行与运算（都 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>，其余为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>） 然后返回其十进制下的值。例如<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo stretchy=\"false\">(</mo><mn>11</mn><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">&#x26;</mi><mn>2</mn><mo stretchy=\"false\">(</mo><mn>10</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mn>2</mn><mo stretchy=\"false\">(</mo><mn>10</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">3(11)\\&#x26;2(10)=2(10)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3</span><span class=\"mopen\">(</span><span class=\"mord\">11</span><span class=\"mclose\">)</span><span class=\"mord\">&#x26;2</span><span class=\"mopen\">(</span><span class=\"mord\">10</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mopen\">(</span><span class=\"mord\">10</span><span class=\"mclose\">)</span></span></span></span>。</li>\n<li><code>|</code>符号，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mi mathvariant=\"normal\">∣</mi><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x | y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>，会将两个十进制数在二进制下进行或运算（都0为0，其余为1） 然后返回其十进制下的值。例如 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo stretchy=\"false\">(</mo><mn>11</mn><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">∣</mi><mn>2</mn><mo stretchy=\"false\">(</mo><mn>10</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mn>3</mn><mo stretchy=\"false\">(</mo><mn>11</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">3(11) | 2(10)=3(11)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3</span><span class=\"mopen\">(</span><span class=\"mord\">11</span><span class=\"mclose\">)</span><span class=\"mord\">∣2</span><span class=\"mopen\">(</span><span class=\"mord\">10</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3</span><span class=\"mopen\">(</span><span class=\"mord\">11</span><span class=\"mclose\">)</span></span></span></span>。</li>\n<li><code>^</code>符号，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mtext> </mtext><mover accent=\"true\"><mrow></mrow><mo>ˆ</mo></mover><mtext> </mtext><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x \\  \\^{} \\ y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\"> </span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6944em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">ˆ</span></span></span></span></span></span></span><span class=\"mspace\"> </span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>，会将两个十进制数在二进制下进行异或运算（不同为1，其余 为0）然后返回其十进制下的值。例如 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo stretchy=\"false\">(</mo><mn>11</mn><mo stretchy=\"false\">)</mo><mtext> </mtext><mover accent=\"true\"><mrow></mrow><mo>ˆ</mo></mover><mtext> </mtext><mn>2</mn><mo stretchy=\"false\">(</mo><mn>10</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mn>1</mn><mo stretchy=\"false\">(</mo><mn>01</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">3(11)\\ \\^{} \\ 2(10)=1(01)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3</span><span class=\"mopen\">(</span><span class=\"mord\">11</span><span class=\"mclose\">)</span><span class=\"mspace\"> </span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6944em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">ˆ</span></span></span></span></span></span></span><span class=\"mspace\"> </span><span class=\"mord\">2</span><span class=\"mopen\">(</span><span class=\"mord\">10</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mopen\">(</span><span class=\"mord\">01</span><span class=\"mclose\">)</span></span></span></span>。</li>\n<li><code>~</code>符号，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mrow></mrow><mo>˜</mo></mover><mtext> </mtext><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\~{} \\ x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6679em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6679em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">˜</span></span></span></span></span></span></span><span class=\"mspace\"> </span><span class=\"mord mathnormal\">x</span></span></span></span>，按位取反。例如 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mrow></mrow><mo>˜</mo></mover><mtext> </mtext><mn>101</mn><mo>=</mo><mn>010</mn></mrow><annotation encoding=\"application/x-tex\">\\~{} \\ 101=010</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6679em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6679em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.25em;\"><span class=\"mord\">˜</span></span></span></span></span></span></span><span class=\"mspace\"> </span><span class=\"mord\">101</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">010</span></span></span></span>。</li>\n<li><code>&#x3C;&#x3C;</code>符号，左移操作，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>&#x3C;</mo><mo>&#x3C;</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">x&#x3C;&#x3C;2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&#x3C;&#x3C;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span>，将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 在二进制下的每一位向左移动两位，最右边用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> 填充，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>&#x3C;</mo><mo>&#x3C;</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">x&#x3C;&#x3C;2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&#x3C;&#x3C;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 相当于让 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>×</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">\\times 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">×</span><span class=\"mord\">4</span></span></span></span>。</li>\n<li><code>>></code>符号，是右移操作，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>></mo><mo>></mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">x>>1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">>></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 相当于给 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mi mathvariant=\"normal\">/</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">x/2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mord\">/2</span></span></span></span>，去掉 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 二进制下的最右一位</li>\n</ul><ol>\n<li>判断一个数字 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 二进制下第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 位是不是等于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>。（最低第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 位）\n方法：<code>if(((1&#x3C;&#x3C;(i−1))&#x26;x)>0)</code> 将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 左移 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">i-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7429em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 位，相当于制造了一个只有第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 位上是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>，其他位上都是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> 的二进制数。然后与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 做与运算，如果结果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>></mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">>0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>， 说明 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 位上是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>，反之则是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>。</li>\n<li>将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 的第i位更改成 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>。\n方法：<code>x|=(1&#x3C;&#x3C;(i−1))</code>证明方法与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 类似。</li>\n<li>将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 的第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 位更改成<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>。\n方法：<code>x&#x26;=(~(1&#x3C;&#x3C;(i−1)))</code></li>\n<li>将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 最靠右的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 去掉。\n方法：<code>x=x&#x26;(x−1)</code></li>\n<li>取出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 的第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 位。\n方法：<code>(x>>(i-1))&#x26;1</code></li>\n<li>将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 的第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 位取反。\n方法：<code>x^=((1&#x3C;&#x3C;(i-1))</code></li>\n<li>取出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 最靠右的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>。\n方法：<code>x&#x26;(-x)</code></li>\n<li>判断是否有两个连续的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>。\n方法：<code>if(x&#x26;(x&#x3C;&#x3C;1))</code></li>\n<li>枚举子集。\n方法：<code>for(int x=sta;x;x=((x-1)&#x26;sta) cout&#x3C;&#x3C;x;</code></li>\n</ol><section><h3 id=\"例题1p1896-scoi2005-互不侵犯\">例题1：<a href=\"https://www.luogu.com.cn/problem/P1896\">P1896 [SCOI2005] 互不侵犯</a><a class=\"anchor\" href=\"#例题1p1896-scoi2005-互不侵犯\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi><mo>×</mo><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N \\times N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> 的棋盘里面放 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> 个国王，使他们互不攻击，共有多少种摆放方案。国王能攻击到它上下左右，以及左上左下右上右下八个方向上附近的各一个格子，共 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>8</mn></mrow><annotation encoding=\"application/x-tex\">8</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">8</span></span></span></span> 个格子。\n对于全部数据，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>N</mi><mo>≤</mo><mn>9</mn><mtext>，</mtext><mn>0</mn><mo>≤</mo><mi>K</mi><mo>≤</mo><mi>N</mi><mo>×</mo><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">1 \\le N \\le 9，0  \\le K \\le N \\times N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord\">9</span><span class=\"mord cjk_fallback\">，</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span>。</p><p>首先只考虑一行，此时这一行的国王的状态只与上一行和这一行的国王有关。\n<img src=\"https://oi-wiki.org/dp/images/SCOI2005-%E4%BA%92%E4%B8%8D%E4%BE%B5%E7%8A%AF.png\" alt=\"\">\n以上这个例子中国王的状态可以用二进制表示为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mn>101001</mn><mrow><mo stretchy=\"false\">(</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow></msub></mrow><annotation encoding=\"application/x-tex\">101001_{(2)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9996em;vertical-align:-0.3552em;\"></span><span class=\"mord\">10100</span><span class=\"mord\"><span class=\"mord\">1</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mtight\">2</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3552em;\"><span></span></span></span></span></span></span></span></span></span>。\n于是我们有了三个状态：第几行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span>、此行的状态 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span></span>、已经使用的国王数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span>。\n考虑状态转移。先预处理出每个状态 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>i</mi><msub><mi>t</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">sit_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8095em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，其中包含了二进制的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 的个数，及这行放的国王个数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mi>n</mi><msub><mi>t</mi><mi>x</mi></msub></mrow><annotation encoding=\"application/x-tex\">cnt_x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7651em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">n</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，于是就有状态转移方程：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo separator=\"true\">,</mo><mi>s</mi></mrow></msub><mo>=</mo><munder><mo>∑</mo><mrow><mn>2</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>n</mi><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><mi>j</mi><mo>≤</mo><mi>t</mi><mi>o</mi><mi>t</mi><mo separator=\"true\">,</mo><mn>1</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mi>t</mi><mi>o</mi><mi>t</mi></mrow></munder><msub><mi>f</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>k</mi><mo separator=\"true\">,</mo><mi>s</mi><mo>−</mo><mi>c</mi><mi>n</mi><msub><mi>t</mi><mi>j</mi></msub></mrow></msub></mrow><annotation encoding=\"application/x-tex\">f_{i,j,s} = \\sum \\limits_{2 \\le i \\le n,1 \\le j \\le tot,1 \n\\le k \\le tot} f_{i-1,k,s-cnt_{j}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">s</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.8882em;vertical-align:-1.1382em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.75em;\"><span style=\"top:-2.0979em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mrel mtight\">≤</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">t</span></span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop op-symbol small-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1382em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mbin mtight\">−</span><span class=\"mord mathnormal mtight\">c</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3473em;\"><span></span></span></span></span></span></span></span></span></span>。\n接着考虑国王的合法情况，运用位运算来判断两个状态在同一个或相邻位置是否有国王：</p><ul>\n<li><code>if(sit[j]&#x26;sit[k])</code>(上下有重复的国王)</li>\n<li><code>if((sit[j]&#x3C;&#x3C;1)&#x26;sit[k])</code>(左上右下有重复的国王)</li>\n<li><code>if(sit[j]&#x26;(sit[k]&#x3C;&#x3C;1))</code>(右上左下有重复的国王)</li>\n</ul><p>这样就将不符合题意的状态去掉。</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:89ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#include</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">&#x3C;bits/stdc++.h></span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#define</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">std</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> N</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#F97583;--1:#F97583\">e</span><span style=\"--0:#79B8FF;--1:#79B8FF\">3</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> n,k,f[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][N][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">105</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">},sit[N],cnt[N],tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,ans</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,t</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) t</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),x</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">static</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> sta[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">35</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> top</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{sta[top</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sta[</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">file</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".in\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"r\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdin);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".out\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"w\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdout);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">23</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">ch</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x),</span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch)),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">24</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">25</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">h</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">sum</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">step</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">26</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(step</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">27</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">sit[</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">h;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">28</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cnt[tot]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">sum;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">29</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">30</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">31</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(h,sum,step</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">32</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(h</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">step),sum</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,step</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">33</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">34</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">signed</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">main</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">35</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),k</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span><span style=\"--0:#B392F0;--1:#B392F0\">dfs</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">36</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) f[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][i][cnt[i]]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">37</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">38</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> j</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;j</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot;j</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">39</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> l</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;l</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot;l</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:16ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">40</div></div><div class=\"code\"><span class=\"indent\">                </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">((sit[j]</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">sit[l])</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">((sit[j]</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">sit[l])</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sit[j]</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sit[l]</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">))) </span><span style=\"--0:#F97583;--1:#F97583\">continue</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:16ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">41</div></div><div class=\"code\"><span class=\"indent\">                </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> s</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">k;s</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cnt[j];s</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) f[i][j][s]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][l][s</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cnt[j]];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">42</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">            </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">43</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">44</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">45</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) ans</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[n][i][k];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">46</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ans,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#79B8FF;--1:#79B8FF\">\\n</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">47</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">48</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h3 id=\"例题2p3959-noip-2017-提高组-宝藏\">例题2：<a href=\"https://www.luogu.com.cn/problem/P3959\">P3959 [NOIP 2017 提高组] 宝藏</a><a class=\"anchor\" href=\"#例题2p3959-noip-2017-提高组-宝藏\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>题面详见原题。</p></section><section><h3 id=\"例题3cf1767e-algebra-flash\">例题3：<a href=\"https://www.luogu.com.cn/problem/CF1767E\">CF1767E</a> <a href=\"https://codeforces.com/problemset/problem/1767/E\">Algebra Flash</a><a class=\"anchor\" href=\"#例题3cf1767e-algebra-flash\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>给出⼀个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>≤</mo><mn>40</mn></mrow><annotation encoding=\"application/x-tex\">n \\le 40</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">40</span></span></span></span> 个点的图，每个点有权值，求其最大权独立集。</p><hr></section></section>\n<section><h1 id=\"数位-dptextdpdp\">数位 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span><a class=\"anchor\" href=\"#数位-dptextdpdp\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>此类问题的特征比较明显，常见的形式是数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[l,r]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">]</span></span></span></span> 内满足某个条件的数字个数，这个数字可能很大。</p><p>考虑人类计数的⽅式，最朴素的计数就是从小到大开始依次加⼀。但我们发现对于位数比较多的数，这样的过程中有许多重复的部分。\n例如，从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>7000</mn></mrow><annotation encoding=\"application/x-tex\">7000</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">7000</span></span></span></span> 数到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>7999</mn></mrow><annotation encoding=\"application/x-tex\">7999</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">7999</span></span></span></span> 从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>8000</mn></mrow><annotation encoding=\"application/x-tex\">8000</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">8000</span></span></span></span> 数到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>8999</mn></mrow><annotation encoding=\"application/x-tex\">8999</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">8999</span></span></span></span>、和从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>9000</mn></mrow><annotation encoding=\"application/x-tex\">9000</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">9000</span></span></span></span> 数到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>9999</mn></mrow><annotation encoding=\"application/x-tex\">9999</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">9999</span></span></span></span> 的过程⾮常相似，它们都是后三位从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>000</mn></mrow><annotation encoding=\"application/x-tex\">000</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">000</span></span></span></span> 变到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>999</mn></mrow><annotation encoding=\"application/x-tex\">999</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">999</span></span></span></span>，不⼀样的地⽅只有千位这⼀位，所以我们可以把这些过程合并起来，⽤ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 的⽅式进⾏状态转移。</p><p>我们可以用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">f ( n )</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 表示 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mi>n</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[ 0 , n ]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">]</span></span></span></span> 的所有满足条件的个数，那么对于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[ l , r ]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">]</span></span></span></span> 我们就可以用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>r</mi><mo stretchy=\"false\">]</mo><mtext>  </mtext><mo>⟺</mo><mtext>  </mtext><mi>f</mi><mo stretchy=\"false\">(</mo><mi>r</mi><mo stretchy=\"false\">)</mo><mo>−</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">[ l , r ] \\iff f ( r ) − f ( l − 1 )</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">⟺</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>，前缀和思想。那么也就是说我们只要求出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">f ( n )</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 即可。那么数位 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 关键的思想就是从树的角度来考虑。将数拆分成位，从高位到低位开始枚举。我们可以视 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> 为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 位数，那么我们拆分<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi><mo>:</mo><msub><mi>a</mi><mi>n</mi></msub><mtext>、</mtext><msub><mi>a</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><msub><mi>a</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">N:a_{n}、a_{n-1}...a_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8917em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord cjk_fallback\">、</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mord\">...</span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。那么我们就可以开始分解建树，如下。之后我们就可以预处理再求解 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">f ( n )</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 了。\n<img src=\"https://i-blog.csdnimg.cn/blog_migrate/e4e4bdb49dde528bc9e22713b7fde44a.png\" alt=\"\"></p><section><h3 id=\"例题1p2602-zjoi2010-数字计数\">例题1：<a href=\"https://www.luogu.com.cn/problem/P2602\">P2602 [ZJOI2010] 数字计数</a><a class=\"anchor\" href=\"#例题1p2602-zjoi2010-数字计数\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>给定两个正整数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>，求在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[a,b]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">]</span></span></span></span> 中的所有整数中，每个数码各出现了多少次。\n对于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>100</mn><mi mathvariant=\"normal\">%</mi></mrow><annotation encoding=\"application/x-tex\">100 \\%</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8056em;vertical-align:-0.0556em;\"></span><span class=\"mord\">100%</span></span></span></span> 的数据，保证 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>a</mi><mo>≤</mo><mi>b</mi><mo>≤</mo><msup><mn>10</mn><mn>12</mn></msup></mrow><annotation encoding=\"application/x-tex\">1 \\le a \\le b \\le 10^{12}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">12</span></span></span></span></span></span></span></span></span></span></span></span>。</p><p>首先差分⼀下，变成求解 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>r</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[1,r]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">]</span></span></span></span> 的答案。\n发现唯⼀的⼀个问题是前导零和当前是否顶着 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span> 的上界，记录这两者即可。常见的实现方法是记忆化搜索。</p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:88ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#include</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">&#x3C;bits/stdc++.h></span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#define</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">std</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> f[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">20</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">20</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">],num[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">20</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">],a,b;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,t</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) t</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),x</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">static</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> sta[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">35</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> top</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{sta[top</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sta[</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">file</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".in\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"r\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdin);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".out\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"w\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdout);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">ch</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x),</span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch)),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">23</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">24</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">dp</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">pos</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">flag</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">sum</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">d</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">qdl</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">25</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> res</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,up</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">9</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//flag为1表示有限制，lead为0表示有前导0</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">26</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(pos</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> sum;</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//边界条件</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">27</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">!</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">flag</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">qdl</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[pos][sum]</span><span style=\"--0:#F97583;--1:#F97583\">!=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> f[pos][sum];</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//记忆化</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">28</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(flag) up</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num[pos];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">29</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">up;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">30</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">res</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#B392F0;--1:#B392F0\">dp</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(pos</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,(i</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">up</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">flag),sum</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">((i</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">qdl)</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">d)),d,qdl</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">31</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">32</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">!</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">flag</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">qdl) f[pos][sum]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">res;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">33</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> res;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">34</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">35</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">solve</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">d</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">36</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">memset</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(f,</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">sizeof</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(f));</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">37</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> len</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">38</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">39</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">num[</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">len]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#99A0A6;--1:#99A0A6\">//最高位在第一位</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">40</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">41</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">42</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">dp</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(len,</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,d,</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">43</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">44</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">signed</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">main</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">45</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">a</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),b</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">46</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">9</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#B392F0;--1:#B392F0\">solve</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(b,i)</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#B392F0;--1:#B392F0\">solve</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(a</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,i),</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">' '</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">47</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">48</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><hr></section></section>\n<section><h1 id=\"概率-dptextdpdp-和期望-dptextdpdp\">概率 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 和期望 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span><a class=\"anchor\" href=\"#概率-dptextdpdp-和期望-dptextdpdp\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><p>前置知识：概率和期望，高斯消元法。\n由于概率和期望联系紧密，且常常以期望 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 的形式出现，所以下面会多讲⼀点期望相关。虽然随机变量的期望在大纲中是超纲的，但是平时运用还是非常广泛的。</p><section><h2 id=\"概率-dptextdpdp\">概率 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span><a class=\"anchor\" href=\"#概率-dptextdpdp\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>这类题目采用顺推，也就是从初始状态推向结果。\n和⼀般的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 类似，难点依然是对状态转移方程的刻画，只是这类题目经过了概率论知识的包装。</p><section><h3 id=\"例题cf148d-bag-of-mice\">例题：<a href=\"https://codeforces.com/problemset/problem/148/D\">CF148D</a> <a href=\"https://www.luogu.com.cn/problem/CF148D\">Bag of mice</a><a class=\"anchor\" href=\"#例题cf148d-bag-of-mice\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>袋子里有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>w</mi></mrow><annotation encoding=\"application/x-tex\">w</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span></span></span></span> 只白鼠和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> 只黑鼠 ，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span> 轮流从袋子里抓，谁先抓到白色谁就赢。<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> 每次随机抓一只，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span> 每次随机抓完一只之后会有另一只随机老鼠跑出来。如果两个人都没有抓到白色则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span> 赢。<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> 先抓，问 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> 赢的概率。\n范围：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>w</mi><mo separator=\"true\">,</mo><mi>b</mi><mo>≤</mo><mn>1000</mn></mrow><annotation encoding=\"application/x-tex\">0 \\le w ,b \\le 1000</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1000</span></span></span></span>。</p><p>设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">f_{i,j}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 表示当前有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 只白鼠，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span></span> 只黑鼠时 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> 的获胜概率。\n考虑一论中的情况：</p><ul>\n<li>先手摸到白鼠，直接获胜。</li>\n<li>先手摸到黑鼠，后手摸到白鼠，直接失败。</li>\n<li>先手摸到黑鼠，后手摸到黑鼠，跑出白鼠。通过 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>j</mi><mo>−</mo><mn>2</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">f_{i-1,j-2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 转移。</li>\n<li>先手摸到黑鼠，后手摸到黑鼠，跑出黑鼠。通过 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo>−</mo><mn>3</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">f_{i,j-3}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">3</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 转移。</li>\n</ul><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:88ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#include</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">&#x3C;bits/stdc++.h></span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#define</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">std</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> N</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1005</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> w,b;</span><span style=\"--0:#F97583;--1:#F97583\">double</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> f[N][N];</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,t</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) t</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),x</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">static</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> sta[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">35</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> top</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{sta[top</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sta[</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">file</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".in\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"r\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdin);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".out\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"w\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdout);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">23</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">ch</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x),</span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch)),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">24</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">25</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">signed</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">main</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">26</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">w</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(),b</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">27</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">w;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) f[i][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1.0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,f[i][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1.0</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i</span><span style=\"--0:#F97583;--1:#F97583\">/</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">28</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">!</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">b</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">b</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> cout</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">fixed</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#B392F0;--1:#B392F0\">setprecision</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">9</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[w][b]</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#79B8FF;--1:#79B8FF\">\\n</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">29</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">w;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">30</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> j</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;j</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">b;j</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">31</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">            </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i][j]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1.0</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i</span><span style=\"--0:#F97583;--1:#F97583\">/</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">32</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">            </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i][j]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1.0</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j</span><span style=\"--0:#F97583;--1:#F97583\">/</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j)</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(j</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">/</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i</span><span style=\"--0:#F97583;--1:#F97583\">/</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][j</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">33</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(j</span><span style=\"--0:#F97583;--1:#F97583\">^</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) f[i][j]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1.0</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j</span><span style=\"--0:#F97583;--1:#F97583\">/</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j)</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(j</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">/</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(j</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">/</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i][j</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">3</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">34</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">35</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">36</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cout</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">fixed</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#B392F0;--1:#B392F0\">setprecision</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">9</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[w][b]</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#79B8FF;--1:#79B8FF\">\\n</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">37</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">38</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section></section><section><h2 id=\"期望-dptextdpdp\">期望 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span><a class=\"anchor\" href=\"#期望-dptextdpdp\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>下面的题目都带有“期望”。\n常见的离散期望可以表示为某个事件的权值乘发生的概率之和。\n⼀些期望题就是符合条件的方案数除以总方案数。\n另⼀些考察期望线性性的题就比较难了，需要合理的拆分期望。</p><section><h3 id=\"例题1at_dp_j-sushi\">例题1：<a href=\"https://atcoder.jp/contests/dp/tasks/dp_j\">AT_dp_j</a> <a href=\"https://www.luogu.com.cn/problem/AT_dp_j\">Sushi</a><a class=\"anchor\" href=\"#例题1at_dp_j-sushi\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>现有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>N</mi><mo>≤</mo><mn>300</mn></mrow><annotation encoding=\"application/x-tex\">1 \\le N \\le 300</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">300</span></span></span></span>)个盘子，编号为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">1,2,3,…,N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span>。第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 个盘子中放有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo>≤</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1 \\le a_i \\le 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.786em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span>)个寿司。接下来每次执行以下操作，直至吃完所有的寿司。从第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>3</mn><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">1,2,3,…,N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> 个盘子中任选一个盘子，吃掉其中的一个寿司。若没有寿司则不吃。若将所有寿司吃完，请问此时操作次数的数学期望是多少？\n范围：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>N</mi><mo>≤</mo><mn>300</mn></mrow><annotation encoding=\"application/x-tex\">1 \\le N \\le 300</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">300</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><msub><mi>a</mi><mi>i</mi></msub><mo>≤</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1 \\le a_i \\le 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.786em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span>。</p><p>设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">f_{i,j,k}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 表示有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 个盘子有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 个寿司，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span></span> 个盘子有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span> 个寿司，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 个盘子有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span> 个寿司时吃完所有寿司的期望值。显然 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> 个的有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>−</mo><mi>i</mi><mo>−</mo><mi>j</mi><mo>−</mo><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">n-i-j-k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7429em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 个。\n考虑转移。枚举到那个数，则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">f_{i,j,k}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 为以下四项之和：</p><ul>\n<li>枚举到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mrow><mi>n</mi><mo>−</mo><mi>i</mi><mo>−</mo><mi>j</mi><mo>−</mo><mi>k</mi></mrow><mi>n</mi></mfrac></mstyle><mo stretchy=\"false\">(</mo><msub><mi>f</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\dfrac{n-i-j-k}n(f_{i,j,k}+1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.0574em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>。</li>\n<li>枚举到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mi>i</mi><mi>n</mi></mfrac></mstyle><mo stretchy=\"false\">(</mo><msub><mi>f</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>j</mi><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\dfrac in(f_{i-1,j,k}+1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.0225em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3365em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>。</li>\n<li>枚举到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mi>j</mi><mi>n</mi></mfrac></mstyle><mo stretchy=\"false\">(</mo><msub><mi>f</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\dfrac jn(f_{i+1,j-1,k}+1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.0225em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3365em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>。</li>\n<li>枚举到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mi>k</mi><mi>n</mi></mfrac></mstyle><mo stretchy=\"false\">(</mo><msub><mi>f</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\dfrac kn(f_{i,j+1,k-1}+1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.0574em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>。\n合并即是：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub><mo>=</mo><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mrow><mo stretchy=\"false\">(</mo><mi>n</mi><mo>−</mo><mi>i</mi><mo>−</mo><mi>j</mi><mo>−</mo><mi>k</mi><mo stretchy=\"false\">)</mo><msub><mi>f</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub><mo>+</mo><mi>i</mi><msub><mi>f</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>j</mi><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub><mo>+</mo><mi>j</mi><msub><mi>f</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub><mo>+</mo><mi>k</mi><msub><mi>f</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>n</mi></mrow><mi>n</mi></mfrac></mstyle></mrow><annotation encoding=\"application/x-tex\">f_{i,j,k}=\\dfrac{(n-i-j-k)f_{i,j,k}+if_{i-1,j,k}+jf_{i+1,j-1,k}+kf_{i,j+1,k-1}+n}n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.113em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>。\n将以上式子化简得：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub><mo>=</mo><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mrow><mi>i</mi><msub><mi>f</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>j</mi><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub><mo>+</mo><mi>j</mi><msub><mi>f</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub><mo>+</mo><mi>k</mi><msub><mi>f</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>n</mi></mrow><mrow><mi>i</mi><mo>+</mo><mi>j</mi><mo>+</mo><mi>k</mi></mrow></mfrac></mstyle></mrow><annotation encoding=\"application/x-tex\">f_{i,j,k}=\\dfrac{if_{i-1,j,k}+jf_{i+1,j-1,k}+kf_{i,j+1,k-1}+n}{i+j+k}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.2519em;vertical-align:-0.8804em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">i</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8804em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>。</li>\n</ul><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:88ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#include</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">&#x3C;bits/stdc++.h></span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">std</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> N</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">305</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> n,a[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#F97583;--1:#F97583\">double</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> f[N][N][N];</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,t</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) t</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),x</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">static</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> sta[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">35</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> top</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{sta[top</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sta[</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">file</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".in\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"r\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdin);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".out\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"w\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdout);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">ch</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x),</span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch)),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">23</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">24</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">signed</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">main</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">25</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">26</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">27</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> x</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">28</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">a[x]</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">29</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">30</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> k</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;k</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;k</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">31</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> j</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;j</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;j</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">32</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:16ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">33</div></div><div class=\"code\"><span class=\"indent\">                </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">!</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;!</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;!</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">k) </span><span style=\"--0:#F97583;--1:#F97583\">continue</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:16ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">34</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">                </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i][j][k]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:16ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">35</div></div><div class=\"code\"><span class=\"indent\">                </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i) f[i][j][k]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][j][k];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:16ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">36</div></div><div class=\"code\"><span class=\"indent\">                </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(j) f[i][j][k]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][j</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][k];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:16ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">37</div></div><div class=\"code\"><span class=\"indent\">                </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(k) f[i][j][k]</span><span style=\"--0:#F97583;--1:#F97583\">+=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">k</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i][j</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][k</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span></div></div><div class=\"ec-line\" style=\"--ecIndent:16ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">38</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">                </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i][j][k]</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">j</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">k;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">39</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">            </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">40</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">41</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">42</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">cout</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">fixed</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#B392F0;--1:#B392F0\">setprecision</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[a[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]][a[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]][a[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">3</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]]</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#79B8FF;--1:#79B8FF\">\\n</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">43</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">44</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section></section><section><h2 id=\"待定系数法\">待定系数法<a class=\"anchor\" href=\"#待定系数法\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表⽰从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 开始走到终点的期望步数。\n那么 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 可以用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>×</mo><msub><mi>f</mi><mn>0</mn></msub><mo>+</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">k \\times f_0 +b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> 来表⽰，最后解出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">f_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 即可。</p><hr></section></section>\n<section><h1 id=\"dptextdpdp-方法\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>DP</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{DP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord text\"><span class=\"mord\">DP</span></span></span></span></span> 方法<a class=\"anchor\" href=\"#dptextdpdp-方法\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h1><section><h2 id=\"排列方法\">排列方法<a class=\"anchor\" href=\"#排列方法\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>通常是不给出排列，形如求满足某条件的所有排列的权值之和的问题。</p><section><h3 id=\"逐步生成\">逐步生成<a class=\"anchor\" href=\"#逐步生成\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><ul>\n<li>从左往右依次确定绝对值</li>\n<li>从小到大依次确定绝对位置</li>\n<li>从左往右依次确定相对大小(在前缀中的排名)</li>\n<li>从小到大依次插入序列中</li>\n</ul></section><section><h3 id=\"例题1at_dp_t-permutation\">例题1：<a href=\"https://atcoder.jp/contests/dp/tasks/dp_t\">AT_dp_t</a> <a href=\"https://www.luogu.com.cn/problem/AT_dp_t\">Permutation</a><a class=\"anchor\" href=\"#例题1at_dp_t-permutation\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>有一个长为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> 的正整数排列。给定一个由 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>&#x3C;</mo></mrow><annotation encoding=\"application/x-tex\">&#x3C;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&#x3C;</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>></mo></mrow><annotation encoding=\"application/x-tex\">></annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">></span></span></span></span> 组成长为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">N−1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 的的字符串。 对于任意满足 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>N</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1 \\le i \\le N−1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7955em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 的字符 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">s_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">s_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>&#x3C;</mo></mrow><annotation encoding=\"application/x-tex\">&#x3C;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&#x3C;</span></span></span></span> 则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub><mo>&#x3C;</mo><msub><mi>P</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">P_i&#x3C;P_{i+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&#x3C;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8917em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span></span></span></span> 如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">s_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>></mo></mrow><annotation encoding=\"application/x-tex\">></annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">></span></span></span></span> 则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub><mo>></mo><msub><mi>P</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">P_i>P_{i+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8917em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span></span></span></span>。求满足这样的性质的排列 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span> 的方案数。答案对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>10</mn><mn>9</mn></msup><mo>+</mo><mn>7</mn></mrow><annotation encoding=\"application/x-tex\">10^9+7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">9</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">7</span></span></span></span> 取模。\n范围：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>≤</mo><mi>N</mi><mo>≤</mo><mn>3000</mn></mrow><annotation encoding=\"application/x-tex\">2 \\le N \\le 3000</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3000</span></span></span></span>。</p><p>这里采用 <em>从左往右依次确定相对大小(在前缀中的排名)</em> 的方法求解。\n首先设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo separator=\"true\">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">f_{i,j}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span> 表示在前 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 个位置上填入 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>→</mo><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">1 \\to i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span>，且最后一位为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span></span> 的方案数，显然边界为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mn>1</mn><mo separator=\"true\">,</mo><mn>1</mn></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">f_{1,1}=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>。接下来考虑转移。我们可以将前 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">i-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7429em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≥</mo><mi>j</mi></mrow><annotation encoding=\"application/x-tex\">\\geq j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span></span></span></span> 都 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">1</span></span></span></span> 以保证是排列，枚举第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">i-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7429em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 个数是多少，我们就得到了转移方程：\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mrow><mo fence=\"true\">{</mo><mtable rowspacing=\"0.25em\" columnalign=\"right\" columnspacing=\"\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow></msubsup></mstyle><msub><mi>f</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub><mtext>，</mtext><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mi mathvariant=\"normal\">\"</mi><mo>&#x3C;</mo><mi mathvariant=\"normal\">\"</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mstyle scriptlevel=\"0\" displaystyle=\"false\"><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow></msubsup></mstyle><msub><mi>f</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>k</mi></mrow></msub><mtext>，</mtext><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mi mathvariant=\"normal\">\"</mi><mo>></mo><mi mathvariant=\"normal\">\"</mi></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding=\"application/x-tex\"> f(x)=\\left\\{\\begin{aligned}{\\textstyle \\sum_{j-1}^{k=1}} f_{i-1,k}，s_i=\"&#x3C;\" \\\\{\\textstyle \\sum_{i-1}^{k=1}} f_{i-1,k}，s_i=\">\"\\end{aligned}\\right.</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.6em;vertical-align:-1.55em;\"></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.05em;\"><span style=\"top:-2.5em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎩</span></span></span><span style=\"top:-2.492em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span style=\"height:0.016em;width:0.8889em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"0.8889em\" height=\"0.016em\" style=\"width:0.8889em\" viewBox=\"0 0 888.89 16\" preserveAspectRatio=\"xMinYMin\"><path d=\"M384 0 H504 V16 H384z M384 0 H504 V16 H384z\"></path></svg></span></span><span style=\"top:-3.15em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎨</span></span></span><span style=\"top:-4.292em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span style=\"height:0.016em;width:0.8889em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"0.8889em\" height=\"0.016em\" style=\"width:0.8889em\" viewBox=\"0 0 888.89 16\" preserveAspectRatio=\"xMinYMin\"><path d=\"M384 0 H504 V16 H384z M384 0 H504 V16 H384z\"></path></svg></span></span><span style=\"top:-4.3em;\"><span class=\"pstrut\" style=\"height:3.15em;\"></span><span class=\"delimsizinginner delim-size4\"><span>⎧</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.55em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.9369em;\"><span style=\"top:-3.9479em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.989em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4358em;\"><span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mord cjk_fallback\">，</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">\"</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&#x3C;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">\"</span></span></span><span style=\"top:-2.2231em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.989em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.358em;\"><span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mord cjk_fallback\">，</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">\"</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">\"</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4369em;\"><span></span></span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:88ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#include</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">&#x3C;bits/stdc++.h></span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#define</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">std</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> N</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">3005</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,mod</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#F97583;--1:#F97583\">e</span><span style=\"--0:#79B8FF;--1:#79B8FF\">9</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">7</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> n,f[N][N],sum[N][N];</span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> s[N];</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,t</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) t</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),x</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">static</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> sta[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">35</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> top</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{sta[top</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sta[</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">file</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".in\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"r\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdin);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".out\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"w\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdout);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">23</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">ch</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x),</span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch)),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">24</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">25</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">signed</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">main</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">26</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) s[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();f[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">27</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) sum[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">28</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">29</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> j</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;j</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i;j</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">30</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(s[i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'&#x3C;'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) f[i][j]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">sum[i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][j</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">31</div></div><div class=\"code\"><span class=\"indent\">            </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(s[i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'>'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) f[i][j]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sum[i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">sum[i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">][j</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:12ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">32</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">            </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">sum[i][j]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sum[i][j</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i][j])</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">33</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">34</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">35</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sum[n][n]</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#79B8FF;--1:#79B8FF\">\\n</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">36</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">37</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h3 id=\"例题2cf1806d-dsu-master\">例题2：<a href=\"https://codeforces.com/contest/1806/problem/D\">CF1806D</a> <a href=\"https://www.luogu.com.cn/problem/CF1806D\">DSU Master</a><a class=\"anchor\" href=\"#例题2cf1806d-dsu-master\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p>给出序列 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>。对于一个长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">m−1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 的排列 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span>，定义它的价值如下：有一个初始为森林的并查集，按照 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><msub><mi>p</mi><mi>m</mi></msub><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">p_1...p_m-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">...</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 的顺序合并并查集 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">p_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">p_{i+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span></span></span></span>，如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><msub><mi>p</mi><mi>i</mi></msub></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">a_{p_{i}}=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>，那么将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">p_{i}+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 所在的并查集的根并到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">p_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 所在的并查集的根上，否则将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">p_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 并所在并查集到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">p_i+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 所在的并查集的根上，进行完所有操作后 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 的儿子的个数。你需要对于所有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">k \\in [1,n−1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7335em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span> 求出长度为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo stretchy=\"false\">!</mo></mrow><annotation encoding=\"application/x-tex\">k!</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">!</span></span></span></span> 中排列顺序的价值和，对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>998244353</mn></mrow><annotation encoding=\"application/x-tex\">998244353</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">998244353</span></span></span></span> 取模。</p><p>根据连边方式，⼀个连通块始终是值域上的⼀个区间。\n首先拆贡献，考虑 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub><mo>=</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">p_i=x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 什么时候会产生贡献，首先要 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>x</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">a_x=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>，然后连 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(x,x+1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>，要求是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>→</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">1 \\to x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 已经连通，也就是在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>p</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><msub><mi>p</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">p_1,p_2,...,p_{i-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">...</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span></span></span></span> 中出现了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>→</mo><mi>x</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1 \\to x-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>x</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">a_x=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 时满足这个条件会消除后续的所有贡献。\n设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mi>n</mi><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">ans_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">an</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>→</mo><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">1 \\to i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 所有排列的答案，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示若 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">a_{i+1}=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> 额外的贡献，考虑用<strong>从小到大依次插入序列中</strong>的方法。\n转移时考虑枚举 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 的位置，显然放前 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">i-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7429em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span> 个空隙中不影响答案，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">a_i=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> 时放在最后有额外的贡献，否则将贡献清空。这样状态转移方程就写出来了：</p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo fence=\"true\">{</mo><mtable rowspacing=\"0.36em\" columnalign=\"left left\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>f</mi><mi>i</mi></msub><mo>=</mo><msub><mi>f</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>⋅</mo><mi>i</mi><mo separator=\"true\">,</mo><mtext>            </mtext><mi>a</mi><mi>n</mi><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mi>a</mi><mi>n</mi><msub><mi>s</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>⋅</mo><mi>i</mi><mo>+</mo><msub><mi>f</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>f</mi><mi>i</mi></msub><mo>=</mo><msub><mi>f</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>⋅</mo><mo stretchy=\"false\">(</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mtext>  </mtext><mi>a</mi><mi>n</mi><msub><mi>s</mi><mi>i</mi></msub><mo>=</mo><mi>a</mi><mi>n</mi><msub><mi>s</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>⋅</mo><mi>i</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding=\"application/x-tex\">\\begin{cases}\nf_i=f_{i-1}\\cdot i,\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ ans_i=ans_{i-1}\\cdot i+f_{i-1}&#x26;a_i=0\\\\\nf_i=f_{i-1}\\cdot(i-1),\\ \\ ans_i=ans_{i-1}\\cdot i&#x26;a_i=1\n\\end{cases}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:3em;vertical-align:-1.25em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size4\">{</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.69em;\"><span style=\"top:-3.69em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mpunct\">,</span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">an</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">an</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\"> </span><span class=\"mspace\"> </span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">an</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">an</span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.19em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:1em;\"></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.69em;\"><span style=\"top:-3.69em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">0</span></span></span><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.008em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.19em;\"><span></span></span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"cpp\" class=\"wrap\" style=\"--ecMaxLine:88ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#include</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">&#x3C;bits/stdc++.h></span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">#define</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">long</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">std</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> N</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#F97583;--1:#F97583\">e</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#79B8FF;--1:#79B8FF\">5</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,mod</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">998244353</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> n,a[N],f[N],ans[N];</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,t</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">||</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) t</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch</span><span style=\"--0:#F97583;--1:#F97583\">>=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#F97583;--1:#F97583\">&#x26;&#x26;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'9'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){tot</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ch</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;ch</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">getchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tot</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">t;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'-'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">),x</span><span style=\"--0:#F97583;--1:#F97583\">=-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">static</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> sta[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">35</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">];</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> top</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">do</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{sta[top</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">x</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,x</span><span style=\"--0:#F97583;--1:#F97583\">/=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">10</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;}</span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(top) </span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(sta[</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">top]</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'0'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">file</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".in\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"r\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdin);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">freopen</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\".out\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"w\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,stdout);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">23</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">x</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">,</span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">char</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#FFAB70;--1:#FFAB70\">ch</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> (</span><span style=\"--0:#B392F0;--1:#B392F0\">write</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(x),</span><span style=\"--0:#B392F0;--1:#B392F0\">putchar</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ch)),</span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">24</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span><span style=\"--0:#F97583;--1:#F97583\">using</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">namespace</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">rw</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">25</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">inline</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">void</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">solve</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">26</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">27</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) a[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">28</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">29</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">30</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">if</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(a[i]</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) f[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">31</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#F97583;--1:#F97583\">else</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> f[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">32</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">33</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ans[</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">34</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">for</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> i</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;i</span><span style=\"--0:#F97583;--1:#F97583\">&#x3C;</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">n;i</span><span style=\"--0:#F97583;--1:#F97583\">++</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">35</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">        </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">ans[i]</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ans[i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">]</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">i</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod</span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(a[i]</span><span style=\"--0:#F97583;--1:#F97583\">==</span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span><span style=\"--0:#F97583;--1:#F97583\">*</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">f[i</span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">])</span><span style=\"--0:#F97583;--1:#F97583\">%</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">mod;</span></div></div><div class=\"ec-line\" style=\"--ecIndent:8ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">36</div></div><div class=\"code\"><span class=\"indent\">        </span><span style=\"--0:#B392F0;--1:#B392F0\">print</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(ans[i],</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">' '</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">37</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">38</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#B392F0;--1:#B392F0\">puts</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">39</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">40</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">signed</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">main</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(){</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">41</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">int</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> T</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#B392F0;--1:#B392F0\">read</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">42</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">while</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(T</span><span style=\"--0:#F97583;--1:#F97583\">--</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">) </span><span style=\"--0:#B392F0;--1:#B392F0\">solve</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">();</span></div></div><div class=\"ec-line\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">43</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">0</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">44</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section></section><section><h2 id=\"括号序列问题\">括号序列问题<a class=\"anchor\" href=\"#括号序列问题\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>解决这类问题，考虑几个对括号序列经典的刻画。</p><ul>\n<li>将左括号看成 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>，右括号看成 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>，一个括号序列合法当且仅当前缀和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≤</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">\\le 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> 且总和为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>。</li>\n<li>将上述过程画在折线统计图。</li>\n<li>递归定义，空串是合法序列，若 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mn>1</mn><mo separator=\"true\">,</mo><mi>S</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">S1,S2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord\">2</span></span></span></span> 是合法序列，则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>S</mi><mn>1</mn><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mo stretchy=\"false\">(</mo><mi>S</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mi>S</mi><mn>1</mn><mi>S</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">(S1),(S2),S1S2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord\">2</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord\">1</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord\">2</span></span></span></span> 均为合法序列。</li>\n</ul></section><section><h2 id=\"slope-trick\">Slope Trick<a class=\"anchor\" href=\"#slope-trick\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p>这是管理连续凸函数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo>:</mo><mi>R</mi><mo>→</mo><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">f:R \\to R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span> 的技巧，注意和斜率优化区分开来。\n下面从分段函数入手。\n一个连续的分段函数的每一段斜率范围应为：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>l</mi><mo separator=\"true\">,</mo><mi>l</mi><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>l</mi><mo>+</mo><mn>2</mn><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi>r</mi><mo>−</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>r</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[l,l+1,l+2,...r-1,r]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">...</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">]</span></span></span></span>。\n此处要求斜率均为整数。可存在斜率为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> 的线段。</p></section></section>",{headings:417,localImagePaths:499,remoteImagePaths:500,frontmatter:501,imagePaths:507},[418,421,424,427,430,433,436,439,442,445,448,451,454,457,460,463,466,469,472,475,478,481,484,487,490,493,496],{depth:14,slug:419,text:420},"树形dp","树形DP#",{depth:52,slug:422,text:423},"求所有点的子树大小","求所有点的子树大小#",{depth:52,slug:425,text:426},"树上最大独立集","树上最大独立集#",{depth:52,slug:428,text:429},"树上背包","树上背包#",{depth:171,slug:431,text:432},"例题p2014-ctsc1997-选课","例题：P2014 [CTSC1997] 选课#",{depth:171,slug:434,text:435},"p11363-noip2024-树的遍历","P11363 [NOIP2024] 树的遍历#",{depth:52,slug:437,text:438},"换根-dptextdpdp","换根 DP\\text${DP}DP#",{depth:171,slug:440,text:441},"例题p3478-poi-2008-sta-station","例题：P3478 [POI 2008] STA-Station#",{depth:14,slug:443,text:444},"状压-dptextdpdp","状压 DP\\text${DP}DP#",{depth:171,slug:446,text:447},"例题1p1896-scoi2005-互不侵犯","例题1：P1896 [SCOI2005] 互不侵犯#",{depth:171,slug:449,text:450},"例题2p3959-noip-2017-提高组-宝藏","例题2：P3959 [NOIP 2017 提高组] 宝藏#",{depth:171,slug:452,text:453},"例题3cf1767e-algebra-flash","例题3：CF1767E Algebra Flash#",{depth:14,slug:455,text:456},"数位-dptextdpdp","数位 DP\\text${DP}DP#",{depth:171,slug:458,text:459},"例题1p2602-zjoi2010-数字计数","例题1：P2602 [ZJOI2010] 数字计数#",{depth:14,slug:461,text:462},"概率-dptextdpdp-和期望-dptextdpdp","概率 DP\\text${DP}DP 和期望 DP\\text${DP}DP#",{depth:52,slug:464,text:465},"概率-dptextdpdp","概率 DP\\text${DP}DP#",{depth:171,slug:467,text:468},"例题cf148d-bag-of-mice","例题：CF148D Bag of mice#",{depth:52,slug:470,text:471},"期望-dptextdpdp","期望 DP\\text${DP}DP#",{depth:171,slug:473,text:474},"例题1at_dp_j-sushi","例题1：AT_dp_j Sushi#",{depth:52,slug:476,text:477},"待定系数法","待定系数法#",{depth:14,slug:479,text:480},"dptextdpdp-方法","DP\\text${DP}DP 方法#",{depth:52,slug:482,text:483},"排列方法","排列方法#",{depth:171,slug:485,text:486},"逐步生成","逐步生成#",{depth:171,slug:488,text:489},"例题1at_dp_t-permutation","例题1：AT_dp_t Permutation#",{depth:171,slug:491,text:492},"例题2cf1806d-dsu-master","例题2：CF1806D DSU Master#",{depth:52,slug:494,text:495},"括号序列问题","括号序列问题#",{depth:52,slug:497,text:498},"slope-trick","Slope Trick#",[],[],{title:408,published:502,description:37,image:37,tags:503,category:39,draft:36,lang:37,minutes:504,words:505,excerpt:506},["Date","2025-06-11T00:00:00.000Z"],[39],25,4978,"树形 \\text{DP}，即在树上进行的 \\text{DP}。\n由于遍历树固有的递归性质，树形 \\text{DP} 一般都是递归进行的。我们将从一些经典模型和例子开始。",[],"DP_impove.md","expressive-code",{id:509,data:511,body:516,filePath:517,digest:518,rendered:519,legacyId:609},{title:512,published:513,draft:90,description:514,image:37,tags:515,category:65,lang:37,prevTitle:37,prevSlug:37,nextTitle:37,nextSlug:37},"Expressive Code Example",["Date","2024-04-10T00:00:00.000Z"],"How code blocks look in Markdown using Expressive Code.",[62,63,64],"Here, we'll explore how code blocks look using [Expressive Code](https://expressive-code.com/). The provided examples are based on the official documentation, which you can refer to for further details.\n\n## Expressive Code\n\n### Syntax Highlighting\n\n[Syntax Highlighting](https://expressive-code.com/key-features/syntax-highlighting/)\n\n#### Regular syntax highlighting\n\n```js\nconsole.log('This code is syntax highlighted!')\n```\n\n#### Rendering ANSI escape sequences\n\n```ansi\nANSI colors:\n- Regular: \u001b[31mRed\u001b[0m \u001b[32mGreen\u001b[0m \u001b[33mYellow\u001b[0m \u001b[34mBlue\u001b[0m \u001b[35mMagenta\u001b[0m \u001b[36mCyan\u001b[0m\n- Bold:    \u001b[1;31mRed\u001b[0m \u001b[1;32mGreen\u001b[0m \u001b[1;33mYellow\u001b[0m \u001b[1;34mBlue\u001b[0m \u001b[1;35mMagenta\u001b[0m \u001b[1;36mCyan\u001b[0m\n- Dimmed:  \u001b[2;31mRed\u001b[0m \u001b[2;32mGreen\u001b[0m \u001b[2;33mYellow\u001b[0m \u001b[2;34mBlue\u001b[0m \u001b[2;35mMagenta\u001b[0m \u001b[2;36mCyan\u001b[0m\n\n256 colors (showing colors 160-177):\n\u001b[38;5;160m160 \u001b[38;5;161m161 \u001b[38;5;162m162 \u001b[38;5;163m163 \u001b[38;5;164m164 \u001b[38;5;165m165\u001b[0m\n\u001b[38;5;166m166 \u001b[38;5;167m167 \u001b[38;5;168m168 \u001b[38;5;169m169 \u001b[38;5;170m170 \u001b[38;5;171m171\u001b[0m\n\u001b[38;5;172m172 \u001b[38;5;173m173 \u001b[38;5;174m174 \u001b[38;5;175m175 \u001b[38;5;176m176 \u001b[38;5;177m177\u001b[0m\n\nFull RGB colors:\n\u001b[38;2;34;139;34mForestGreen - RGB(34, 139, 34)\u001b[0m\n\nText formatting: \u001b[1mBold\u001b[0m \u001b[2mDimmed\u001b[0m \u001b[3mItalic\u001b[0m \u001b[4mUnderline\u001b[0m\n```\n\n### Editor & Terminal Frames\n\n[Editor & Terminal Frames](https://expressive-code.com/key-features/frames/)\n\n#### Code editor frames\n\n```js title=\"my-test-file.js\"\nconsole.log('Title attribute example')\n```\n\n---\n\n```html\n<!-- src/content/index.html -->\n<div>File name comment example</div>\n```\n\n#### Terminal frames\n\n```bash\necho \"This terminal frame has no title\"\n```\n\n---\n\n```powershell title=\"PowerShell terminal example\"\nWrite-Output \"This one has a title!\"\n```\n\n#### Overriding frame types\n\n```sh frame=\"none\"\necho \"Look ma, no frame!\"\n```\n\n---\n\n```ps frame=\"code\" title=\"PowerShell Profile.ps1\"\n# Without overriding, this would be a terminal frame\nfunction Watch-Tail { Get-Content -Tail 20 -Wait $args }\nNew-Alias tail Watch-Tail\n```\n\n### Text & Line Markers\n\n[Text & Line Markers](https://expressive-code.com/key-features/text-markers/)\n\n#### Marking full lines & line ranges\n\n```js {1, 4, 7-8}\n// Line 1 - targeted by line number\n// Line 2\n// Line 3\n// Line 4 - targeted by line number\n// Line 5\n// Line 6\n// Line 7 - targeted by range \"7-8\"\n// Line 8 - targeted by range \"7-8\"\n```\n\n#### Selecting line marker types (mark, ins, del)\n\n```js title=\"line-markers.js\" del={2} ins={3-4} {6}\nfunction demo() {\n  console.log('this line is marked as deleted')\n  // This line and the next one are marked as inserted\n  console.log('this is the second inserted line')\n\n  return 'this line uses the neutral default marker type'\n}\n```\n\n#### Adding labels to line markers\n\n```jsx {\"1\":5} del={\"2\":7-8} ins={\"3\":10-12}\n// labeled-line-markers.jsx\n<button\n  role=\"button\"\n  {...props}\n  value={value}\n  className={buttonClassName}\n  disabled={disabled}\n  active={active}\n>\n  {children &&\n    !active &&\n    (typeof children === 'string' ? <span>{children}</span> : children)}\n</button>\n```\n\n#### Adding long labels on their own lines\n\n```jsx {\"1. Provide the value prop here:\":5-6} del={\"2. Remove the disabled and active states:\":8-10} ins={\"3. Add this to render the children inside the button:\":12-15}\n// labeled-line-markers.jsx\n<button\n  role=\"button\"\n  {...props}\n\n  value={value}\n  className={buttonClassName}\n\n  disabled={disabled}\n  active={active}\n>\n\n  {children &&\n    !active &&\n    (typeof children === 'string' ? <span>{children}</span> : children)}\n</button>\n```\n\n#### Using diff-like syntax\n\n```diff\n+this line will be marked as inserted\n-this line will be marked as deleted\nthis is a regular line\n```\n\n---\n\n```diff\n--- a/README.md\n+++ b/README.md\n@@ -1,3 +1,4 @@\n+this is an actual diff file\n-all contents will remain unmodified\n no whitespace will be removed either\n```\n\n#### Combining syntax highlighting with diff-like syntax\n\n```diff lang=\"js\"\n  function thisIsJavaScript() {\n    // This entire block gets highlighted as JavaScript,\n    // and we can still add diff markers to it!\n-   console.log('Old code to be removed')\n+   console.log('New and shiny code!')\n  }\n```\n\n#### Marking individual text inside lines\n\n```js \"given text\"\nfunction demo() {\n  // Mark any given text inside lines\n  return 'Multiple matches of the given text are supported';\n}\n```\n\n#### Regular expressions\n\n```ts /ye[sp]/\nconsole.log('The words yes and yep will be marked.')\n```\n\n#### Escaping forward slashes\n\n```sh /\\/ho.*\\//\necho \"Test\" > /home/test.txt\n```\n\n#### Selecting inline marker types (mark, ins, del)\n\n```js \"return true;\" ins=\"inserted\" del=\"deleted\"\nfunction demo() {\n  console.log('These are inserted and deleted marker types');\n  // The return statement uses the default marker type\n  return true;\n}\n```\n\n### Word Wrap\n\n[Word Wrap](https://expressive-code.com/key-features/word-wrap/)\n\n#### Configuring word wrap per block\n\n```js wrap\n// Example with wrap\nfunction getLongString() {\n  return 'This is a very long string that will most probably not fit into the available space unless the container is extremely wide'\n}\n```\n\n---\n\n```js wrap=false\n// Example with wrap=false\nfunction getLongString() {\n  return 'This is a very long string that will most probably not fit into the available space unless the container is extremely wide'\n}\n```\n\n#### Configuring indentation of wrapped lines\n\n```js wrap preserveIndent\n// Example with preserveIndent (enabled by default)\nfunction getLongString() {\n  return 'This is a very long string that will most probably not fit into the available space unless the container is extremely wide'\n}\n```\n\n---\n\n```js wrap preserveIndent=false\n// Example with preserveIndent=false\nfunction getLongString() {\n  return 'This is a very long string that will most probably not fit into the available space unless the container is extremely wide'\n}\n```\n\n## Collapsible Sections\n\n[Collapsible Sections](https://expressive-code.com/plugins/collapsible-sections/)\n\n```js collapse={1-5, 12-14, 21-24}\n// All this boilerplate setup code will be collapsed\nimport { someBoilerplateEngine } from '@example/some-boilerplate'\nimport { evenMoreBoilerplate } from '@example/even-more-boilerplate'\n\nconst engine = someBoilerplateEngine(evenMoreBoilerplate())\n\n// This part of the code will be visible by default\nengine.doSomething(1, 2, 3, calcFn)\n\nfunction calcFn() {\n  // You can have multiple collapsed sections\n  const a = 1\n  const b = 2\n  const c = a + b\n\n  // This will remain visible\n  console.log(`Calculation result: ${a} + ${b} = ${c}`)\n  return c\n}\n\n// All this code until the end of the block will be collapsed again\nengine.closeConnection()\nengine.freeMemory()\nengine.shutdown({ reason: 'End of example boilerplate code' })\n```\n\n## Line Numbers\n\n[Line Numbers](https://expressive-code.com/plugins/line-numbers/)\n\n### Displaying line numbers per block\n\n```js showLineNumbers\n// This code block will show line numbers\nconsole.log('Greetings from line 2!')\nconsole.log('I am on line 3')\n```\n\n---\n\n```js showLineNumbers=false\n// Line numbers are disabled for this block\nconsole.log('Hello?')\nconsole.log('Sorry, do you know what line I am on?')\n```\n\n### Changing the starting line number\n\n```js showLineNumbers startLineNumber=5\nconsole.log('Greetings from line 5!')\nconsole.log('I am on line 6')\n```","src/content/posts/expressive-code.md","ade8396dadf485dd",{html:520,metadata:521},"<p>Here, we’ll explore how code blocks look using <a href=\"https://expressive-code.com/\">Expressive Code</a>. The provided examples are based on the official documentation, which you can refer to for further details.</p>\n<section><h2 id=\"expressive-code\">Expressive Code<a class=\"anchor\" href=\"#expressive-code\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><section><h3 id=\"syntax-highlighting\">Syntax Highlighting<a class=\"anchor\" href=\"#syntax-highlighting\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p><a href=\"https://expressive-code.com/key-features/syntax-highlighting/\">Syntax Highlighting</a></p><section><h4 id=\"regular-syntax-highlighting\">Regular syntax highlighting<a class=\"anchor\" href=\"#regular-syntax-highlighting\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><link rel=\"stylesheet\" href=\"/_astro/ec.d1dr8.css\"><script type=\"module\" src=\"/_astro/ec.qopfj.js\"></script><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:47ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#B392F0;--1:#B392F0\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'This code is syntax highlighted!'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h4 id=\"rendering-ansi-escape-sequences\">Rendering ANSI escape sequences<a class=\"anchor\" href=\"#rendering-ansi-escape-sequences\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame is-terminal\"><figcaption class=\"header\"><span class=\"title\"></span><span class=\"sr-only\">Terminal window</span></figcaption><pre data-language=\"ansi\" class=\"wrap\" style=\"--ecMaxLine:45ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">ANSI colors:</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">- Regular: </span><span style=\"--0:#ea4a5a;--1:#ea4a5a\">Red</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#34d058;--1:#34d058\">Green</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#ffea7f;--1:#ffea7f\">Yellow</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#2188ff;--1:#2188ff\">Blue</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#b392f0;--1:#b392f0\">Magenta</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#39c5cf;--1:#39c5cf\">Cyan</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">- Bold:    </span><span style=\"--0:#ea4a5a;--0fw:bold;--1:#ea4a5a;--1fw:bold\">Red</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#34d058;--0fw:bold;--1:#34d058;--1fw:bold\">Green</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#ffea7f;--0fw:bold;--1:#ffea7f;--1fw:bold\">Yellow</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#2188ff;--0fw:bold;--1:#2188ff;--1fw:bold\">Blue</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#b392f0;--0fw:bold;--1:#b392f0;--1fw:bold\">Magenta</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#39c5cf;--0fw:bold;--1:#39c5cf;--1fw:bold\">Cyan</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">- Dimmed:  </span><span style=\"--0:#ea4a5a80;--1:#ea4a5a80\">Red</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#34d05880;--1:#34d05880\">Green</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#ffea7f80;--1:#ffea7f80\">Yellow</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#2188ff80;--1:#2188ff80\">Blue</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#b392f080;--1:#b392f080\">Magenta</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#39c5cf80;--1:#39c5cf80\">Cyan</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\">\n</div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">256 colors (showing colors 160-177):</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span style=\"--0:#d70000;--1:#d70000\">160 </span><span style=\"--0:#d7005f;--1:#d7005f\">161 </span><span style=\"--0:#d70087;--1:#d70087\">162 </span><span style=\"--0:#d700af;--1:#d700af\">163 </span><span style=\"--0:#d700d7;--1:#d700d7\">164 </span><span style=\"--0:#d700ff;--1:#d700ff\">165</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span style=\"--0:#d75f00;--1:#d75f00\">166 </span><span style=\"--0:#d75f5f;--1:#d75f5f\">167 </span><span style=\"--0:#d75f87;--1:#d75f87\">168 </span><span style=\"--0:#d75faf;--1:#d75faf\">169 </span><span style=\"--0:#d75fd7;--1:#d75fd7\">170 </span><span style=\"--0:#d75fff;--1:#d75fff\">171</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span style=\"--0:#d78700;--1:#d78700\">172 </span><span style=\"--0:#d7875f;--1:#d7875f\">173 </span><span style=\"--0:#d78787;--1:#d78787\">174 </span><span style=\"--0:#d787af;--1:#d787af\">175 </span><span style=\"--0:#d787d7;--1:#d787d7\">176 </span><span style=\"--0:#d787ff;--1:#d787ff\">177</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\">\n</div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">Full RGB colors:</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span style=\"--0:#228b22;--1:#228b22\">ForestGreen - RGB(34, 139, 34)</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\">\n</div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span style=\"--0:#e1e4e8;--1:#e1e4e8\">Text formatting: </span><span style=\"--0:#e1e4e8;--0fw:bold;--1:#e1e4e8;--1fw:bold\">Bold</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#e1e4e880;--1:#e1e4e880\">Dimmed</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#e1e4e8;--0fs:italic;--1:#e1e4e8;--1fs:italic\">Italic</span><span style=\"--0:#e1e4e8;--1:#e1e4e8\"> </span><span style=\"--0:#e1e4e8;--0td:underline;--1:#e1e4e8;--1td:underline\">Underline</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section></section><section><h3 id=\"editor--terminal-frames\">Editor &#x26; Terminal Frames<a class=\"anchor\" href=\"#editor--terminal-frames\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p><a href=\"https://expressive-code.com/key-features/frames/\">Editor &#x26; Terminal Frames</a></p><section><h4 id=\"code-editor-frames\">Code editor frames<a class=\"anchor\" href=\"#code-editor-frames\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame has-title\"><figcaption class=\"header\"><span class=\"title\">my-test-file.js</span></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:38ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#B392F0;--1:#B392F0\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'Title attribute example'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><hr><div class=\"expressive-code\"><figure class=\"frame has-title\"><figcaption class=\"header\"><span class=\"title\">src/content/index.html</span></figcaption><pre data-language=\"html\" class=\"wrap\" style=\"--ecMaxLine:36ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">&#x3C;</span><span style=\"--0:#85E89D;--1:#85E89D\">div</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">>File name comment example&#x3C;/</span><span style=\"--0:#85E89D;--1:#85E89D\">div</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">></span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h4 id=\"terminal-frames\">Terminal frames<a class=\"anchor\" href=\"#terminal-frames\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame is-terminal\"><figcaption class=\"header\"><span class=\"title\"></span><span class=\"sr-only\">Terminal window</span></figcaption><pre data-language=\"bash\" class=\"wrap\" style=\"--ecMaxLine:39ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#79B8FF;--1:#79B8FF\">echo</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"This terminal frame has no title\"</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><hr><div class=\"expressive-code\"><figure class=\"frame is-terminal has-title\"><figcaption class=\"header\"><span class=\"title\">PowerShell terminal example</span></figcaption><pre data-language=\"powershell\" class=\"wrap\" style=\"--ecMaxLine:36ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#79B8FF;--1:#79B8FF\">Write-Output</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"This one has a title!\"</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h4 id=\"overriding-frame-types\">Overriding frame types<a class=\"anchor\" href=\"#overriding-frame-types\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"sh\" class=\"wrap\" style=\"--ecMaxLine:25ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#79B8FF;--1:#79B8FF\">echo</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"Look ma, no frame!\"</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><hr><div class=\"expressive-code\"><figure class=\"frame has-title\"><figcaption class=\"header\"><span class=\"title\">PowerShell Profile.ps1</span></figcaption><pre data-language=\"ps\" class=\"wrap\" style=\"--ecMaxLine:56ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\"># Without overriding, this would be a terminal frame</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">function</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">Watch-Tail</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> { </span><span style=\"--0:#79B8FF;--1:#79B8FF\">Get-Content</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">Tail </span><span style=\"--0:#79B8FF;--1:#79B8FF\">20</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">-</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">Wait </span><span style=\"--0:#79B8FF;--1:#79B8FF\">$args</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> }</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#79B8FF;--1:#79B8FF\">New-Alias</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> tail </span><span style=\"--0:#79B8FF;--1:#79B8FF\">Watch-Tail</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section></section><section><h3 id=\"text--line-markers\">Text &#x26; Line Markers<a class=\"anchor\" href=\"#text--line-markers\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p><a href=\"https://expressive-code.com/key-features/text-markers/\">Text &#x26; Line Markers</a></p><section><h4 id=\"marking-full-lines--line-ranges\">Marking full lines &#x26; line ranges<a class=\"anchor\" href=\"#marking-full-lines--line-ranges\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:35ch\"><code><div class=\"ec-line highlight mark\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#b2b7bc;--1:#b2b7bc\">// Line 1 - targeted by line number</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\">// Line 2</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\">// Line 3</span></div></div><div class=\"ec-line highlight mark\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#b2b7bc;--1:#b2b7bc\">// Line 4 - targeted by line number</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\">// Line 5</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\">// Line 6</span></div></div><div class=\"ec-line highlight mark\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span style=\"--0:#b2b7bc;--1:#b2b7bc\">// Line 7 - targeted by range \"7-8\"</span></div></div><div class=\"ec-line highlight mark\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span style=\"--0:#b2b7bc;--1:#b2b7bc\">// Line 8 - targeted by range \"7-8\"</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h4 id=\"selecting-line-marker-types-mark-ins-del\">Selecting line marker types (mark, ins, del)<a class=\"anchor\" href=\"#selecting-line-marker-types-mark-ins-del\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame has-title\"><figcaption class=\"header\"><span class=\"title\">line-markers.js</span></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:57ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">function</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">demo</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">() {</span></div></div><div class=\"ec-line highlight del\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#bfa4f2;--1:#bfa4f2\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'this line is marked as deleted'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div><div class=\"ec-line highlight ins\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#b1b7bb;--1:#b1b7bb\">// This line and the next one are marked as inserted</span></div></div><div class=\"ec-line highlight ins\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#c3a9f3;--1:#c3a9f3\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'this is the second inserted line'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\">\n</div></div><div class=\"ec-line highlight mark\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#fb9ca6;--1:#fb9ca6\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'this line uses the neutral default marker type'</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h4 id=\"adding-labels-to-line-markers\">Adding labels to line markers<a class=\"anchor\" href=\"#adding-labels-to-line-markers\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame has-title\"><figcaption class=\"header\"><span class=\"title\">labeled-line-markers.jsx</span></figcaption><pre data-language=\"jsx\" class=\"wrap\" style=\"--ecMaxLine:72ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">&#x3C;</span><span style=\"--0:#85E89D;--1:#85E89D\">button</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#B392F0;--1:#B392F0\">role</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"button\"</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span><span style=\"--0:#F97583;--1:#F97583\">...</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">props}</span></div></div><div class=\"ec-line highlight mark tm-label\" style=\"--tmLabel:&#x27;1&#x27;;--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#c4aaf3;--1:#c4aaf3\">value</span><span style=\"--0:#fb9ca6;--1:#fb9ca6\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{value}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#B392F0;--1:#B392F0\">className</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{buttonClassName}</span></div></div><div class=\"ec-line highlight del tm-label\" style=\"--tmLabel:&#x27;2&#x27;;--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#bfa4f2;--1:#bfa4f2\">disabled</span><span style=\"--0:#fa95a0;--1:#fa95a0\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{disabled}</span></div></div><div class=\"ec-line highlight del\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#bfa4f2;--1:#bfa4f2\">active</span><span style=\"--0:#fa95a0;--1:#fa95a0\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{active}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">></span></div></div><div class=\"ec-line highlight ins tm-label\" style=\"--tmLabel:&#x27;3&#x27;;--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{children </span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">&#x26;&#x26;</span></div></div><div class=\"ec-line highlight ins\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">!</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">active </span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">&#x26;&#x26;</span></div></div><div class=\"ec-line highlight ins\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">typeof</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> children </span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">===</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'string'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">?</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> &#x3C;</span><span style=\"--0:#85E89D;--1:#85E89D\">span</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">>{children}&#x3C;/</span><span style=\"--0:#85E89D;--1:#85E89D\">span</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">> </span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">:</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> children)}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">&#x3C;/</span><span style=\"--0:#85E89D;--1:#85E89D\">button</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">></span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h4 id=\"adding-long-labels-on-their-own-lines\">Adding long labels on their own lines<a class=\"anchor\" href=\"#adding-long-labels-on-their-own-lines\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame has-title\"><figcaption class=\"header\"><span class=\"title\">labeled-line-markers.jsx</span></figcaption><pre data-language=\"jsx\" class=\"wrap\" style=\"--ecMaxLine:72ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">&#x3C;</span><span style=\"--0:#85E89D;--1:#85E89D\">button</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#B392F0;--1:#B392F0\">role</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"button\"</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{</span><span style=\"--0:#F97583;--1:#F97583\">...</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">props}</span></div></div><div class=\"ec-line highlight mark tm-label\" style=\"--tmLabel:&#x27;1. Provide the value prop here:&#x27;\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\">\n</div></div><div class=\"ec-line highlight mark\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#c4aaf3;--1:#c4aaf3\">value</span><span style=\"--0:#fb9ca6;--1:#fb9ca6\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{value}</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#B392F0;--1:#B392F0\">className</span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{buttonClassName}</span></div></div><div class=\"ec-line highlight del tm-label\" style=\"--tmLabel:&#x27;2. Remove the disabled and active states:&#x27;\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\">\n</div></div><div class=\"ec-line highlight del\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#bfa4f2;--1:#bfa4f2\">disabled</span><span style=\"--0:#fa95a0;--1:#fa95a0\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{disabled}</span></div></div><div class=\"ec-line highlight del\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#bfa4f2;--1:#bfa4f2\">active</span><span style=\"--0:#fa95a0;--1:#fa95a0\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{active}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">></span></div></div><div class=\"ec-line highlight ins tm-label\" style=\"--tmLabel:&#x27;3. Add this to render the children inside the button:&#x27;\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\">\n</div></div><div class=\"ec-line highlight ins\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">{children </span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">&#x26;&#x26;</span></div></div><div class=\"ec-line highlight ins\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">    </span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">!</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">active </span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">&#x26;&#x26;</span></div></div><div class=\"ec-line highlight ins\" style=\"--ecIndent:4ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">    </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">typeof</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> children </span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">===</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'string'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">?</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> &#x3C;</span><span style=\"--0:#85E89D;--1:#85E89D\">span</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">>{children}&#x3C;/</span><span style=\"--0:#85E89D;--1:#85E89D\">span</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">> </span><span style=\"--0:#fb9ba5;--1:#fb9ba5\">:</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> children)}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">&#x3C;/</span><span style=\"--0:#85E89D;--1:#85E89D\">button</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">></span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h4 id=\"using-diff-like-syntax\">Using diff-like syntax<a class=\"anchor\" href=\"#using-diff-like-syntax\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"diff\" class=\"wrap\" style=\"--ecMaxLine:36ch\"><code><div class=\"ec-line highlight ins\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">this line will be marked as inserted</span></div></div><div class=\"ec-line highlight del\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">this line will be marked as deleted</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">this is a regular line</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><hr><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"diff\" class=\"wrap\" style=\"--ecMaxLine:37ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#FDAEB7;--1:#FDAEB7\">--- a/README.md</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">+++ b/README.md</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#B392F0;--0fw:bold;--1:#B392F0;--1fw:bold\">@@ -1,3 +1,4 @@</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#85E89D;--1:#85E89D\">+this is an actual diff file</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#FDAEB7;--1:#FDAEB7\">-all contents will remain unmodified</span></div></div><div class=\"ec-line\" style=\"--ecIndent:1ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">no whitespace will be removed either</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h4 id=\"combining-syntax-highlighting-with-diff-like-syntax\">Combining syntax highlighting with diff-like syntax<a class=\"anchor\" href=\"#combining-syntax-highlighting-with-diff-like-syntax\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:54ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">function</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">thisIsJavaScript</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">() {</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#99A0A6;--1:#99A0A6\">// This entire block gets highlighted as JavaScript,</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#99A0A6;--1:#99A0A6\">// and we can still add diff markers to it!</span></div></div><div class=\"ec-line highlight del\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#bfa4f2;--1:#bfa4f2\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'Old code to be removed'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div><div class=\"ec-line highlight ins\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#c3a9f3;--1:#c3a9f3\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'New and shiny code!'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h4 id=\"marking-individual-text-inside-lines\">Marking individual text inside lines<a class=\"anchor\" href=\"#marking-individual-text-inside-lines\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:60ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">function</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">demo</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">() {</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#99A0A6;--1:#99A0A6\">// Mark any </span><mark><span style=\"--0:#b2b7bc;--1:#b2b7bc\">given text</span></mark><span style=\"--0:#99A0A6;--1:#99A0A6\"> inside lines</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'Multiple matches of the </span><mark><span style=\"--0:#9ECBFF;--1:#9ECBFF\">given text</span></mark><span style=\"--0:#9ECBFF;--1:#9ECBFF\"> are supported'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h4 id=\"regular-expressions\">Regular expressions<a class=\"anchor\" href=\"#regular-expressions\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"ts\" class=\"wrap\" style=\"--ecMaxLine:52ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#B392F0;--1:#B392F0\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'The words </span><mark><span style=\"--0:#9ECBFF;--1:#9ECBFF\">yes</span></mark><span style=\"--0:#9ECBFF;--1:#9ECBFF\"> and </span><mark><span style=\"--0:#9ECBFF;--1:#9ECBFF\">yep</span></mark><span style=\"--0:#9ECBFF;--1:#9ECBFF\"> will be marked.'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h4 id=\"escaping-forward-slashes\">Escaping forward slashes<a class=\"anchor\" href=\"#escaping-forward-slashes\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame is-terminal\"><figcaption class=\"header\"><span class=\"title\"></span><span class=\"sr-only\">Terminal window</span></figcaption><pre data-language=\"sh\" class=\"wrap\" style=\"--ecMaxLine:28ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#79B8FF;--1:#79B8FF\">echo</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">\"Test\"</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><mark><span style=\"--0:#9ECBFF;--1:#9ECBFF\">/home/</span></mark><span style=\"--0:#9ECBFF;--1:#9ECBFF\">test.txt</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h4 id=\"selecting-inline-marker-types-mark-ins-del\">Selecting inline marker types (mark, ins, del)<a class=\"anchor\" href=\"#selecting-inline-marker-types-mark-ins-del\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:61ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">function</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">demo</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">() {</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#B392F0;--1:#B392F0\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'These are </span><ins><span style=\"--0:#9ECBFF;--1:#9ECBFF\">inserted</span></ins><span style=\"--0:#9ECBFF;--1:#9ECBFF\"> and </span><del><span style=\"--0:#9ECBFF;--1:#9ECBFF\">deleted</span></del><span style=\"--0:#9ECBFF;--1:#9ECBFF\"> marker types'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">);</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#99A0A6;--1:#99A0A6\">// The return statement uses the default marker type</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span class=\"indent\">  </span><mark><span style=\"--0:#fb9ca6;--1:#fb9ca6\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#7ebbff;--1:#7ebbff\">true</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">;</span></mark></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section></section><section><h3 id=\"word-wrap\">Word Wrap<a class=\"anchor\" href=\"#word-wrap\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><p><a href=\"https://expressive-code.com/key-features/word-wrap/\">Word Wrap</a></p><section><h4 id=\"configuring-word-wrap-per-block\">Configuring word wrap per block<a class=\"anchor\" href=\"#configuring-word-wrap-per-block\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:133ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\">// Example with wrap</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">function</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">getLongString</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">() {</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'This is a very long string that will most probably not fit into the available space unless the container is extremely wide'</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><hr><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"js\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\">// Example with wrap=false</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">function</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">getLongString</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">() {</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'This is a very long string that will most probably not fit into the available space unless the container is extremely wide'</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h4 id=\"configuring-indentation-of-wrapped-lines\">Configuring indentation of wrapped lines<a class=\"anchor\" href=\"#configuring-indentation-of-wrapped-lines\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h4><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:133ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\">// Example with preserveIndent (enabled by default)</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">function</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">getLongString</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">() {</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'This is a very long string that will most probably not fit into the available space unless the container is extremely wide'</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><hr><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:133ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\">// Example with preserveIndent=false</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">function</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">getLongString</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">() {</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'This is a very long string that will most probably not fit into the available space unless the container is extremely wide'</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section></section></section>\n<section><h2 id=\"collapsible-sections\">Collapsible Sections<a class=\"anchor\" href=\"#collapsible-sections\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p><a href=\"https://expressive-code.com/plugins/collapsible-sections/\">Collapsible Sections</a></p><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:68ch\"><code><details class=\"ec-section github\"><summary><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\"></div></div><div class=\"code\"><span class=\"expand\"></span><span class=\"collapse\"></span><span class=\"text\">5 collapsed lines</span></div></div></summary><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\">// All this boilerplate setup code will be collapsed</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">import</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> { someBoilerplateEngine } </span><span style=\"--0:#F97583;--1:#F97583\">from</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'@example/some-boilerplate'</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">import</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> { evenMoreBoilerplate } </span><span style=\"--0:#F97583;--1:#F97583\">from</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'@example/even-more-boilerplate'</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">4</div></div><div class=\"code\">\n</div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">engine</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">someBoilerplateEngine</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#B392F0;--1:#B392F0\">evenMoreBoilerplate</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">())</span></div></div></details><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\">\n</div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">7</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\">// This part of the code will be visible by default</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">8</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">engine.</span><span style=\"--0:#B392F0;--1:#B392F0\">doSomething</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">, </span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">, </span><span style=\"--0:#79B8FF;--1:#79B8FF\">3</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">, calcFn)</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">9</div></div><div class=\"code\">\n</div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">10</div></div><div class=\"code\"><span style=\"--0:#F97583;--1:#F97583\">function</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#B392F0;--1:#B392F0\">calcFn</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">() {</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">11</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#99A0A6;--1:#99A0A6\">// You can have multiple collapsed sections</span></div></div><details class=\"ec-section github\"><summary><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\"></div></div><div class=\"code\"><span class=\"expand\"></span><span class=\"collapse\"></span><span class=\"text\">3 collapsed lines</span></div></div></summary><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">12</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">a</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">1</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">13</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">b</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">2</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">14</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">const</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#79B8FF;--1:#79B8FF\">c</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> </span><span style=\"--0:#F97583;--1:#F97583\">=</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> a </span><span style=\"--0:#F97583;--1:#F97583\">+</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> b</span></div></div></details><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">15</div></div><div class=\"code\">\n</div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">16</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#99A0A6;--1:#99A0A6\">// This will remain visible</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">17</div></div><div class=\"code\"><span class=\"indent\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">  </span></span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#B392F0;--1:#B392F0\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">`Calculation result: ${</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">a</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">} + ${</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">b</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">} = ${</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">c</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">}`</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div><div class=\"ec-line\" style=\"--ecIndent:2ch\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">18</div></div><div class=\"code\"><span class=\"indent\">  </span><span style=\"--0:#F97583;--1:#F97583\">return</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> c</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">19</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">}</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">20</div></div><div class=\"code\">\n</div></div><details class=\"ec-section github\"><summary><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\"></div></div><div class=\"code\"><span class=\"expand\"></span><span class=\"collapse\"></span><span class=\"text\">4 collapsed lines</span></div></div></summary><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">21</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\">// All this code until the end of the block will be collapsed again</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">22</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">engine.</span><span style=\"--0:#B392F0;--1:#B392F0\">closeConnection</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">()</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">23</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">engine.</span><span style=\"--0:#B392F0;--1:#B392F0\">freeMemory</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">()</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">24</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">engine.</span><span style=\"--0:#B392F0;--1:#B392F0\">shutdown</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">({ reason: </span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'End of example boilerplate code'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\"> })</span></div></div></details></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section>\n<section><h2 id=\"line-numbers\">Line Numbers<a class=\"anchor\" href=\"#line-numbers\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h2><p><a href=\"https://expressive-code.com/plugins/line-numbers/\">Line Numbers</a></p><section><h3 id=\"displaying-line-numbers-per-block\">Displaying line numbers per block<a class=\"anchor\" href=\"#displaying-line-numbers-per-block\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:41ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">1</div></div><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\">// This code block will show line numbers</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">2</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#B392F0;--1:#B392F0\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'Greetings from line 2!'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">3</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#B392F0;--1:#B392F0\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'I am on line 3'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div><hr><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:52ch\"><code><div class=\"ec-line\"><div class=\"code\"><span style=\"--0:#99A0A6;--1:#99A0A6\">// Line numbers are disabled for this block</span></div></div><div class=\"ec-line\"><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#B392F0;--1:#B392F0\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'Hello?'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div><div class=\"ec-line\"><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#B392F0;--1:#B392F0\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'Sorry, do you know what line I am on?'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section><section><h3 id=\"changing-the-starting-line-number\">Changing the starting line number<a class=\"anchor\" href=\"#changing-the-starting-line-number\"><span class=\"anchor-icon\" data-pagefind-ignore=\"\">#</span></a></h3><div class=\"expressive-code\"><figure class=\"frame\"><figcaption class=\"header\"></figcaption><pre data-language=\"js\" class=\"wrap\" style=\"--ecMaxLine:37ch\"><code><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">5</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#B392F0;--1:#B392F0\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'Greetings from line 5!'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div><div class=\"ec-line\"><div class=\"gutter\"><div class=\"ln\" aria-hidden=\"true\">6</div></div><div class=\"code\"><span style=\"--0:#E1E4E8;--1:#E1E4E8\">console.</span><span style=\"--0:#B392F0;--1:#B392F0\">log</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">(</span><span style=\"--0:#9ECBFF;--1:#9ECBFF\">'I am on line 6'</span><span style=\"--0:#E1E4E8;--1:#E1E4E8\">)</span></div></div></code><button class=\"copy-btn\" aria-label=\"Copy code\"><div class=\"copy-btn-icon\"><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon copy-icon\"><path d=\"M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z\"></path></svg><svg viewBox=\"0 -960 960 960\" xmlns=\"http://www.w3.org/2000/svg\" class=\"copy-btn-icon success-icon\"><path d=\"m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z\"></path></svg></div></button></pre></figure></div></section></section>",{headings:522,localImagePaths:601,remoteImagePaths:602,frontmatter:603,imagePaths:608},[523,525,528,532,535,538,541,544,547,550,553,556,559,562,565,568,571,574,577,580,583,586,589,592,595,598],{depth:52,slug:509,text:524},"Expressive Code#",{depth:171,slug:526,text:527},"syntax-highlighting","Syntax Highlighting#",{depth:529,slug:530,text:531},4,"regular-syntax-highlighting","Regular syntax highlighting#",{depth:529,slug:533,text:534},"rendering-ansi-escape-sequences","Rendering ANSI escape sequences#",{depth:171,slug:536,text:537},"editor--terminal-frames","Editor & Terminal Frames#",{depth:529,slug:539,text:540},"code-editor-frames","Code editor frames#",{depth:529,slug:542,text:543},"terminal-frames","Terminal frames#",{depth:529,slug:545,text:546},"overriding-frame-types","Overriding frame types#",{depth:171,slug:548,text:549},"text--line-markers","Text & Line Markers#",{depth:529,slug:551,text:552},"marking-full-lines--line-ranges","Marking full lines & line ranges#",{depth:529,slug:554,text:555},"selecting-line-marker-types-mark-ins-del","Selecting line marker types (mark, ins, del)#",{depth:529,slug:557,text:558},"adding-labels-to-line-markers","Adding labels to line markers#",{depth:529,slug:560,text:561},"adding-long-labels-on-their-own-lines","Adding long labels on their own lines#",{depth:529,slug:563,text:564},"using-diff-like-syntax","Using diff-like syntax#",{depth:529,slug:566,text:567},"combining-syntax-highlighting-with-diff-like-syntax","Combining syntax highlighting with diff-like syntax#",{depth:529,slug:569,text:570},"marking-individual-text-inside-lines","Marking individual text inside lines#",{depth:529,slug:572,text:573},"regular-expressions","Regular expressions#",{depth:529,slug:575,text:576},"escaping-forward-slashes","Escaping forward slashes#",{depth:529,slug:578,text:579},"selecting-inline-marker-types-mark-ins-del","Selecting inline marker types (mark, ins, del)#",{depth:171,slug:581,text:582},"word-wrap","Word Wrap#",{depth:529,slug:584,text:585},"configuring-word-wrap-per-block","Configuring word wrap per block#",{depth:529,slug:587,text:588},"configuring-indentation-of-wrapped-lines","Configuring indentation of wrapped lines#",{depth:52,slug:590,text:591},"collapsible-sections","Collapsible Sections#",{depth:52,slug:593,text:594},"line-numbers","Line Numbers#",{depth:171,slug:596,text:597},"displaying-line-numbers-per-block","Displaying line numbers per block#",{depth:171,slug:599,text:600},"changing-the-starting-line-number","Changing the starting line number#",[],[],{title:512,published:604,description:514,tags:605,category:65,draft:90,minutes:529,words:606,excerpt:607},["Date","2024-04-10T00:00:00.000Z"],[62,63,64],737,"Here, we’ll explore how code blocks look using Expressive Code. The provided examples are based on the official documentation, which you can refer to for further details.",[],"expressive-code.md"];

export { _astro_dataLayerContent as default };
